<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<title>党教首页</title>
<style type="text/css">
.chan{
	line-height:64px;
	position:absolute;
	left:18px;
	top:0px;
	width:568px;
	color:#000;
	font-size:28px;
}
</style>
<script type="text/javascript" src="config/config.js"></script>
<script type="text/javascript" src="js/swat3.js"></script>
<script type="text/javascript" src="js/ext.platform.js"></script>
<script type="text/javascript" src="js/CMediaPlayer.js"></script>
<script type="text/javascript" src="js/common.js"></script>
<script language="javascript">
/***********************变量区域************************/
var focusArea=2;// 0:播放窗口  1:频道列表  2:选项列表
var menuPos=0;//选项索引值
var itemPos=0;//频道索引值

var isFirstEnter=true;//第一次点击
var muteFlag = false;//静音标识字段
var prePlayVideo = {
	"videoName":"肥城党建视频点播",
	"playUrl":"http://10.191.85.203:90/remote_education/gd.mp4"
}
var playUrl = prePlayVideo.playUrl;//播放地址
var BACK_URL = "";
var itemArr = [];
var menuArr=[
{
	"name":"视频会议",
	"imageUrl":"images/img_03.png",
	"url":"videoMeeting/index.htm"
},
{
	"name":"远程培训",
	"imageUrl":"images/img_04.png",
	"url":"remoteTraining/index.htm"
},
{
	"name":"三会一课",
	"imageUrl":"images/img_01.png",
	"url":"thrMeetingOneClass/index.htm"
},
{
	"name":"视频交流",
	"imageUrl":"images/img_02.png",
	"url":"videoCommunication/index.htm"
}];


var lastVideoInfo = {
	"title":"更多",
	"playUrl":"",
	"linkUrl":"videoList.htm"
};
var videoPos = {
	"borderRadius":"0px",
	"left":"70px",
	"top":"110px",
	"width":"558px",
	"height":"313px",
	"url":"play.htm"  //链接地址
};

var menuPosArr={
	"borderRadius":"14px",
	"items":[
	{"left":"133px","top":"488px","width":"224px","height":"143px"},
	{"left":"397px","top":"488px","width":"224px","height":"143px"},
	{"left":"658px","top":"488px","width":"224px","height":"143px"},
	{"left":"922px","top":"488px","width":"224px","height":"143px"}
	]
};

var file="/list.js";
var subFile="/content.js";
var menuData = [];

document.onkeydown = eventHandler;

function eventHandler(key){
  var e = key || event;
  var keycode = e.keyCode || e.which || e.charCode;
  iDebug("index--eventHandler--keycode="+keycode);
  switch (keycode) {
    case 1:   // up
    case 38:
      changeUD(-1);
      return false;
      break;
    case 2:   // down
    case 40:
      changeUD(1);
      return false;
      break;
    case 3:   // left
    case 37:
      changeLR(-1);
      return false;
      break;
    case 4:   // right
    case 39:
      changeLR(1);
      return false;
      break;
    case 13://菜单键
      doSelect();
      return false;
      break;
	case 77:  //静音键
		if(muteFlag == false){
			muteFlag = true;
			iSTB.player.mute();
		}else{
			muteFlag = false;
			iSTB.player.unmute();
		}
		return false;
		break;
    case 8://返回键
	  goBack();
      event.returnValue = false;
      return false;
      break;
    case 27:
      iSTB.browser.gotoSTB("tv");
      event.returnValue = false;
      return false;	
	}
}

function goBack(){
	 removeGlobalParms(["focusArea","menuPos"]);
     window.location.href = BACK_URL;
}

function changeUD(_num){
	if(focusArea==0){
		_num>0?(focusArea=2,menuPos=0):focusArea=focusArea;
	}else if(focusArea==1){
		if(getStrChineseLength(itemArr[itemPos].title)>21){
			$("channelName"+itemPos).innerText=getStrChineseLen(itemArr[itemPos].title,20);
		}else{
			$("channelName"+itemPos).innerHTML=itemArr[itemPos].title;	
		}
		if(itemPos==0 && _num<0) return ;
		else if(itemPos==itemArr.length-1 && _num>0){
			focusArea=2;
			menuPos=0;
		}else{
			$("channel"+itemPos).style.color="";
			$("channel"+itemPos).style.backgroundImage="url()";
			itemPos = (itemPos+_num+itemArr.length)%itemArr.length;
		}
	}else if(focusArea==2){
		focusArea=(_num>0)?focusArea:0;
	}
	iDebug("index--changeUD--itemPos="+menuPos+"|focusArea="+focusArea);
	setFocus();
}

function changeLR(_num){
	if(focusArea==0){
		(_num>0)?(focusArea=1,itemPos=0):focusArea=focusArea;
	}else if(focusArea==1){
		focusArea=(_num<0)?0:focusArea;
	}else if(focusArea==2){
		menuPos=(menuArr.length+_num+menuPos)%menuArr.length;
	}
	iDebug("index--changeLR--itemPos="+menuPos+"|focusArea="+focusArea);
	setFocus();
}

function doSelect(){
	if(focusArea==0){
		if(videoPos.url!=""){
			setGlobalParms({"focusArea":focusArea});
			setGlobalParms({"menuEnName":menuData[0].enName});
			window.location.href=videoPos.url+"?leftPosition=2?rightPosition="+itemPos+"?returnType=0";
		}
	}else if(focusArea == 1){
		isFirstEnter = false;
		if(itemArr[itemPos].linkUrl!=""){
			exitPage();
			setGlobalParms({"itemPos":itemPos,"focusArea":focusArea});
			setGlobalParms({"cmd":"fromIndex"});
			window.location.href=itemArr[itemPos].linkUrl;
		}else if(itemArr[itemPos].videoUrl!=""){
			playUrl = itemArr[itemPos].videoUrl;
			openVoid();	
		}
	}else if(focusArea==2){
		if(menuPos==1){
			setGlobalParms({"cmd":"fromSelectFun"});
		}
		if(menuArr[menuPos].url!=""){
			setGlobalParms({"menuPos":menuPos,"focusArea":focusArea});
			window.location.href = menuArr[menuPos].url;
		}
	}
}

function init(){
	getParms();
	getData();
	initContent();
	showDateTime();
	setFocus();
	openVoid();
}

function getParms(){
	focusArea = getGlobalParms("focusArea");
	if(focusArea!=""){
		focusArea = parseInt(focusArea,10);
	}else{
		focusArea = 2;
	}
	
	menuPos = getGlobalParms("menuPos");
	if(menuPos!=""){
		menuPos = parseInt(menuPos,10);
	}else{
		menuPos = 0;
	}
	
	itemPos = getGlobalParms("itemPos");
	if(itemPos!=""){
		itemPos = parseInt(itemPos,10);
	}else{
		itemPos = 0;
	}
}

function getData(){
  var url=requestUrl+file;
  ajax_js(url,function(responseText){
    var tempMenu = eval("("+responseText+")");
    if(typeof(tempMenu)!="undefined" && tempMenu.length!=0){
      for(var i=0,len = tempMenu.length;i<len;i++){
        var str = {
          "name" : "",
          "enName" : "",
          "subMenu" : [],
          "nodePath" : ""
        }
        str.name = tempMenu[i].name;
        str.enName = tempMenu[i].enName;
        str.nodePath = tempMenu[i].nodePath;
        menuData[menuData.length] = str;
      }
	  getVideoList();
    }
  },true);
}

function getVideoList(){
  if(menuData.length<2)return;
  var url=requestUrl+"/"+menuData[0].enName+subFile;
  ajax_js(url,function(responseText){
    var tempMenu=eval("("+responseText+")");
    if(typeof(tempMenu)!="undefined" && tempMenu.length!=0){
      itemArr=[];
	  var len = tempMenu.length > 4 ? 4: tempMenu.length;
      for(var i=0;i<len;i++){
		  itemArr.push(tempMenu[i]);
	  }
    }
  },true);
  itemArr.push(lastVideoInfo);
  iDebug("index.htm--getVideoList--len="+itemArr.length);
}

function initContent(){
	initMenuContent();
	initChannelContent();
}

function initMenuContent(){
	for(var i=0,len=menuArr.length;i<len;i++){
		$("icon"+i).src=menuArr[i].imageUrl;
	}	
} 
function initChannelContent(){
	for(var i=0,len=itemArr.length;i<len;i++){
		if(getStrChineseLength(itemArr[i].title)>21){
			$("channelName"+i).innerText = getStrChineseLen(itemArr[i].title,20);
		}else{
			$("channelName"+i).innerText = itemArr[i].title;	
		}
	}
}

function setFocus(){
	if(focusArea==0){
		$("channel"+itemPos).style.backgroundImage="url()";
		$("channel"+itemPos).style.color = "";
		$("focus").style.visibility="visible";
		
		$("focus").style.borderRadius = videoPos.borderRadius;
		$("focus").style.left = videoPos.left;
		$("focus").style.top = videoPos.top;
		$("focus").style.width = videoPos.width;
		$("focus").style.height = videoPos.height;
	}else if(focusArea==1){
		$("focus").style.visibility="hidden";
		$("channel"+itemPos).style.backgroundImage="url(images/foc_02.png)";
		$("channel"+itemPos).style.color="#ffffff";
		
		if(getStrChineseLength(itemArr[itemPos].title)>21){
			$("channelName"+itemPos).innerHTML="<marquee width='550px'>"+itemArr[itemPos].title+"</marquee>";
		}else{
			$("channelName"+itemPos).innerHTML=itemArr[itemPos].title;	
		}
	}else if(focusArea==2){
		$("channel"+itemPos).style.backgroundImage="url()";
		$("channel"+itemPos).style.color="";
		$("focus").style.visibility = "visible";
		$("focus").style.borderRadius = menuPosArr.borderRadius;
		iDebug("left=>"+menuPosArr.items[menuPos].left+"|top="+menuPosArr.items[menuPos].left+"|width="+menuPosArr.items[menuPos].width+"|height="+menuPosArr.items[menuPos].height);
		$("focus").style.left = menuPosArr.items[menuPos].left;
		$("focus").style.top = menuPosArr.items[menuPos].top;
		$("focus").style.width = menuPosArr.items[menuPos].width;
		$("focus").style.height = menuPosArr.items[menuPos].height;
	}
}

/***************************浪潮盒子播放接口****************************************/

window.$LOG = '';
window.$MP = '';
window.$PLAT = '';

try{
	$LOG = new CLogger( {elem:'eLog'} );
	$PLAT = CPlatform.newInstance();
	$MP = CMediaPlayer.newInstance( CPlatform.getBrowserType(), '$MP' );
	$LOG.log( 'Platform: ' + CPlatform.getBrowserType());
	$LOG.log( 'Browser: ' + $PLAT.versionInfo());
	$LOG.log( 'MPlayer: ' + $MP.className );
}catch( E ){}

function openVoid(){
	try{	
     	iSTB.player.play(playUrl);
     	iSTB.player.set_video_window(74, 115, 562, 317);
	}
  	catch( E ){
    	$LOG.log( '点播失败....' + playUrl );
  	}
}
var playTimeout = -1;
if(typeof iSTB !="undefined"){
	iSTB.evt.set_event_callback("eventCallback");
}
function eventCallback(type,event_name,event_type,event_value){
	switch(event_name){
		case  "PLAYER_BUFFERING_END":
		break;
		case  "PLAYER_FINISH":
			//window.location.href="index.htm";
		break;
	}
}

//退出关闭视频方法
function stopVoid(){
	try{
    	$MP.stop();
	}
  	catch( E ){}
}

function exitPage(){
	stopVoid();
}
</script>
</head>

<body background="images/bg_00.png" topmargin="0" bottommargin="0" onload="init();" onunload="exitPage();" bgcolor="transparent">

<div style="position: absolute; left: 647px; top: 74px; width: 133px; font-size:30px; color:#FFFFFF"></div>
<div style="position:absolute; left:1078px; top:52px;color:#ffffff; width:100px;">
  <div style="font-size:26px; position:absolute; left:0px; top:0px; line-height:26px;" id="time"></div>
    <div style="font-size:18px; position:absolute; left:8px; top:26px; line-height:26px;" id="date"></div>
</div>

<!--TV-->
<!--<div style="position:absolute; left:75px; top:386px;">
    <div style="position:absolute; left:0px; top:0px;"><img src="images/tv_bg.png" width="559" height="45"></div>
    <div style="font-size:26px; color:#ffffff; line-height:45px; position:absolute; left:18px; top:0px; width:110px;">党建频道</div>
    <div style="font-size:26px; color:#ffffff; line-height:45px; position:absolute; left:395px; top:0px; width:110px;">湖南卫视</div>
    
    <div style="position:absolute; left:504px; top:2px; color:#ffffff; font-size:17px;">    
    	<table width="100%" border="0" cellspacing="0" cellpadding="0">
        	<tr><td>19:30</td></tr>
            <tr><td>19:30</td></tr>
        </table>
    </div>
</div>-->
<!--<div style="position:absolute; right:300px; top:58px; font-size:30px; color: white; font-family: '微软雅黑'" class="title">视频点播</div>-->
<div style="position:absolute; left:635px; top:115px; width:584px; height:315px; background-image:url(); font-size:26px; color:#737373;" >
	
	<div style="position:absolute; left:0px; top:0px; width:584px; height:60px;" id="channel0">
    	<div class="chan" id="channelName0"></div>
    <!--<div style="position:absolute; left:395px; top:23px;"><img src="images/icon_01.png" width="60" height="25"></div>
        <div style="line-height:64px; position:absolute; left:463px; top:0px; width:200px;" >中央财经</div>-->
	</div>
    
    <div style="position:absolute; left:0px; top:60px; width:584px; height:60px;" id="channel1">
   	  <div class="chan"  id="channelName1"></div>
        <!--<div style="position:absolute; left:428px; top:16px;"><img src="images/icon_02.png" width="28" height="28"></div>
      <div style="line-height:64px; position:absolute; left:463px; top:0px; width:110px;">浙江卫视</div>-->
    </div>
    
    <div style="position:absolute; left:0px; top:120px; width:584px; height:60px;" id="channel2">
    	<div class="chan" id="channelName2"></div>
        <!--<div style="position:absolute; left:428px; top:16px;"><img src="images/icon_03.png" width="31" height="21"></div>
      <div style="line-height:64px; position:absolute; left:463px; top:0px; width:110px;">湖南卫视</div>-->
    </div>
    
    <div style="position:absolute; left:0px; top:180px; width:584px; height:60px;" id="channel3">
    	<div class="chan"  id="channelName3"></div>
       <!-- <div style="position:absolute; left:428px; top:16px;"><img src="images/icon_04.png" width="28" height="20"></div>
      <div style="line-height:64px; position:absolute; left:463px; top:0px; width:110px;">深圳卫视</div>-->
    </div>
    
    <div style="position:absolute; left:0px; top:240px; width:584px; height:60px;" id="channel4">
   	  <div class="chan"  id="channelName4"></div>
        <!--<div style="position:absolute; left:428px; top:16px;"><img src="images/icon_05.png" width="25" height="25"></div>
      <div style="line-height:64px; position:absolute; left:463px; top:0px; width:110px;">山东卫视</div>-->
    </div>
</div>
<!--<div style="position:absolute; left:75px; top:433px;"><img src="images/down.png" width="1143" height="52"></div>-->

<div style="position:absolute; left:134px; top:488px;">
	<div style="position:absolute; left:0px; top:0px;"><img src="" width="233" height="150" id="icon0"></div>
    <div style="position:absolute; left:264px; top:0px;"><img src="" width="233" height="150" id="icon1"></div>
    <div style="position:absolute; left:526px; top:0px;"><img src="" width="233" height="150" id="icon2"></div>
    <div style="position:absolute; left:790px; top:0px;"><img src="" width="233" height="150" id="icon3"></div>
</div>



<!--img-->
<!--<div style="position:absolute; left:74px; top:488px;">
	<div style="position:absolute; left:0px; top:0px;"><img src="" width="233" height="150" id="icon0"></div>
    <div style="position:absolute; left:304px; top:0px;"><img src="" width="233" height="150" id="icon1"></div>
    <div style="position:absolute; left:606px; top:0px;"><img src="" width="233" height="150" id="icon2"></div>
    <div style="position:absolute; left:910px; top:0px;"><img src="" width="233" height="150" id="icon3"></div>
</div>-->


<!--公告-->
<div style="position:absolute; left:75px; top:660px; width:780px;">
	<div style="position:absolute; left:0px; top:0px;"><img src="images/light.png" width="25" height="23"></div>
    <div style="position:absolute; left:36px; top:0px; line-height:23px; font-size:24px; color:#ffffff;"> <marquee direction="left" scrollamount=7 width="700px"></marquee></div>
</div>
<div style="position:absolute; left:903px; top:650px;"><img src="images/btn.png" width="303" height="40"></div>
</div>

<div style="position:absolute; border-radius:14px; width:224px; height:143px; border:6px #EDF50A solid; left: 132px; top: 488px; -webkit-transition-duration:0ms; visibility:hidden;" id="focus"></div>

<div style="position: absolute; border: #F00 3px solid; width: 300px; height: 392px; left: 532px; top: 32px; visibility:hidden" id="test"></div>
</body>
</html>