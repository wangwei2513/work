<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="UTF-8">
	<title>Document</title>
	<style>
		* {
			margin:0px;
			padding:0px;
		}
		body {
			background:url(images/bg.jpg) no-repeat;
		}
		.list {
			 width:224px; 
			 background:url(images/icon08.png);
			 line-height:39px;
			 font-size:20px; 
			 color:#f8af89;
			 list-style:none;
			 text-indent:0.5em;
			 z-index:9;
			 visibility:hidden;
		}
	</style>
	<script src="js/common.js"></script>
	<script src="js/config.js"></script>
</head>
<body>
	<!--logo-->
	<img style="position:absolute; left:57px; top:30px;" src="images/logo.png" width="590" height="47" />
	<img style="position:absolute; left:1096px; top:38px;" src="images/t1.png" width="111" height="31" />
	
	<!--会场名称-->
	<div style="position:absolute; left:66px; top:120px; font-size:24px; color:#efcebc;">会场名称 :</div>
	<div style="position:absolute; left:187px; top:109px; width:224px; height:46px;background:url(images/icon07.png);">
	  <div id="selectPlace" style="position:absolute; left:10px; top:0px; width:180px; height:46px; line-height:46px; font-size:22px; color:#f8af89;"></div>
	    <div style="position:absolute; left:195px; top:17px;"><img src="images/icon05.png" width="16" height="12" /></div>
	</div>
	<ul id="placeList" class="list"  style="position:absolute; left:187px; top:159px; ">
	</ul>
	
	<!--焦点-->
	<img id="placeFocus" style="position:absolute; left:163px; top:95px; z-index:99;visibility:hidden;" src="images/focus04.png" width="266" height="77" />

	<!--打卡状态-->
	<div style="position:absolute; left:460px; top:120px; font-size:24px; color:#f4e7e0;">打卡状态 :</div>
	<div style="position:absolute; left:581px; top:109px; width:144px; height:46px;background:url(images/icon03.png);">
	  	<div id="selectStatus" style="position: absolute; left: 0px; top: 0px; width: 144px; height: 46px; line-height: 46px; font-size: 22px; color: #f8af89; text-indent: 0.5em;">全部</div>
	    <img style="position:absolute; left:115px; top:17px;" src="images/icon05.png" width="16" height="12" />
	</div>
	<ul id="statusList" class="list" style="position:absolute; left:581px; top:159px;width:144px;">
		<li>全部</li>
		<li>准点</li>
		<li>迟到</li>
		<li>未签到</li>
	</ul>
	<!--焦点-->
	<img id="statusFocus" style="position:absolute; left:565px; top:95px; z-index:99;visibility:hidden;" src="images/focus04.png" width="173" height="77" />


	<div style="position:absolute; left:70px; top:176px; width:1140px; height:440px; background:url(images/icon_bg02.png);">
		<div style="position:absolute; left:39px; top:0px; width:1005px;">
			<table width="100%" border="0" cellspacing="0" cellpadding="0" style=" font-size:24px; color:#010000;">
			  <tr>
			    <td width="282" height="67" style=" font-size:22px; color:#5f1313;">所属会场名称</td>
			    <td width="231" style=" font-size:22px; color:#5f1313;">人员名称</td>
			    <td width="243" style=" font-size:22px; color:#5f1313;">打卡状态</td>
			    <td style=" font-size:22px; color:#5f1313;">打卡时间</td>
			  </tr>
			  <tr>
			    <td id="place0" height="62"></td>
			    <td id="name0"></td>
			    <td id="status0"></td>
			    <td id="time0"></td>
			  </tr>
			  <tr>
			    <td  id="place1" height="62"></td>
			    <td id="name1" ></td>
			    <td id="status1" ></td>
			    <td id="time1" ></td>
			  </tr>
			  <tr>
			    <td id="place2" height="62"></td>
			    <td id="name2"></td>
			    <td id="status2"></td>
			    <td id="time2"></td>
			  </tr>
			  <tr>
			    <td id="place3" height="62"></td>
			    <td id="name3"></td>
			    <td id="status3"></td>
			    <td id="time3"></td>
			  </tr>
			  <tr>
			    <td id="place4" height="62"></td>
			    <td id="name4"></td>
			    <td id="status4"></td>
			    <td id="time4"></td>
			  </tr>
			  <tr>
			    <td id="place5" height="62"></td>
			    <td id="name5"></td>
			    <td id="status5"></td>
			    <td id="time5"></td>
			  </tr>
			</table>
		</div>
		<img id="focus" style="position:absolute; left:0px; top:396px;" src="images/focus01.png" width="1111" height="110" />
		<div id="scrollBar" style="position:absolute; left:1117px; top:14px;height:420px;width:8px;">
			<img id="scroll" style="position:absolute; left:0px; top:0px;" src="images/icon06.png" width="8" height="122" />
		</div>
	</div>
	
	
	<!--footer-->
	<img style="position:absolute; left:75px; top:662px;" src="images/icon02.png" width="25" height="22" />
	<div style="position:absolute; left:111px; top:662px; font-size:24px; color:#dba49e;">尊敬的用户：您好！今明两天有大到暴雨，请您做好防雨防暴措施。</div>
	<img style="position:absolute; left:903px; top:645px;" src="images/icon01.png" width="312" height="40" />

	<!--Console-->
	<div id="testConsole" style="position:absolute;color:#fff;background-color:#000;width:100%;height:200px;bottom:0px;text-align:center;visibility:hidden;"></div>
</body>
<script>
document.onkeydown = eventHandler;
function eventHandler(key){
    var e = key || event;
    var keycode = e.keyCode || e.which || e.charCode;
    switch (keycode) {
    case 1:   // up
    case 38:
      changeUD(-1);
      return false;
      break;
    case 2:   // down
    case 40:
      changeUD(1);
      return false;
      break;
    case 3:   // left
    case 37:
      changeLR(-1);
      return false;
      break;
    case 4:   // right
    case 39:
      changeLR(1);
      return false;
      break;
    case 13:
      doSelect();
      return false;
      break;
    case 27:
      iSTB.browser.gotoSTB("tv");
      return false;
      break;
    case 8:
      window.location.href = "meetingList.htm";
      return false;
      break;
    }
}
var allData = [];
var idCode = getUrlParams("idCode") || "495";
var focusArea = 0;
var statusType = ["全部","准点","迟到","未签到"];
var statusFocus = 0;
var statusPos = 0;
var isShowStatus = false;
var placeArr = [];
var placeFocus = 0;
var placePos = 0;
var isShowPlace = false;
var listBox = null;
var listData = [];
var listPos = 0;
var focusPos = [
  {left: "0px", top: "43px", width:"1111px", height:"110px"},
  {left: "0px", top: "105px", width:"1111px", height:"110px"},
  {left: "0px", top: "167px", width:"1111px", height:"110px"},
  {left: "0px", top: "229px", width:"1111px", height:"110px"},
  {left: "0px", top: "291px", width:"1111px", height:"110px"},
  {left: "0px", top: "353px", width:"1111px", height:"110px"},
  {left: "0px", top: "415px", width:"1111px", height:"110px"}
];
var scrollObj = null;

function init() {
	getSignList();
}

window.onload = init;

/*获取签到信息*/
function getSignList() {
	var url =signUrl.replace("{0}",idCode);
	$("testConsole").innerText += "\n签到信息接口地址:\n"+url;
	ajax_js(url,function(responseText){
	    var getData = eval("("+responseText+")");
	    if(typeof(getData)!="undefined" && getData.result == "E0000"){
	    	allData = getData.msg;
	    	for(var i=0;i<getData.msg.length;++i) {
	    		placeArr.push(getData.msg[i].placeName);
	    	}
	    	listData = allData[placeFocus].signInfo;
	    	initPlaceList();
	    	initSignList();
	    	initScroll();
	    }
	},true);
}
/*初始化签到信息列表*/
function initSignList() {
	listData = filterList();
	listBox = new showList2D(6,listData.length,0,0);
    listBox.focusObj = focusPos;
    listBox.focusDiv = "focus";
    listBox.isLoop = true;
    listBox.haveData = showList;
    listBox.noData = clearList;
    listBox.startShow(); 
}

function showList(_list){   
	var statusArr = ["准点","迟到","未签到"];
  	$("place"+_list.idPos).innerText = placeArr[placePos];
  	$("name"+_list.idPos).innerText = listData[_list.dataPos].personName;
  	$("status"+_list.idPos).innerText = statusArr[listData[_list.dataPos].status];
  	$("time"+_list.idPos).innerText = listData[_list.dataPos].signTime;
}

function clearList(_list){
  $("place"+_list.idPos).innerText = "";
  $("name"+_list.idPos).innerText = "";
  $("status"+_list.idPos).innerText = "";
  $("time"+_list.idPos).innerText = "";
}
/*初始化滚动条*/
function initScroll() {
	scrollObj = new ScrollBar("scrollBar","scroll");
	scrollObj.init(listData.length,1,300,0);
}
/*初始化会场列表*/
function initPlaceList() {
	var content = "";
	for(var i=0;i<placeArr.length;++i) {
		content += "<li>" + placeArr[i] + "</li>";
	}
	$("placeList").innerHTML = content;
	$("selectPlace").innerText = placeArr[placePos];
}

/*过滤签到类型*/
function filterList() {
	var data = allData[placePos].signInfo;
	if(statusPos > 0) {
		var arr = [];
		for(var i=0,len=data.length;i<len;++i) {
			if(data[i].status == statusPos-1) {
				arr.push(data[i]);
			}
		}
		return arr;
	} else {
		return data;
	}
}

function changeArea(area) {
	var pastFocus = ["focus","placeFocus","statusFocus"][focusArea];
	var nowFocus = ["focus","placeFocus","statusFocus"][area];
	$(pastFocus).style.visibility = "hidden";
	$(nowFocus).style.visibility = "visible";
	focusArea = area;
}

function changeUD(num) {
	if(focusArea === 0) {
		if(listBox.position === 0 && num < 0) {
			changeArea(1);
		} else {
			listBox.changeList(num);
			scrollObj.scroll(listBox.position);
		}	
	} else if(focusArea === 1) {
		if(!isShowPlace && num > 0) {
			changeArea(0);
		} else if(isShowPlace) {
			placeFocus += num;
			if(placeFocus < 0) {
				placeFocus = 0;
			} else if(placeFocus > placeArr.length) {
				placeFocus = 1;
			}
			if(placeFocus === 0) {
				$("placeFocus").style.top = "95px";
			} else {
				$("placeFocus").style.top = (103 + 39 * placeFocus) + "px";
			}
			
		}
	} else if(focusArea === 2) {
		if(!isShowStatus && num > 0) {
			changeArea(0);
		} else if(isShowStatus) {
			statusFocus += num;
			if(statusFocus < 0) {
				statusFocus = 0;
			} else if(statusFocus > statusType.length) {
				statusFocus = 1;
			}
			if(statusFocus === 0) {
				$("statusFocus").style.top = "95px";
			} else {
				$("statusFocus").style.top = (103 + 39 * statusFocus) + "px";
			}
			
		}
	}
}

function changeLR(num) {
	if(focusArea === 1) {
		changeArea(2);
	} else if(focusArea === 2) {
		changeArea(1);
	}
}

function doSelect() {
	if(focusArea === 1) {
		if(!isShowPlace) {
			isShowPlace = true;
			$("placeList").style.visibility = "visible";
		} else {
			if(placeFocus != 0) {
				$("selectPlace").innerText = placeArr[placeFocus-1];
				placePos = placeFocus-1;
				placeFocus = 0;
				$("placeFocus").style.top = "95px";
			}	
			isShowPlace = false;
			$("placeList").style.visibility = "hidden";	
			initSignList();
	    	initScroll();
		}
	} else if(focusArea === 2) {
		if(!isShowStatus) {
			isShowStatus = true;
			$("statusList").style.visibility = "visible";
		} else {
			if(statusFocus != 0) {
				$("selectStatus").innerText = statusType[statusFocus-1];
				statusPos = statusFocus - 1;
				statusFocus = 0;
				$("statusFocus").style.top = "95px";
			}	
			isShowStatus = false;
			$("statusList").style.visibility = "hidden";
			initSignList();
	    	initScroll();
		}
	}
}
</script>
</html>