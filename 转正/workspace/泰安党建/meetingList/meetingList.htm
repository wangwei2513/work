<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="utf-8">
	<title>Document</title>
	<style>
		* {
			margin:0px;
			padding:0px;
		}
		body {
			background:url(images/bg.jpg) no-repeat;
		}
		
	</style>
	<script src="js/common.js"></script>
	<script src="js/config.js"></script>
</head>
<body>
	<!--logo-->
	<img style="position:absolute; left:57px; top:30px;" src="images/logo.png" width="590" height="47" />
	<img style="position:absolute; left:1096px; top:38px;" src="images/t1.png" width="111" height="31" />
	
	<!--会议时间-->
	<div style="position:absolute; left:66px; top:120px; font-size:24px; color:#efcebc;">会议时间 :</div>
	<div style="position:absolute; left:187px; top:109px; width:144px; height:46px;background:url(images/icon03.png);">
		<div id="selectTime" style="position:absolute; left:0px; top:0px; width:105px; height:46px; line-height:46px; font-size:22px; color:#f8af89; text-align:center;"></div>
    	<div style="position:absolute; left:115px; top:17px;"><img src="images/icon05.png" width="16" height="12" /></div>
	</div>
	<!--时间列表焦点-->
	<img id="selectFocus" style="position: absolute; left: 165px; top: 93px; z-index: 99;visibility:hidden;" src="images/focus02.png" width="192" height="81" />

	<!--时间下拉列表-->
	<div id="timeList" style="position:absolute; left:187px; top:159px; width:144px; height:204px; background:url(images/icon04.png);z-index:9;visibility:hidden;">
		<img id="timeFocus" style="position: absolute; left: -20px; top: -15px; z-index: 99;visibility:hidden;" src="images/focus03.png" width="181" height="78" />
	  	<div style="position:absolute; left:15px; top:2px;width:105px;height:39px; line-height:39px;font-size:20px; color:#f8af89; ">全部</div>
	    <div style="position:absolute; left:15px; top:41px;width:105px;height:39px; line-height:39px;font-size:20px; color:#f8af89; ">最近一周</div>
	    <div style="position:absolute; left:15px; top:80px;width:105px;height:39px; line-height:39px;font-size:20px; color:#f8af89; ">近一个月</div>
	    <div style="position:absolute; left:15px; top:119px;width:105px;height:39px; line-height:39px;font-size:20px; color:#f8af89;">近三个月</div>
	    <div style="position:absolute; left:15px; top:158px;width:105px;height:39px; line-height:39px;font-size:20px; color:#f8af89; ">最近一年</div>

	</div>
	<!--个数-->
	<div id="itemNum" style="position:absolute; left:1155px; top:148px; width:44px; text-align:right; font-size:20px; color:#943f13;">5/10</div>

	<!--会议列表-->
	<div style="position:absolute; left:70px; top:176px; width:1140px; height:440px; background:url(images/icon_bg01.png);font-size:26px; color:#010000;">
		<div id="item0" style="position:absolute; left:26px; top:30px; width:800px;overflow:hidden;"></div>
		<div id="date0" style="position:absolute;left:840px;top:30px;text-align:right;"></div>
		<div id="item1" style="position:absolute; left:26px; top:90px; width:800px;overflow:hidden;"></div>
		<div id="date1" style="position:absolute;left:840px;top:90px;text-align:right;"></div>
		<div id="item2" style="position:absolute; left:26px; top:150px; width:800px;overflow:hidden;"></div>
		<div id="date2" style="position:absolute;left:840px;top:150px;text-align:right;"></div>
		<div id="item3" style="position:absolute; left:26px; top:210px; width:800px;overflow:hidden;"></div>
		<div id="date3" style="position:absolute;left:840px;top:210px;text-align:right;"></div>
		<div id="item4" style="position:absolute; left:26px; top:270px; width:800px;overflow:hidden;"></div>
		<div id="date4" style="position:absolute;left:840px;top:270px;text-align:right;"></div>
		<div id="item5" style="position:absolute; left:26px; top:330px; width:800px;overflow:hidden;"></div>
		<div id="date5" style="position:absolute;left:840px;top:330px;text-align:right;"></div>
		<div id="item6" style="position:absolute; left:26px; top:390px; width:800px;overflow:hidden;"></div>
		<div id="date6" style="position:absolute;left:840px;top:390px;text-align:right;"></div>
		<div id="scrollBar" style="position:absolute; left:1117px; top:14px;height:420px;width:8px;">
			<img id="scroll" style="position:absolute; left:0px; top:0px;" src="images/icon06.png" width="8" height="122" />
		</div>
		
	</div>
	<img id="focus" style="position:absolute; left:57px; top:396px;" src="images/focus01.png" width="1150" height="110" />
</div>
<img style="position:absolute; left:75px; top:662px;" src="images/icon02.png" width="25" height="22" />
<div style="position:absolute; left:111px; top:662px; font-size:24px; color:#dba49e;">尊敬的用户：您好！今明两天有大到暴雨，请您做好防雨防暴措施。</div>
<img style="position:absolute; left:903px; top:645px;" src="images/icon01.png" width="312" height="40" />

<div id="testConsole" style="position:absolute;color:#fff;background-color:#000;width:800px;height:200px;left:200px;bottom:0px;text-align:center;visibility:hidden;"></div>
<script>
document.onkeydown = eventHandler;
function eventHandler(key){
    var e = key || event;
    var keycode = e.keyCode || e.which || e.charCode;
    switch (keycode) {
    case 1:   // up
    case 38:
      changeUD(-1);
      return false;
      break;
    case 2:   // down
    case 40:
      changeUD(1);
      return false;
      break;
    case 3:   // left
    case 37:
      changeLR(-1);
      return false;
      break;
    case 4:   // right
    case 39:
      changeLR(1);
      return false;
      break;
    case 13:
      doSelect();
      return false;
      break;
    case 27:
      iSTB.browser.gotoSTB("tv");
      return false;
      break;
    case 8:
      window.location.href = "../index.htm";
      return false;
      break;
    }
}

var focusArea = 0;
var listBox = null;
var allData = [];
var listData = [];
var focusPos = [
  {left: "57px", top: "167px", width:"1150px", height:"110px"},
  {left: "57px", top: "227px", width:"1150px", height:"110px"},
  {left: "57px", top: "287px", width:"1150px", height:"110px"},
  {left: "57px", top: "347px", width:"1150px", height:"110px"},
  {left: "57px", top: "407px", width:"1150px", height:"110px"},
  {left: "57px", top: "467px", width:"1150px", height:"110px"},
  {left: "57px", top: "527px", width:"1150px", height:"110px"}
];
var scrollObj = null;
var isTimeShow = false;
var timePos = 0;
var timeType = ["全部","最近一周","近一个月","近三个月","最近一年"];
var type = getUrlParam('type') || 0;
function init() {
	$("selectTime").innerText = timeType[timePos];
	getData();
}

window.onload = init;

function getData() {
	if(typeof allData[timePos] != "undefined") {
		listData = allData[timePos];
	    initList();
	    initScroll();
	} else {
		var url = historyUrl.replace("{0}",timePos?timePos:5);
		$("testConsole").innerText += "\n会议列表接口地址:\n"+url;
		ajax_js(url,function(responseText){
			$("testConsole").innerText += "\n数据:"+responseText;
			var getData = eval("("+responseText+")");			
		    if(typeof(getData)!="undefined"){
				allData[timePos] = [];
				for(var i=0,len=getData.msg.length;i<len;++i) {
					if(getData.msg[i].meetingType == type) {
						allData[timePos].push(getData.msg[i]);
					}		
				}
		    	//allData[timePos] = getData.msg;
				listData = allData[timePos];
				if(listData.length == 0) {
					listData = [{
						"mainPlaceName": "",
						"meetingName": "无会议",
						"identifyValue": 0,
						"meetingType": 0,
						"startTime":""
					}]
				}
		      	initList();
		      	initScroll();
		    }
		},true);
	}
}

function initList() {
	listBox = new showList2D(7,listData.length,0,0);
    listBox.focusObj = focusPos;
    listBox.focusDiv = "focus";
    listBox.isLoop = true;
    listBox.haveData = showList;
    listBox.noData = clearList;
    listBox.startShow(); 
	setFocus();
    $("itemNum").innerText = (listBox.position+1) + "/" + listData.length;
}

function showList(_list){   
	if(listData[_list.dataPos].meetingName.length > 31) {
		$("item"+_list.idPos).innerText =listData[_list.dataPos].meetingName.substring(0,30)+'..';
	} else {
		$("item"+_list.idPos).innerText =listData[_list.dataPos].meetingName;
	}
  	$('date'+_list.idPos).innerText = listData[_list.dataPos].startTime;
}

function clearList(_list){
  $("item"+_list.idPos).innerText = "";
}

function initScroll() {
	scrollObj = new ScrollBar("scrollBar","scroll");
	scrollObj.init(listData.length,1,300,0);
}

function loseFocus() {
	if(listData[listBox.position].meetingName.length > 31) {
		$("item"+listBox.currFocus).innerHTML =listData[listBox.position].meetingName.substring(0,30)+'..';
	}
}

function setFocus() {
	if(listData[listBox.position].meetingName.length > 31) {
		$("item"+listBox.currFocus).innerHTML = '<marquee>'+listData[listBox.position].meetingName+'</marquee>';
	} 
}

function changeUD(num) {
	if(focusArea === 0) {
		loseFocus();
		if(listBox.position === 0 && num === -1) {
			changeArea(1);
		} else {
			listBox.changeList(num);
			scrollObj.scroll(listBox.position);
			$("itemNum").innerText = (listBox.position+1) + "/" + listData.length;
		}
		setFocus();
	} else if(focusArea === 1) {
		if(!isTimeShow && num === 1) {
			changeArea(0);
		} else if(isTimeShow && num ===1) {
			changeArea(2);
		}
	} else if(focusArea === 2) {
		timePos += num;
		if(timePos < 0) {
			timePos = timeType.length - 1;
		} else if(timePos > timeType.length-1) {
			timePos = 0;
		}
		$("timeFocus").style.top = (-15 + 39 * timePos) + "px";
	}
	
}

function changeLR(num) {

}

function doSelect() {
	if(focusArea === 0) {
		/*会议列表中选中会议*/
		window.location.href = "meeting.htm?idCode="+listData[listBox.position].identifyValue;
	} else if(focusArea === 1) {
		/*弹出时间列表*/
		if(isTimeShow) {
			isTimeShow = false;
			$("timeList").style.visibility = "hidden";
		} else {
			isTimeShow = true;
			$("timeList").style.visibility = "visible";
		}
		
	} else if(focusArea === 2) {
		/*时间列表中选择时间*/
		$("selectTime").innerText = timeType[timePos];
		
		changeArea(1);
		getData();

		timePos = 0;
		$("timeFocus").style.top = (-15 + 39 * timePos) + "px";
	}
}

function changeArea(area) {
	var pastFocus = ["focus","selectFocus","timeFocus"][focusArea];
	var nowFocus = ["focus","selectFocus","timeFocus"][area];
	$(pastFocus).style.visibility = "hidden";
	$(nowFocus).style.visibility = "visible";
	focusArea = area;
	if(pastFocus == "timeFocus") {
		isTimeShow = false;
		$("timeList").style.visibility = "hidden";
	}
}
</script>
</body>
</html>