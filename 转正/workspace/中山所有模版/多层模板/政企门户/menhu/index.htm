<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<title>常规--门户</title>
<script type="text/javascript" src="js/common.js"></script>
<script type="text/javascript" src="js/keyEvent.js"></script>
<script type="text/javascript" src="js/DataCollection.js"></script>
<script type="text/javascript">
var nodeAjaxObj = null;
var navStr = "";
	function getTitleData() {
  if(nodeAjaxObj != null){
    nodeAjaxObj.requestAbort();
  }
  nodeAjaxObj = new AjaxClass();
  nodeAjaxObj.frame = window;
  nodeAjaxObj.charset = "utf-8";
  nodeAjaxObj.successCallback = function(_xmlHttp, _params) {
    var jsonData = eval('(' + _xmlHttp.responseText + ')');
    if(typeof(jsonData) != "undefined" && jsonData.length > 0){
     navStr = jsonData;
    }
  };
  nodeAjaxObj.failureCallback = function(_xmlHttp, _params) {};
  nodeAjaxObj.url = "node.js";
  nodeAjaxObj.requestData();
}
var listType = "";
 navStr = navStr.replace(/ > /g,">");
 var msg = "";
	
	function getBackTitleData() {
		var title = navStr.split(">")[1]+"||"+ listType +"||" +navStr ;
				try{
					DataCollection.collectData(["01",location.href,document.referrer,title,"",""])
				}catch(e){};
	}
	function getTitleData() {
		var title = navStr.split(">")[1]+"||"+ listType +"||" +navStr+">"+msg ;
				try{
					DataCollection.collectData(["01",location.href,document.referrer,title,"",""])
				}catch(e){};
	}
	function getInitData() {
		var title = navStr.split(">")[1]+"||"+ listType +"||" +navStr ;
				try{
					DataCollection.collectData(["01",location.href,document.referrer,title,"",""])
				}catch(e){};
	}
	function getBackTitleData() {
		var title = navStr.split(">")[1]+"||"+ listType ;
				try{
					DataCollection.collectData(["01",location.href,document.referrer,title,"",""])
				}catch(e){};
	}
function eventHandler(eventObj){
	iDebug(">>>eventHandler--eventObj.code="+eventObj.code);
	switch(eventObj.code){
		case "KEY_UP":
			page.changeUD(-1);
		return EVENT.STOP;
		break;
		case "KEY_DOWN":
			page.changeUD(1);
		return EVENT.STOP;	
		break;
		case "KEY_LEFT":
			page.changeLR(-1);
		return EVENT.STOP;
		break;
		case "KEY_RIGHT":
			page.changeLR(1);
		return EVENT.STOP;
		break;
		case "KEY_SELECT":
			page.doSelect();
		return EVENT.STOP;
		break;
		case "KEY_BACK":
		case "KEY_EXIT":
			page.goBack();
		return EVENT.STOP;
		break;
	}
	return eventObj.args.type;
}


var page = {
	focusArea:mySessionStorage.getItem("mh_focusArea")==""?0:parseInt(mySessionStorage.getItem("mh_focusArea"),10),
	menuData:[],
	ajaxObj:null,
	ajaxRootPath:"menu.js",
	ajaxData:function(){
		ajaxObj  = null;
		if (ajaxObj != null) {
			ajaxObj.requestAbort();
		}
		ajaxObj = new AjaxClass();
		ajaxObj.frame = window;
		ajaxObj.charset = "utf-8";
		ajaxObj.successCallback = function(_xmlHttp, _params) {
			var tempResult = eval("("+_xmlHttp.responseText+")");
			if(tempResult && tempResult.length>0){
				var tempArray = [];
				for(var i=0,len = tempResult.length;i<len;i++){
					var obj = {
						"name":tempResult[i].name,
						"enName":tempResult[i].enName,
						"focusImageUrl":tempResult[i].focusImageUrl,
						"clickable":tempResult[i].clickable,
						"linkUrl":tempResult[i].linkUrl,
					};
					tempArray.push(obj);
				}
				page.menuData = page.splitData(tempArray);
				page.getTotalPage();
				page.initMainBox();
				page.showPicContent();
				page.setFocus();
			}else{
				iDebug(">>>ajaxData dataLen=0");
			}
		};
		ajaxObj.failureCallback = function(_xmlHttp, _params) {
			iDebug(">>>ajaxData--failBack");
		};
		ajaxObj.url = this.ajaxRootPath;
		iDebug(">>>ajaxData ajaxObj.url=" + ajaxObj.url);
		ajaxObj.requestData();
	},
	splitData:function(__orginArr){
		if(__orginArr.length<=0)return [];
		else{
			var tempObj = [];
			var i = 0;
			while(i<__orginArr.length){
				if(__orginArr[i].focusImageUrl == ""){//文字类型
					tempObj.push(__orginArr[i]);
					__orginArr.splice(i,1);
					i = 0;
				}else{
					i++;
				}
			}
			return [tempObj,__orginArr]	;
		}
	},
	mainBox:null,
	leftColumnLen:9,
	leftMaxWord:9,
	mainPos:mySessionStorage.getItem("mh_mainPos")==""?0:parseInt(mySessionStorage.getItem("mh_mainPos"),10),
	mainDivArr : (function(step){
		var arr = [];
		for(var i=0;i<10;i++){
			arr.push({left:"93px", top:(step*i+101)+"px", width:"238px", height:"84px"});
		}
		return arr;
	})(47.9),		
	initMainBox:function(){
		if(this.menuData.length>0 ){
			if(this.menuData[0].length<=0){
				if(this.menuData[1].length>0){
					this.focusArea = 1;
					this.setFocus();	
				}
				return;
			}
		}else{
			return;
		}
		this.mainBox =  new showList2D(this.leftColumnLen,this.menuData[0].length,this.mainPos,300,window);
		this.mainBox.focusObj = this.mainDivArr;
		this.mainBox.isLoop   = true;
		this.mainBox.pageLoop = true;
		this.mainBox.focusDiv = "mainFocus";
		this.mainBox.haveData = function(_list){			
			$("mainItem"+_list.idPos).innerText = subStr(page.menuData[0][_list.dataPos].name,page.leftMaxWord-1,"...");
		};
		this.mainBox.notData = function(_list){
			$("mainItem"+_list.idPos).innerText = "";
		};
		this.mainBox.startShow(); 
	},
	subPos:mySessionStorage.getItem("mh_subPos")==""?0:parseInt(mySessionStorage.getItem("mh_subPos"),10),
	currPage:mySessionStorage.getItem("mh_currPage")==""?0:parseInt(mySessionStorage.getItem("mh_currPage"),10),
	totalPage:0,
	pageNum:6,
	attr:[{"size":[361,112,562,320],"pos":[3,1,-1,3]},
		  {"size":[361,444,273,153],"pos":[0,1,-1,2]},
		  {"size":[649,444,273,153],"pos":[0,2,1,5]},
		  {"size":[937,112,276,153],"pos":[3,4,0,3]},
		  {"size":[937,278,276,153],"pos":[3,5,0,4]},
		  {"size":[937,444,276,153],"pos":[4,5,2,5]}],
	showPicContent:function(){
		if(this.menuData.length<=0 || this.menuData[1].length<=0)return;
		for(var i=0;i<this.pageNum;i++){
			if(this.currPage*this.pageNum+i<this.menuData[1].length){
				$("icon"+i).src = this.menuData[1][this.currPage*this.pageNum+i].focusImageUrl;	
			}else{
				$("icon"+i).src = "images/global_tm.gif";	
			}
		}
	},
	setFocus:function(){
		if(this.focusArea == 0){
			$("mainFocus").style.webkitTransitionDuration = this.mainBox.time;
			$("mainFocus").style.visibility = "visible";
			$("subFocus").style.visibility = "hidden";
			if(getStrChineseLength(this.menuData[this.focusArea][this.mainBox.position].name)>=this.leftMaxWord-1){
				$("mainItem"+this.mainBox.currFocus).innerHTML = "<marquee width=180>"+this.menuData[this.focusArea][this.mainBox.position].name+"</marquee>";
			}
			$("mainItem"+this.mainBox.currFocus).style.color = "#fff";
			$("mainItem"+this.mainBox.currFocus).style.fontSize = "26px";
		}else if(this.focusArea == 1){
			$("subFocus").style.webkitTransitionDuration = "300ms";
			$("mainFocus").style.visibility = "hidden";
			$("subFocus").style.visibility = "visible";
		
			$("mainItem"+this.mainBox.currFocus).innerText = subStr(this.menuData[0][this.mainBox.position].name,this.leftMaxWord-1,"...");
			$("mainItem"+this.mainBox.currFocus).style.color = "";
			$("mainItem"+this.mainBox.currFocus).style.fontSize = "";
			$("subFocus").style.left = this.attr[this.subPos].size[0]+"px";
			$("subFocus").style.top  = this.attr[this.subPos].size[1]+"px";
			$("subFocus").style.width = this.attr[this.subPos].size[2]+"px";
			$("subFocus").style.height = this.attr[this.subPos].size[3]+"px";
		}
	},
	changeLR:function(_num){
		if(this.focusArea == 0 && _num>0 && this.menuData.length>0 && this.menuData[1].length>0){
			$("mainFocus").style.webkitTransitionDuration = "0ms";
			this.focusArea = 1;
			this.setFocus();
		}else if(this.focusArea == 1){
			$("subFocus").style.webkitTransitionDuration = "0ms";
			var beforePos = this.subPos;		
			if((this.subPos >= 3 && this.subPos<=5) &&　_num>0 && this.currPage<this.totalPage-1){
				this.changePage(_num);
			}else{
				var pos = this.attr[this.subPos].pos[_num<0?2:3];
				if(pos == -1 && this.mainBox){
					this.focusArea = 0;
				}else{
					this.subPos = pos;
				}
				if(this.currPage*this.pageNum+this.subPos >= this.menuData[1].length){
					this.subPos = beforePos;
				}
			}
			this.setFocus();
		}
	},
	changeUD:function(_num){
		if(this.focusArea == 0){
			if(this.mainBox){
				$("mainItem"+this.mainBox.currFocus).style.color = "";
				$("mainItem"+this.mainBox.currFocus).style.fontSize = "";
				$("mainItem"+this.mainBox.currFocus).innerText = subStr(this.menuData[this.focusArea][this.mainBox.position].name,this.leftMaxWord-1,"...");
				this.mainBox.changeList(_num);
				if(getStrChineseLength(this.menuData[this.focusArea][this.mainBox.position].name)>=this.leftMaxWord-1){
					$("mainItem"+this.mainBox.currFocus).innerHTML = "<marquee width=180>"+this.menuData[this.focusArea][this.mainBox.position].name+"</marquee>";
				}
				$("mainItem"+this.mainBox.currFocus).style.color = "#fff";
				$("mainItem"+this.mainBox.currFocus).style.fontSize = "26px";
			}
		}else if(this.focusArea == 1){
			$("subFocus").style.webkitTransitionDuration = "0ms";
			var beforePos = this.subPos;
			if( ((this.subPos == 0 || this.subPos == 3) &&　_num<0 && this.currPage>0) || ((this.subPos == 1 || this.subPos == 2|| this.subPos == 5) &&　_num>0 && this.currPage<this.totalPage-1)){
				this.changePage(_num);
			}else{
				this.subPos = this.attr[this.subPos].pos[_num<0?0:1];
				if(this.currPage*this.pageNum+this.subPos >= this.menuData[1].length){
					this.subPos = beforePos;
				}
			}
			
			this.setFocus();
		}	
	},
	changePage:function(_num){
		this.currPage += _num;
		this.subPos = 0;
		this.showPicContent();
	},
	getTotalPage:function(){
		this.totalPage  = this.menuData.length>0 && this.menuData[1].length>0? Math.ceil(this.menuData[1].length/this.pageNum):0;
	},
	goBack:function(){//返回至portal
		mySessionStorage.removeItem("mh_focusArea");
		mySessionStorage.removeItem("mh_mainPos");
		mySessionStorage.removeItem("mh_subPos");
		mySessionStorage.removeItem("mh_currPage");
		listType = "首页";
			getBackTitleData();
		window.location.href = "main://index.html";
	},
	doSelect:function(){//进入播放
		mySessionStorage.setItem("mh_focusArea",this.focusArea);
		if(this.focusArea == 0 && this.mainBox){
			var currObj = this.menuData[this.focusArea][this.mainBox.position];
			mySessionStorage.setItem("mh_mainPos",this.mainBox.position);
			mySessionStorage.removeItem("mh_subPos");
			mySessionStorage.removeItem("mh_currPage");
		}else if(this.focusArea == 1){
			var currObj = this.menuData[this.focusArea][this.currPage*this.pageNum+this.subPos];
			mySessionStorage.removeItem("mh_mainPos");
			mySessionStorage.setItem("mh_subPos",this.subPos);
			mySessionStorage.setItem("mh_currPage",this.currPage);	
		}
		if(currObj.clickable == 1){
			if(currObj.linkUrl!=""){
				msg = currObj.name;
				listType = "视频";
				getTitleData();
				window.location.href = currObj.linkUrl+"?backUrl="+window.location.href;
			}else if(currObj.enName!=""){
				msg = currObj.name;
				listType = "栏目";
				getTitleData();
				window.location.href = currObj.enName  + "/index.htm";
			}
		}
	},
	init:function(){
		page.ajaxData();
		listType = "栏目";
				getInitData();
	}
}

window.onload = function(){
	page.init();
}

</script>
</head>
<body style="background:url(images/bg.jpg) no-repeat;">
	<!--标题信息-->
	<div style="position:absolute;left:85px;top:25px;color:#d2dce6;font-size:20px;">首页-中山/门户</div>
	<img src="images/line_02.png" style="position:absolute;left:0px;top:55px;"/>
	<!--一级列表-->
	<div style="position:absolute;left:83px;top:117px;background:url(images/border_left.png);width:256px;height:483px;color:#d2dce6;font-size:22px;text-align:center;">
		<table border="0" cellpadding="0" cellspacing="0" width="256" height="196">
			<tr>
				<td height="52" id="mainItem0"></td>
			</tr>
			<tr>
				<td height="49" id="mainItem1"></td>
			</tr>
			<tr>
				<td height="48" id="mainItem2"></td>
			</tr>
			<tr>
				<td height="47" id="mainItem3"></td>
			</tr>
            <tr>
				<td height="47" id="mainItem4"></td>
			</tr>
            <tr>
				<td height="47" id="mainItem5"></td>
			</tr>
            <tr>
				<td height="47" id="mainItem6"></td>
			</tr>
            <tr>
				<td height="47" id="mainItem7"></td>
			</tr>
            <tr>
				<td height="47" id="mainItem8"></td>
			</tr>
	  </table>
</div> 

<!--焦点-->
<div style="position: absolute; left: 93px; top: 101px; visibility:hidden" id="mainFocus"><img src="images/focus_border.png" /></div>
    
<div id="subFocus" style="position: absolute; left: 361px; top: 112px; width: 563px; height: 321px; border-radius: 5px; border: #F90 4px solid; opacity: 0.9; visibility: hidden"></div>


<!--右侧信息--> 
	<div style="position:absolute;left:366px;top:117px;">
		<img src="" id="icon0" width="560" height="318"/>
	</div>
	<div style="position:absolute;left:366px;top:449px;">
		<img src="" id="icon1" width="274" height="151"/>
	</div>
	<div style="position:absolute;left:653px;top:449px;">
		<img src="" id="icon2" width="274" height="151"/>
	</div>
	<div style="position:absolute;left:942px;top:449px;">
		<img src="" id="icon3" width="274" height="151"/>
	</div>
	<div style="position:absolute;left:942px;top:117px;">
		<img src="" id="icon4" width="274" height="151" />
	</div>
	<div style="position:absolute;left:942px;top:283px;">
		<img src="" id="icon5" width="274" height="151"/>
	</div>
	
    <!--底部信息-->
	<div style="position:absolute;left:0px;top:646px;background:url(images/bg_bottom.png);width:1280px;height:74px;"></div>
</body>
</html>
