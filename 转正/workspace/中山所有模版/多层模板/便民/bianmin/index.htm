<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=gb2312" />
<title>便民</title>
<script type="text/javascript" src="js/keyEvent.js"></script>
<script type="text/javascript" src="js/common.js"></script>
<script type="text/javascript" src="js/DataCollection.js"></script>
<script type="text/javascript">
var nodeAjaxObj = null;
var navStr = "";
	function getTitleData() {
  if(nodeAjaxObj != null){
    nodeAjaxObj.requestAbort();
  }
  nodeAjaxObj = new AjaxClass();
  nodeAjaxObj.frame = window;
  nodeAjaxObj.charset = "utf-8";
  nodeAjaxObj.successCallback = function(_xmlHttp, _params) {
    var jsonData = eval('(' + _xmlHttp.responseText + ')');
    if(typeof(jsonData) != "undefined" && jsonData.length > 0){
     navStr = jsonData;
    }
  };
  nodeAjaxObj.failureCallback = function(_xmlHttp, _params) {};
  nodeAjaxObj.url = "node.js";
  nodeAjaxObj.requestData();
}
var listType = "";
 navStr = navStr.replace(/ > /g,">");
 var msg = "";
	function getBackTitleData() {
		var title = navStr.split(">")[1]+"||"+ listType +"||" +navStr ;
				try{
					DataCollection.collectData(["01",location.href,document.referrer,title,"",""])
				}catch(e){};
	}
	function getTitleData() {
		var title = navStr.split(">")[1]+"||"+ listType +"||" +navStr+">"+msg ;
				try{
					DataCollection.collectData(["01",location.href,document.referrer,title,"",""])
				}catch(e){};
	}
	function getInitData() {
		var title = navStr.split(">")[1]+"||"+ listType +"||" +navStr ;
				try{
					DataCollection.collectData(["01",location.href,document.referrer,title,"",""])
				}catch(e){};
	}
	function getBackTitleData() {
		var title = navStr.split(">")[1]+"||"+ listType ;
				try{
					DataCollection.collectData(["01",location.href,document.referrer,title,"",""])
				}catch(e){};
	}
function eventHandler(eventObj){
	iDebug(">>>eventHandler--eventObj.code="+eventObj.code);
	switch(eventObj.code){
		case "KEY_UP":
			page.changeUD(-1);
		return EVENT.STOP;
		break;
		case "KEY_DOWN":
			page.changeUD(1);
		return EVENT.STOP;	
		break;
		case "KEY_LEFT":
			page.changeLR(-1);
		return EVENT.STOP;
		break;
		case "KEY_RIGHT":
			page.changeLR(1);
		return EVENT.STOP;
		break;
		case "KEY_SELECT":
			page.doSelect();
		return EVENT.STOP;
		break;
		case "KEY_BACK":
		case "KEY_EXIT":
			page.goBack();
		return EVENT.STOP;
		break;
	}
	return eventObj.args.type;
}


var page = {
	idPos:mySessionStorage.getItem("bm_idPos")==""?0:parseInt(mySessionStorage.getItem("bm_idPos"),10),
	currPage:mySessionStorage.getItem("bm_currPage")==""?0:parseInt(mySessionStorage.getItem("bm_currPage"),10),
	ajaxRootPath:"menu.js",
	pageData:[],
	ajaxData:function(){
		ajaxObj  = null;
		if (ajaxObj != null) {
			ajaxObj.requestAbort();
		}
		ajaxObj = new AjaxClass();
		ajaxObj.frame = window;
		ajaxObj.charset = "gbk";
		ajaxObj.successCallback = function(_xmlHttp, _params) {
			var tempResult = eval("("+_xmlHttp.responseText+")");
			if(tempResult && tempResult.length>0){
				for(var i=0,len = tempResult.length;i<len;i++){
					var obj = {
						"name":tempResult[i].name,
						"enName":tempResult[i].enName,
						"focusImageUrl":tempResult[i].focusImageUrl,
						"clickable":tempResult[i].clickable,
						"linkUrl":tempResult[i].linkUrl
					};
					page.pageData.push(obj);
				}
				page.getTotalPage();
				page.initContent();
				page.initDot();
				page.setFocus();
				$("focus").style.visibility = "visible";
			}else{
				iDebug(">>>ajaxData dataLen=0");
			}
		};
		ajaxObj.failureCallback = function(_xmlHttp, _params) {
			iDebug(">>>ajaxData--failBack");
		};
		ajaxObj.url = this.ajaxRootPath;
		iDebug(">>>ajaxData ajaxObj.url=" + ajaxObj.url);
		ajaxObj.requestData();
	},
	pageNum:6,
	initContent:function(){
		for(var i=0;i<this.pageNum;i++){
			if(this.currPage*this.pageNum+i<this.pageData.length){
				this.domObjArr[i].src = this.pageData[this.currPage*this.pageNum+i].focusImageUrl;
			}else{
				this.domObjArr[i].src = "images/global_tm.gif";
			}
		}
	},
	initDot:function(){
		var innerStr = "";
		for(var i = 0;i<this.totalPage;i++){
			if(this.currPage == i){
				innerStr += "<td><img src=\"images/circle_03.png\"/></td>";
			}else{
				innerStr += "<td><img src=\"images/circle_04.png\"/></td>";
			}
		}
		$("dot").innerHTML = innerStr;
	},
	totalPage:0,
	getTotalPage:function(){
		this.totalPage = Math.ceil(this.pageData.length/this.pageNum);
	},
	setFocus:function(){
		$("focus").style.left = 61+(this.idPos%3)*386+"px";
		$("focus").style.top  = 91+(Math.floor(this.idPos/3))*224+"px";
	},
	changeLR:function(_num){
		if((this.currPage==0 &&　(this.idPos == 0 || this.idPos == 3) && _num<0) || (this.currPage == this.totalPage-1 &&　(this.idPos == 2 || this.idPos == 5) && _num>0))return;
		if((this.currPage>0 &&　(this.idPos == 0 || this.idPos == 3) && _num<0) || (this.currPage < this.totalPage-1 &&　(this.idPos == 2 || this.idPos == 5) && _num>0)){
			this.changePage(_num);
		}else{
			this.idPos += _num;
		}
		if(this.idPos+this.currPage*this.pageNum>=this.pageData.length){
			this.idPos = (this.pageData.length-1)%this.pageNum;
		}
		this.setFocus();
	},
	changeUD:function(_num){
		if((this.idPos>=0 && this.idPos<=2 && _num<0) || (this.idPos>=3 && this.idPos<=5 && _num>0))return;
		this.idPos += _num*3;
		if(this.idPos+this.currPage*this.pageNum>=this.pageData.length){
			this.idPos = (this.pageData.length-1)%this.pageNum;
		}
		this.setFocus();
	},
	changePage:function(_num){
		this.currPage += _num;
		this.idPos = 0;
		this.initContent();
		this.initDot();
		this.setFocus();
	},
	goBack:function(){
		mySessionStorage.removeItem("bm_idPos");
		mySessionStorage.removeItem("bm_currPage");
		listType = "首页";
			getBackTitleData();
		window.location.href = "main://index.html";
	},
	doSelect:function(){
		if(this.pageData.length<=0)return;
		var currObj = this.pageData[this.idPos+this.currPage*this.pageNum];
		if(currObj.clickable == 1){
			mySessionStorage.setItem("bm_idPos",this.idPos);
			mySessionStorage.setItem("bm_currPage",this.currPage);
			if(currObj.linkUrl!=""){
				msg = currObj.name;
				listType = "视频";
				getTitleData();
				window.location.href = currObj.linkUrl+"?backUrl="+window.location.href;
			}else if(currObj.enName!=""){
				msg = currObj.name;
				listType = "栏目";
				getTitleData();
				window.location.href = currObj.enName  + "/index.htm";
			}
		}
	},
	initPage:function(){
		page.ajaxData();
		listType = "首页";
			listType = "栏目";
				getInitData();
	}
};

window.onload = function(){
	page.initPage();
}
</script>
</head>
<body style="background:url(images/bg.jpg) no-repeat;">
	<!--标题信息-->
	<div style="position:absolute;left:85px;top:25px;color:#d2dce6;font-size:20px;">首页-中山/便民</div>
	<img src="images/line_03.png" style="position:absolute;left:0px;top:55px;"/>
	<!--内容信息-->
	<div style="position:absolute;left:80px;top:110px;">
		<img src="" id="focusImage0" width="363" height="201" />
	</div>
	<div style="position:absolute;left:467px;top:110px;">
		<img src="" id="focusImage1" width="363" height="201"/>
	</div>
	<div style="position:absolute;left:852px;top:110px;">
		<img src="" id="focusImage2" width="363" height="201"/>
	</div>
	<div style="position:absolute;left:80px;top:334px;">
		<img src="" id="focusImage3" width="363" height="201"/>
	</div>
	<div style="position:absolute;left:467px;top:334px;">
		<img src="" id="focusImage4" width="363" height="201"/>
	</div>
	<div style="position:absolute;left:852px;top:334px;">
		<img src="" id="focusImage5" width="363" height="201"/>
	</div>
    
    <!--焦点-->
    <div style="position: absolute; left: 61px; top: 91px; visibility:hidden;-webkit-transition-duration:200ms" id="focus"><img src="images/focus_border_08.png"/></div>
    
	<!--页码信息-->
	<img src="images/line_07.png" style="position:absolute;left:289px;top:587px;"/>
	<table border="0" cellpadding="0" cellspacing="0" style="position: absolute; left: 569px; top: 583px; width: 153px; height: 8px;">
		<tr id="dot" align="center">
			<!--<td><img src="images/circle_04.png"/></td>
			<td><img src="images/circle_04.png"/></td>
			<td><img src="images/circle_03.png"/></td>
			<td><img src="images/circle_04.png"/></td>
			<td><img src="images/circle_04.png"/></td>-->
		</tr>
	</table>
	<img src="images/line_07.png" style="position:absolute;left:742px;top:587px;"/>
	<!--底部信息-->
<div style="position:absolute;left:0px;top:646px;background:url(images/bg_bottom.png);width:1280px;height:74px;"></div>
</body>

<script type="text/javascript">
	page.domObjArr = (function(num){
		var arr = [];
		for(var i=0;i<num;i++){
			arr.push($("focusImage"+i));
		}
		return arr;
	})(6);
</script>
</html>
