<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=gb2312" />
<title>专题推荐</title>
<script type="text/javascript" src="js/common.js"></script>
<script type="text/javascript" src="js/DataCollection.js"></script>
<script type="text/javascript">
var menuDataUrl = "content.js";
var menuData = [];
var ajaxObj = null;
var position = 0;
var pageNum = 3;

var focusPos = [{
	"left": "240",
	"top" : "195",
	"div" : [61,90,391,240]
},{
	"left": "675",
	"top" : "525",
	"div" : [570,470,251,156]
},{
	"left": "970",
	"top" : "525",
	"div" : [864,470,251,156]
}];
var nodeAjaxObj = null;
var navStr = "";
	function getTitleData() {
  if(nodeAjaxObj != null){
    nodeAjaxObj.requestAbort();
  }
  nodeAjaxObj = new AjaxClass();
  nodeAjaxObj.frame = window;
  nodeAjaxObj.charset = "utf-8";
  nodeAjaxObj.successCallback = function(_xmlHttp, _params) {
    var jsonData = eval('(' + _xmlHttp.responseText + ')');
    if(typeof(jsonData) != "undefined" && jsonData.length > 0){
     navStr = jsonData;
    }
  };
  nodeAjaxObj.failureCallback = function(_xmlHttp, _params) {};
  nodeAjaxObj.url = "node.js";
  nodeAjaxObj.requestData();
}
var listType = "";
 navStr = navStr.replace(/ > /g,">");
	function getTitleData() {
		var title = navStr.split(">")[1]+"||"+ listType +"||" +navStr ;
				try{
					DataCollection.collectData(["01",location.href,document.referrer,title,"",""])
				}catch(e){};
	}
	
document.onkeydown = eventHandler;
function eventHandler(key){
  	var e = key || event;
  	var keycode = e.keyCode || e.which || e.charCode;
  	switch (keycode) {
    	case 87:   // up
    	case 38:
      		changeLR(-1);
      		return false;
      		break;
    	case 83:   // down
    	case 40:
     		changeLR(1);
      		return false;
      		break;
    	case 65:   // left
    	case 37:
      		changeLR(-1);
      		return false;
      		break;
    	case 68:   // right
    	case 39:
      		changeLR(1);
      		return false;
      		break;
    	case 13:
	 		doSelect();
      		return false;
      		break;
    	case 8:
      		goBack();
      		event.returnValue = false;
      		return false;
      		break;
    	case 27:
      		iSTB.browser.gotoSTB("tv");
      		event.returnValue = false;
      		return false;
     	 	break;
  }
}

function changeLR(_num) {
	clearFocus();
	if (position == 0 && _num < 0) {
		position = 2;
	}else if (position == 2 && _num > 0) {
		position = 0;
	}else{
		position = position + _num;
	}
	showFocus();
}

function doSelect() {
	var tmpPara = mySessionStorage.setItem("menuFoucs",position);
	window.location.href = menuData[position].videoUrl;
}

function goBack() {
	var navStrArr = navStr.split(">")
	navStr = navStrArr.slice(0,navStrArr.length-1).join(">");
	// this.navStr = this.navStr.substr(0,this.navStr.lastIndexOf(">"));
	mySessionStorage.setItem("navigator",navStr);
	navStr = mySessionStorage.getItem('navigator');
	navStr = navStr.replace(/ > /g,">");
			
	listType = "图文";
	getTitleData();
	mySessionStorage.removeItem("menuFoucs");
	window.location.href = "main://index.html";
}

function init() {
	getParams();
	getMenuData();
	
	listType = "图文";
	getTitleData();
}

function getParams() {
	var tmpPara = mySessionStorage.getItem("menuFoucs");
	if(tmpPara != ""){
		tmpPara = parseInt(tmpPara,10);
		position = tmpPara;
	} 
}

function getMenuData() {
	if(ajaxObj != null){
		ajaxObj.requestAbort();
	}
	ajaxObj = new AjaxClass();
	ajaxObj.frame = window;
	ajaxObj.charset = "utf-8";
	ajaxObj.successCallback = function(_xmlHttp, _params) {
		var jsonData = eval('(' + _xmlHttp.responseText + ')');
		if(typeof(jsonData) != "undefined" && jsonData.length > 0){
			menuData = jsonData;
			iDebug(menuData);
			initMenuData();
			showFocus();
		}
	};
	ajaxObj.failureCallback = function(_xmlHttp, _params) {};
	ajaxObj.url = menuDataUrl;
	ajaxObj.requestData();
}

function initMenuData() {
	if(menuData.length == 0){
		return;
	}
	$("focusDiv").style.visibility = "visible";
	$("title").innerHTML = menuData[menuData.length-1].title;
	$("content").innerHTML = menuData[menuData.length-1].content;
	for(var i = 0; i < pageNum; i++){
		if(i < menuData.length){
			$("poster_" + i).style.background = "url(" + menuData[i].entryImage.imageUrl + ")";
			if (menuData[i].date != "") {
				$("date_" + i).style.visibility = "visible";
				$("date_" + i).innerText = menuData[i].date;
			}	
		}else{
			$("poster_" + i).style.background = "url(images/global_tm.gif)";
			$("date_" + i).style.visibility = "hidden";
		}
	}
}

function showFocus() {
	$("focusDiv").style.visibility = "visible";
	$("playBtn").style.visibility = "visible";
	$("focusDiv").style.left = focusPos[position].div[0] + "px";
	$("focusDiv").style.top = focusPos[position].div[1] + "px";
	$("focusDiv").style.width = focusPos[position].div[2] + "px";
	$("focusDiv").style.height = focusPos[position].div[3] + "px";
	$("playBtn").style.left = focusPos[position].left + "px";
	$("playBtn").style.top = focusPos[position].top + "px";

}

function clearFocus() {
	$("focusDiv").style.visibility = "hidden";
	$("playBtn").style.visibility = "hidden";
}
</script>
</head>
<body style="background:url(images/bg.jpg) no-repeat;" onload="init()">
	<!--视频列表信息-->
	<div id="poster_0" style="position:absolute;left:92px;top:116px;width:334px;height:186px;">
		<div id="date_0" style="position:absolute;left:0px;top:156px;width:334px;height:30px;color:#fff;font-size:20px;text-align:center;line-height:30px;visibility: hidden;">
		</div>
	</div>
	<div id="title" style="position:absolute;left:472px;top:136px;color:#fff;font-size:35px;">		
	</div>
	<div id="content" style="position:absolute;left:472px;top:218px;color:#fff;font-size:20px;line-height:30px;">	
	</div>
	<div id="poster_1" style="position:absolute;left:590px;top:488px;background:url();width:214px;height:120px;">
		<div id="date_1" style="position:absolute;left:0px;top:90px;width:214px;height:30px;color:#fff;font-size:20px;text-align:center;line-height:30px;visibility: hidden;">
		</div>
	</div>
	<div id="poster_2" style="position:absolute;left:884px;top:488px;background:url();width:214px;height:120px;">
		<div id="date_2" style="position:absolute;left:0px;top:90px;width:214px;height:30px;color:#fff;font-size:20px;text-align:center;line-height:30px;visibility: hidden;">
		</div>
	</div>
	<!--焦点-->
	<img id="focusDiv" src="images/focus_broder.png" style="position:absolute;left:61px;top:90px;width: 391px;height: 240px;visibility: hidden;"/>
	<img id="playBtn" src="images/play_bar.png" style="position:absolute;left:240px;top:195px;"/>
</body>
</html>
