<!DOCTYPE html>
<html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<title>咨讯</title>
<script type="text/javascript" src="js/common.js"></script>
<script type="text/javascript" src="js/DataCollection.js"></script>
<script type="text/javascript" src="js/keyEvent.js"></script>
<script type="text/javascript">
var nodeAjaxObj = null;
var navStr = "";
	function getTitleData() {
  if(nodeAjaxObj != null){
    nodeAjaxObj.requestAbort();
  }
  nodeAjaxObj = new AjaxClass();
  nodeAjaxObj.frame = window;
  nodeAjaxObj.charset = "utf-8";
  nodeAjaxObj.successCallback = function(_xmlHttp, _params) {
    var jsonData = eval('(' + _xmlHttp.responseText + ')');
    if(typeof(jsonData) != "undefined" && jsonData.length > 0){
     navStr = jsonData;
    }
  };
  nodeAjaxObj.failureCallback = function(_xmlHttp, _params) {};
  nodeAjaxObj.url = "node.js";
  nodeAjaxObj.requestData();
}
var listType = "";
 navStr = navStr.replace(/ > /g,">");
 var msg = "";
	function getTitleData() {
		var title = navStr.split(">")[1]+"||"+ listType +"||" +navStr + ">" + msg;
				try{
					DataCollection.collectData(["01",location.href,document.referrer,title,"",""])
				}catch(e){};
	}
	
	function getBackTitleData() {
		var title = navStr.split(">")[1]+"||"+ listType +"||" +navStr ;
				try{
					DataCollection.collectData(["01",location.href,document.referrer,title,"",""])
				}catch(e){};
	}
function eventHandler(eventObj){
	iDebug(">>>eventHandler--eventObj.code="+eventObj.code);
	switch(eventObj.code){
		case "KEY_UP":
			page.changeUD(-1);
		return EVENT.STOP;
		break;
		case "KEY_DOWN":
			page.changeUD(1);
		return EVENT.STOP;	
		break;
		case "KEY_LEFT":
			page.changeLR(-1);
		return EVENT.STOP;
		break;
		case "KEY_RIGHT":
			page.changeLR(1);
		return EVENT.STOP;
		break;
		case "KEY_SELECT":
			page.doSelect();
		return EVENT.STOP;
		break;
		case "KEY_BACK":
		case "KEY_EXIT":
			page.goBack();
		return EVENT.STOP;
		break;
	}
	return eventObj.args.type;
}
	
var page = {
	focusArea:mySessionStorage.getItem("zx_focusArea")==""?0:parseInt(mySessionStorage.getItem("zx_focusArea"),10),
	menuData:[],
	ajaxObj:null,
	ajaxRootPath:"menu.js",
	ajaxData:function(){
		ajaxObj  = null;
		if (ajaxObj != null) {
			ajaxObj.requestAbort();
		}
		ajaxObj = new AjaxClass();
		ajaxObj.frame = window;
		ajaxObj.charset = "utf-8";
		ajaxObj.successCallback = function(_xmlHttp, _params) {
			var tempResult = eval("("+_xmlHttp.responseText+")");
			if(tempResult && tempResult.length>0){
				for(var i=0,len = tempResult.length;i<len;i++){
					var obj = {
						"name":tempResult[i].name,
						"enName":tempResult[i].enName,
						"subList":[],
						"isLoad":false
					};
					page.menuData.push(obj);
				}
				page.initMainBox();
			}else{
				iDebug(">>>ajaxData dataLen=0");
			}
		};
		ajaxObj.failureCallback = function(_xmlHttp, _params) {
			iDebug(">>>ajaxData--failBack");
		};
		ajaxObj.url = this.ajaxRootPath;
		iDebug(">>>ajaxData ajaxObj.url=" + ajaxObj.url);
		ajaxObj.requestData();
	},
	mainBox:null,
	leftColumnLen:10,
	leftMaxWord:8,
	mainPos:mySessionStorage.getItem("zx_mainPos")==""?0:parseInt(mySessionStorage.getItem("zx_mainPos"),10),
	mainDivArr : (function(step){
		var arr = [];
		for(var i=0;i<10;i++){
			arr.push({left:"8px", top:(step*i-15)+"px", width:"165px", height:"84px"});
		}
		return arr;
	})(47.5),		
	initMainBox:function(){
		if(this.menuData.length<=0)return;
		this.mainBox =  new showList2D(this.leftColumnLen,this.menuData.length,this.mainPos,300,window);
		this.mainBox.focusObj = this.mainDivArr;
		this.mainBox.isLoop   = true;
		this.mainBox.pageLoop = true;
		this.mainBox.focusDiv = "mainFocus";
		this.mainBox.haveData = function(_list){			
			$("mainItem"+_list.idPos).innerText = subStr(page.menuData[_list.dataPos].name,page.leftMaxWord-1,"...");
		};
		this.mainBox.notData = function(_list){
			$("mainItem"+_list.idPos).innerText = "";
		};
		this.mainBox.startShow(); 
		if(!this.menuData[this.mainBox.position].isLoad){
			this.ajaxSubData();
		}else{
			this.setFocus();
		}
	},
	ajaxSubData:function(){
		ajaxObj  = null;
		if (ajaxObj != null) {
			ajaxObj.requestAbort();
		}
		ajaxObj = new AjaxClass();
		ajaxObj.frame = window;
		ajaxObj.charset = "utf-8";
		ajaxObj.successCallback = function(_xmlHttp, _params) {
			var tempResult = eval("("+_xmlHttp.responseText+")");
			if(tempResult){
				for(var i=0,len = tempResult.length;i<len;i++){
					var obj = {
						"title":tempResult[i].title,
						"videoUrl":tempResult[i].videoUrl
					};
					page.menuData[page.mainBox.position].subList.push(obj);
				}
			}
			page.menuData[page.mainBox.position].isLoad = true;//已经加载过了
			page.initSubBox();
		};
		ajaxObj.failureCallback = function(_xmlHttp, _params) {
			page.menuData[page.mainBox.position].isLoad = true;
			iDebug(">>>ajaxSubData--failBack");
			$("subItem0").innerText = "请求失败!";
		};
		ajaxObj.url = this.menuData[this.mainBox.position].enName+"/content.js";
		iDebug(">>>ajaxSubData ajaxObj.url=" + ajaxObj.url);
		ajaxObj.requestData();
	},
	subBox:null,
	rightColumnLen:10,
	rightMaxWord:24,
	subPos:mySessionStorage.getItem("zx_subPos")==""?0:parseInt(mySessionStorage.getItem("zx_subPos"),10),
	subDivArr: (function(step){
		var arr = [];
		for(var i=0;i<10;i++){
			arr.push({left:"48px", top:(step*i+7)+"px", width:"523px", height:"42px"});
		}
		return arr;
	})(47.9),
	initSubBox:function(){
		this.clearAllSubItem();
		if(this.menuData[this.mainBox.position].subList && this.menuData[this.mainBox.position].subList.length<=0){
			this.focusArea = 0;
			this.setFocus();
			$("subItem0").innerText = "暂无数据";
		}
		this.subBox =  new showList2D(this.rightColumnLen,this.menuData[this.mainBox.position].subList.length,this.subPos,200,window);
		this.subBox.focusObj = this.subDivArr;
		this.subBox.isLoop   = true;
		this.subBox.pageLoop = true;
		this.subBox.focusDiv = "subFocus";
		this.subBox.haveData = function(_list){
			$("subItem"+_list.idPos).innerText = subStr(page.menuData[page.mainBox.position].subList[_list.dataPos].title,page.rightMaxWord,"...");
		};
		this.subBox.notData = function(_list){
			$("subItem"+_list.idPos).innerText = "";
		};
		this.subBox.startShow();
		this.initScrollBar();
		this.setFocus();
	},
	scrollBar:null,
	initScrollBar:function(){
		this.hideAndShowBar(1);
		this.scrollBar = new ScrollBar("barDiv", null, window);
		this.scrollBar.init(this.menuData[this.mainBox.position].subList.length,0,491,90);
		this.scrollBar.scroll(this.subBox.position);
	},
	setFocus:function(){
		if(this.focusArea == 0){
			$("mainFocus").style.webkitTransitionDuration = this.mainBox.time;
			$("mainFocus").style.visibility = "visible";
			$("subFocus").style.visibility = "hidden";
			$("icon"+this.subBox.currFocus).src = "images/global_tm.gif";
			$("subItem"+this.subBox.currFocus).style.color = "";
			$("subItem"+this.subBox.currFocus).style.fontSize = "";
			$("subItem"+this.subBox.currFocus).innerText = subStr(this.menuData[this.mainBox.position].subList[this.subBox.position].title,this.rightMaxWord-1,"...");
			if(getStrChineseLength(this.menuData[this.mainBox.position].name)>=this.leftMaxWord-1){
					$("mainItem"+this.mainBox.currFocus).innerHTML = "<marquee width=110>"+this.menuData[this.mainBox.position].name+"</marquee>";
			}
			$("mainItem"+this.mainBox.currFocus).style.color = "#fff";
			$("mainItem"+this.mainBox.currFocus).style.fontSize = "26px";
		}else if(this.focusArea == 1){
			$("subFocus").style.webkitTransitionDuration = this.subBox.time;
			$("mainFocus").style.visibility = "hidden";
			$("subFocus").style.visibility = "visible";
			$("icon"+this.subBox.currFocus).src = "images/icon_07.png";
			if(getStrChineseLength(this.menuData[this.mainBox.position].subList[this.subBox.position].title)>=this.rightMaxWord-1){
				$("subItem"+this.subBox.currFocus).innerHTML = "<marquee width=500>"+this.menuData[this.mainBox.position].subList[this.subBox.position].title+"</marquee>";
			}
			$("subItem"+this.subBox.currFocus).style.color = "#fff";
			$("subItem"+this.subBox.currFocus).style.fontSize = "22px";
			$("mainItem"+this.mainBox.currFocus).innerText = subStr(this.menuData[this.mainBox.position].name,this.leftMaxWord-1,"...");
			$("mainItem"+this.mainBox.currFocus).style.color = "";
			$("mainItem"+this.mainBox.currFocus).style.fontSize = "";
		}
	},
	changeLR:function(_num){
		if(this.focusArea == 0 && _num>0 && this.subBox){
			$("mainFocus").style.webkitTransitionDuration = "0ms";
			this.focusArea = 1;
			this.setFocus();
		}else if(this.focusArea == 1 && _num<0 && this.mainBox){
			$("subFocus").style.webkitTransitionDuration = "0ms";
			this.focusArea = 0;
			this.setFocus();
		}
	},
	changeUD:function(_num){
		if(this.focusArea == 0){
			if(this.mainBox){
				$("mainItem"+this.mainBox.currFocus).style.color = "";
				$("mainItem"+this.mainBox.currFocus).style.fontSize = "";
				$("mainItem"+this.mainBox.currFocus).innerText = subStr(this.menuData[this.mainBox.position].name,this.leftMaxWord-1,"...");
				this.mainBox.changeList(_num);
				if(getStrChineseLength(this.menuData[this.mainBox.position].name)>=this.leftMaxWord-1){
					$("mainItem"+this.mainBox.currFocus).innerHTML = "<marquee width=110>"+this.menuData[this.mainBox.position].name+"</marquee>";
				}
				$("mainItem"+this.mainBox.currFocus).style.color = "#fff";
				$("mainItem"+this.mainBox.currFocus).style.fontSize = "26px";
				this.subBox = null;
				this.subPos = 0;
				this.scrollBar = null;
				if(this.menuData[this.mainBox.position].isLoad){
					this.initSubBox();
				}else{
					this.clearAllSubItem();
					this.hideAndShowBar(0);
					this.ajaxSubData();
				}
			}
		}else if(this.focusArea == 1){
			if(this.subBox){
				$("icon"+this.subBox.currFocus).src = "images/global_tm.gif";
				$("subItem"+this.subBox.currFocus).innerText = subStr(this.menuData[this.mainBox.position].subList[this.subBox.position].title,this.rightMaxWord-1,"...");
				$("subItem"+this.subBox.currFocus).style.color = "";
				$("subItem"+this.subBox.currFocus).style.fontSize = "";
				this.subBox.changeList(_num);
				$("icon"+this.subBox.currFocus).src = "images/icon_07.png";
				if(getStrChineseLength(this.menuData[this.mainBox.position].subList[this.subBox.position].title)>=this.rightMaxWord-1){
					$("subItem"+this.subBox.currFocus).innerHTML = "<marquee width=500>"+this.menuData[this.mainBox.position].subList[this.subBox.position].title+"</marquee>";
				}
				$("subItem"+this.subBox.currFocus).style.color = "#fff";
				$("subItem"+this.subBox.currFocus).style.fontSize = "22px";
				this.scrollBar.scroll(this.subBox.position);
			}
		}
	},
	goBack:function(){//返回至portal
		mySessionStorage.removeItem("zx_focusArea");
		mySessionStorage.removeItem("zx_mainPos");
		mySessionStorage.removeItem("zx_subPos");
			var navStrArr = navStr.split(">")
			navStr = navStrArr.slice(0,navStrArr.length-1).join(">");
			// this.navStr = this.navStr.substr(0,this.navStr.lastIndexOf(">"));
			mySessionStorage.setItem("navigator",navStr);
			navStr = mySessionStorage.getItem('navigator');
			navStr = navStr.replace(/ > /g,">");
			listType = "栏目";
		// msg = navStr.split(">")[2];
			getBackTitleData();
		window.location.href = "main://index.html";
	},
	doSelect:function(){//进入播放
		if(this.focusArea == 1){
			mySessionStorage.setItem("zx_focusArea",this.focusArea);
			mySessionStorage.setItem("zx_mainPos",this.mainBox.position);
			mySessionStorage.setItem("zx_subPos",this.subBox.position);
			window.location.href = page.menuData[this.mainBox.position].subList[this.subBox.position].videoUrl;
		}
	},
	clearAllSubItem:function(){
		for(var i=0;i<this.rightColumnLen;i++){
			$("subItem"+i).innerText = "";
			$("icon"+i).src = "images/global_tm.gif";
		}
	},
	hideAndShowBar:function(__type){
		if(__type){
			$("scrollBarDiv").style.visibility = "visible";
			$("barDiv").style.visibility = "visible";
		}else{
			$("scrollBarDiv").style.visibility = "hidden";
			$("barDiv").style.visibility = "hidden";
		}
	},
	init:function(){
		page.ajaxData();
		listType = "栏目";
		getBackTitleData();
	}
}

window.onload = function(){
	page.init();
}

</script>
</head>
<body style="background:url(images/bg.jpg) no-repeat;">
	<!--标题信息-->
	<div style="position:absolute;left:85px;top:25px;color:#d2dce6;font-size:20px;">首页-中山/资讯</div>
	<img src="images/line_02.png" style="position:absolute;left:0px;top:55px;"/>
	<!--一级列表-->
	<div style="position:absolute;left:83px;top:97px;background:url(images/border_left_02.png);width:179px;height:510px;color:#d2dce6;font-size:22px;text-align:center;">
		<table border="0" cellpadding="0" cellspacing="0" width="179" height="293" align="center">
			<tr>
				<td height="52" id="mainItem0"></td>
			</tr>
			<tr>
				<td height="49" id="mainItem1">&nbsp;</td>
			</tr>
			<tr>
				<td height="48" id="mainItem2">&nbsp;</td>
			</tr>
			<tr>
				<td height="47" id="mainItem3">&nbsp;</td>
			</tr>
			<tr>
				<td height="48" id="mainItem4">&nbsp;</td>
			</tr>
			<tr>
				<td height="47" id="mainItem5">&nbsp;</td>
			</tr>
            <tr>
				<td height="47" id="mainItem6">&nbsp;</td>
			</tr>
            <tr>
				<td height="47" id="mainItem7">&nbsp;</td>
			</tr>
            <tr>
				<td height="47" id="mainItem8">&nbsp;</td>
			</tr>
            <tr>
				<td height="47" id="mainItem9">&nbsp;</td>
			</tr>
	  </table>
	  	<!--焦点-->
		<div id="mainFocus" style="position:absolute;left:8px;top:-15px;width:165px; height:84px; visibility:hidden"><img src="images/focus_border_03.png" /></div><!----focus_border_07-->
	</div> 
	<!--右侧信息--> 
	<div style="position:absolute;left:262px;top:97px;background:url(images/border_middle.png);width:590px;height:511px;color:#d2dce6;font-size:20px;">
		<table border="0" cellpadding="0" cellspacing="0" width="590" height="476" style="margin-left:50px;margin-top:10px;">
			<tr>
				<td id="subItem0" height="42">&nbsp;</td>
			</tr>
			<tr>
				<td id="subItem1" height="42">&nbsp;</td>
			</tr>
			<tr>
				<td id="subItem2" height="42">&nbsp;</td>
			</tr>
			<tr>
				<td id="subItem3" height="42">&nbsp;</td>
			</tr>
			<tr>
				<td id="subItem4" height="42">&nbsp;</td>
			</tr>
			<tr>
				<td id="subItem5" height="42">&nbsp;</td>
			</tr>
			<tr>
				<td id="subItem6" height="42">&nbsp;</td>
			</tr>
			<tr>
				<td id="subItem7" height="42">&nbsp;</td>
			</tr>
			<tr>
				<td id="subItem8" height="42">&nbsp;</td>
			</tr>
            <tr>
				<td id="subItem9" height="42">&nbsp;</td>
			</tr>
		</table>
        <div id="subFocus" style="position: absolute; left: 48px; top: 7px; width: 523px; height: 42px; border-radius: 5px; border: #F90 2px solid; opacity:0.9;visibility:hidden"></div>
		<!--小按钮-->
		<img src="" style="position: absolute; left: 20px; top: 15px;" id="icon0"/>
        <img src="" style="position: absolute; left: 20px; top: 63px;" id="icon1"/>
        <img src="" style="position: absolute; left: 20px; top: 113px;" id="icon2"/>
        <img src="" style="position: absolute; left: 20px; top: 161px;" id="icon3"/>
        <img src="" style="position: absolute; left: 20px; top: 206px;" id="icon4"/>
        <img src="" style="position: absolute; left: 20px; top: 254px;" id="icon5"/>
        <img src="" style="position: absolute; left: 20px; top: 300px;" id="icon6"/>
        <img src="" style="position: absolute; left: 20px; top: 347px;" id="icon7"/>
        <img src="" style="position: absolute; left: 20px; top: 395px;" id="icon8"/>
        <img src="" style="position: absolute; left: 20px; top: 444px;" id="icon9"/>
	</div>	
	<!--右侧信息-->
	<img src="images/ad0.png" style="position:absolute;left:888px;top:97px;"/>
	<img src="images/ad1.png" style="position:absolute;left:1054px;top:97px;"/>
	<img src="images/ad2.png" style="position:absolute;left:888px;top:362px;"/>
	<img src="images/ad3.png" style="position:absolute;left:1054px;top:362px;"/>
	<!--滑动条-->
	<div style="position:absolute;left:850px;top:97px; visibility:hidden" id="scrollBarDiv"><img src="images/line_05.png"/></div>
	<div style="position:absolute;left:842px;top:90px; visibility:hidden" id="barDiv"><img src="images/slide_bar.png" /></div>
	
	<!--底部信息-->
	<div style="position:absolute;left:0px;top:646px;background:url(images/bg_bottom.png);width:1280px;height:74px;">
		<span style="position:absolute;left:540px;top:15px;color:#d2dce6;font-size:20px;"><!--3月20日上午，2016年U互动广东省五人足球争霸赛揭幕战仪式在广州举行--></span>
		<img src="images/icon_04.png" style="position:absolute;left:1190px;top:14px;"/>
	</div>
</body>
</html>
