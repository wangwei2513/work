<!DOCTYPE html>
<html>
<head>
<meta charset="utf-8">
<title>基层党建内容页</title>
<script type="text/javascript" src="../js/common.js"></script>
<script type="text/javascript" src="js/keyevent.js"></script>
<script type="text/javascript">
//@denglc
document.onkeydown = eventHandler;
function eventHandler(e){
	var e = e || event;
	var keycode = e.keyCode || e.which || e.charCode;
	iDebug(">>>rcdj-->jcdj-->keycode:"+keycode);
	var eventObj = Event.mapping(keycode);
	switch(eventObj.code){
		case "KEY_UP":
			changeUD(-1);
			return false;
			break;
		case "KEY_DOWN":
			changeUD(1);
			return false;
			break;
		case "KEY_LEFT":
			changeLR(-1);
			return false;
			break;
		case "KEY_RIGHT":
			changeLR(1);
			return false;
			break;
		case "KEY_SELECT":
			doSelect();
			return false;
			break;
		case "KEY_EXIT":
		case "KEY_BACK":
			window.location.href = "../index.htm";
			return false;
			break;
	}
}
/**************************变量**************************/
var menuPos = 0;
var menuData = [];
var listPos = 0;
var contentData = [];
var currPage = 1;
var totalPage = 1;
var pageHeight = 368;
var scrollHeight = 368;
var ajaxObj = null;
var contentFile = "content.js";
var enName = "";
var nodeFile = "../node.js";
/**************************方法**************************/
function init(){
	initParams();
	ajaxContentList();
}

function initParams(){
	menuPos = parseInt(getUrlParams("menuPos"),10) || parseInt(getGlobalParms(enName+"_menuPos"),10) || parseInt(menuPos,10) || 0;
	listPos = parseInt(getUrlParams("listPos"),10) || parseInt(getGlobalParms(enName+"_listPos"),10) || parseInt(listPos,10) || 0;
}


function ajaxContentList(){
	if(ajaxObj == null){
		ajaxObj = new ajaxClass();
		ajaxObj.charset = "gbk";
		ajaxObj.frame = window;
	}
	else{
		ajaxObj.requestAbort();
	}

	var url = contentFile;
	ajaxObj.url = url;

	ajaxObj.successCallback = function(_xmlHttp){
		var getData = eval("("+_xmlHttp.responseText+")");
		contentData = getData;
		initContent();
	}

	ajaxObj.failureCallback = function(){
		;
	}

	ajaxObj.requestData();
}

function initContent(){
	clearContent();
	if(contentData.length > 0){
		$("title").innerText = contentData[listPos].title;
		$("content").innerHTML = contentData[listPos].content;
		var str = contentData[listPos].content;
		var pattern = new RegExp("<img[^<>]*?\\ssrc=['\"]?(.*?)['\"].*?>");
		if($("content").offsetHeight > 0){
			totalPage = Math.ceil($("content").offsetHeight/pageHeight);
		}
		while(pattern.test(str)){
			var img = new Image();
			img.src = pattern.exec(str)[1];
			img.onload = function(){
				if($("content").offsetHeight > 0){
					totalPage = Math.ceil($("content").offsetHeight/pageHeight);
				}
				//initPage();
			}
			str = str.replace(pattern.exec(str)[0],"");
		}
	}
	initScroll();
}

function clearContent(){
	$("title").innerText = "";
	$("content").innerHTML = "";
}

function initScroll(){
	if(totalPage <= 1){
		$("scrollBar").style.display = "none";
	}else{
		$("scrollBar").style.display = "block";
		$("curr").innerText = currPage;
		$("total").innerText = totalPage;
		$("scrollBar").style.top = Math.ceil(288 * (currPage-1) / (totalPage-1)) + 74 + "px";
	}
}

function changeUD(_num){
	if(contentData.length <= 0){return false;}
	
	if($("content").offsetTop <= 0 && $("content").offsetTop + $("content").offsetHeight >= 0){

		if((_num == -1 && currPage <= 1) || (_num == 1 && currPage >= totalPage)){return false;}
		var tmp = $("content").offsetTop - _num*scrollHeight;

		tmp = tmp > 0 ? 0 : tmp + $("content").offsetHeight < 0 ? -$("content").offsetHeight : tmp;
		$("content").style.top = tmp + "px";
		currPage = Math.floor(Math.abs($("content").offsetTop)/pageHeight) + 1;
		initScroll();
	}
}

function changeLR(_num){
	if(contentData.length <= 0){return false;}
}

function doSelect(){
	if(menuData.length <= 0){return false;}
}
</script>
</head>


<!--分界线、】】】】】】】】】】】】-->


<body style="background:url(images/bg4.jpg) no-repeat;" topmargin="0" leftmargin="0" onload="init();">
	<!--标题-->
	<div style="position:absolute;left:330px;top:53px; width:24px; height:28px;"><img src="images/arrow_title00.png" width="24" height="28"></div>
	<div style="position:absolute;left:389px;top:47px; font-size:28px;color:#e81010; font-family:微软雅黑; font-weight:bold;">新闻中心</div>
	
	<!--内容区-->
	<div style="position:absolute;left:59px;top:132px; width:1158px; height:512px; background:url(images/tab_zfbg3.png);">
		<div style="position:absolute;top:56px;width:1160px; height:1px; background:#a1c4de;"></div>
		<div id="title" style="position:absolute;top:0px; width:1162px; text-align:center;font-size:26px;color:#000; line-height:64px;"></div>
		<div style="position:absolute;left:23px;top:82px; width:1094px; height:368px;overflow:hidden">
      <div id="content" style=" position:absolute; top:0px; left:0px; width:100%; height:auto;font-size:22px;color:#000; text-align:justify; line-height:42px;"> 
      </div>  
    </div>
		<!--滚动条-->
		<div id="scrollBar" style="position:absolute;left:1136px;top:74px; width:8px; height:216px;">
			<div id="scroll0" style="position:absolute;top:0px; width:8px; height:10px;"><img src="images/page0_1.png" width="8" height="10"/></div>
			<div id="scroll1" style="position:absolute;top:17px; width:8px; height:101px; background:url(images/page0_2.png);"></div>
			<div id="scroll2" style="position:absolute;top:111px; width:8px; height:10px;"><img src="images/page0_3.png" width="8" height="10"/></div>
		</div>

    <!--上下键-->
      <div id="curr" style="position:absolute;left:806px;top:520px;width:30px;height:38px;line-height:38px;text-align:center;font-size:24px;color:#000000;">1</div>
      <div style="position:absolute;left:826px;top:520px;width:30px;height:38px;line-height:38px;text-align:center;font-size:24px;color:#000000;">/</div>
      <div id="total" style="position:absolute;left:846px;top:520px;width:30px;height:38px;line-height:38px;text-align:center;font-size:24px;color:#000000;"></div>
      <div id="newsCenterPrePage" style="position:absolute;left:906px;top:520px;width:118px;height:38px;background:url(images/pageUd.png);line-height:38px;text-align:center;font-size:24px;color:#000000;">上一页</div>
      <div id="newsCenterNextPage" style="position:absolute;left:1036px;top:520px;width:118px;height:38px;background:url(images/pageUd.png);line-height:38px;text-align:center;font-size:24px;color:#000000;">下一页</div>
	</div>
	
</body>



</html>