<!DOCTYPE html>
<html>
<head>
<meta charset="utf-8">
<title>基层党建内容页</title>
<script type="text/javascript" src="js/common.js"></script>
<script type="text/javascript" src="js/keyevent.js"></script>
<script type="text/javascript">
//@denglc
document.onkeydown = eventHandler;
function eventHandler(e){
	var e = e || event;
	var keycode = e.keyCode || e.which || e.charCode;
	iDebug(">>>rcdj-->jcdj-->keycode:"+keycode);
	var eventObj = Event.mapping(keycode);
	switch(eventObj.code){
		case "KEY_UP":
			changeUD(-1);
			return false;
			break;
		case "KEY_DOWN":
			changeUD(1);
			return false;
			break;
		case "KEY_LEFT":
			changeLR(-1);
			return false;
			break;
		case "KEY_RIGHT":
			changeLR(1);
			return false;
			break;
		case "KEY_SELECT":
			doSelect();
			return false;
			break;
		case "KEY_EXIT":
		case "KEY_BACK":
			window.location.href = "index.htm";
			return false;
			break;
	}
}
/**************************变量**************************/
var menuPos = 0;
var menuData = [];
var listPos = 0;
var contentData = [];
var currPage = 1;
var totalPage = 1;
var pageHeight = 360;
var scrollHeight = 360;

var ajaxObj = null;
var nodeFile = "node.js";
var file = "menu.js";
var contentFile = "content.js";
var enName = "";
/**************************方法**************************/
function init(){
	ajaxTitle();
}

function ajaxTitle(){
	if(ajaxObj == null){
		ajaxObj = new ajaxClass();
		ajaxObj.charset = "gbk";
		ajaxObj.frame = window;
	}
	else{
		ajaxObj.requestAbort();
	}

	var url = nodeFile;
	ajaxObj.url = url;
	
	ajaxObj.successCallback = function(_xmlHttp){
		var getData = eval("("+_xmlHttp.responseText+")");
		enName = getData.enName || enName;
		initParams();
		ajaxMenuList();
	}

	ajaxObj.failureCallback = function(){
		;
	}

	ajaxObj.requestData();
}

function initParams(){
	menuPos = parseInt(getUrlParams("menuPos"),10) || parseInt(getGlobalParms(enName+"_menuPos"),10) || parseInt(menuPos,10) || 0;
	listPos = parseInt(getUrlParams("listPos"),10) || parseInt(getGlobalParms(enName+"_listPos"),10) || parseInt(listPos,10) || 0;
}

function ajaxMenuList(){
	if(ajaxObj == null){
		ajaxObj = new ajaxClass();
		ajaxObj.charset = "gbk";
		ajaxObj.frame = window;
	}
	else{
		ajaxObj.requestAbort();
	}

	var url = file;
	ajaxObj.url = url;

	ajaxObj.successCallback = function(_xmlHttp){
		var getData = eval("("+_xmlHttp.responseText+")");
		menuData = getData;
		ajaxContentList();
	}

	ajaxObj.failureCallback = function(){
		;
	}

	ajaxObj.requestData();
}

function ajaxContentList(){
	if(!menuData[menuPos]){return false;}
	if(ajaxObj == null){
		ajaxObj = new ajaxClass();
		ajaxObj.charset = "gbk";
		ajaxObj.frame = window;
	}
	else{
		ajaxObj.requestAbort();
	}

	var url = menuData[menuPos].enName + '/' + contentFile;
	ajaxObj.url = url;

	ajaxObj.successCallback = function(_xmlHttp){
		var getData = eval("("+_xmlHttp.responseText+")");
		contentData = getData;
		initContent();
	}

	ajaxObj.failureCallback = function(){
		;
	}

	ajaxObj.requestData();
}

function initContent(){
	clearContent();
	if(contentData.length > 0){
		$("title").innerText = contentData[listPos].title;
		if(contentData[listPos].date){
			$("time").innerText = "发布日期：" + contentData[listPos].date;
		}
		$("content").innerHTML = contentData[listPos].content;
		var str = contentData[listPos].content;
		var pattern = new RegExp("<img[^<>]*?\\ssrc=['\"]?(.*?)['\"].*?>");
		if($("content").offsetHeight > 0){
			totalPage = Math.ceil($("content").offsetHeight/pageHeight);
		}
		while(pattern.test(str)){
			var img = new Image();
			img.src = pattern.exec(str)[1];
			img.onload = function(){
				if($("content").offsetHeight > 0){
					totalPage = Math.ceil($("content").offsetHeight/pageHeight);
				}
				initPage();
			}
			str = str.replace(pattern.exec(str)[0],"");
		}
	}
	initScroll();
}

function clearContent(){
	$("title").innerText = "";
	$("time").innerText = "";
	$("content").innerHTML = "";
}

function initScroll(){
	if(totalPage <= 1){
		$("scrollDiv").style.display = "none";
	}else{
		$("scrollDiv").style.display = "block";
		$("curr").innerText = currPage;
		$("total").innerText = totalPage;
		$("scrollBar").style.top = Math.ceil(361 * (currPage-1) / (totalPage-1)) + "px";
	}
}

function changeUD(_num){
	if(contentData.length <= 0){return false;}
	if($("content").offsetTop <= 0 && $("content").offsetTop + $("content").offsetHeight >= 0){
		if((_num == -1 && currPage <= 1) || (_num == 1 && currPage >= totalPage)){return false;}
		var tmp = $("content").offsetTop - _num*scrollHeight;
		tmp = tmp > 0 ? 0 : tmp + $("content").offsetHeight < 0 ? -$("content").offsetHeight : tmp;
		$("content").style.top = tmp + "px";
		currPage = Math.floor(Math.abs($("content").offsetTop)/pageHeight) + 1;
		initScroll();
	}
}

function changeLR(_num){
	if(contentData.length <= 0){return false;}
}

function doSelect(){
	if(menuData.length <= 0){return false;}
}
</script>
</head>
<body bgcolor="transparent" leftmargin="0" topmargin="0" onload="init()" style="background:url(images/bg.jpg) no-repeat;">
<!-- content -->
<div style="position:absolute;left:73px;top:83px;">
	<img src="images/right_bg.png" width="1141" height="532">
	<div id="title" style="position:absolute;width:1141px;top:34px;font-size:30px;color:#1657b2;text-align:center;"></div>
	<div id="time" style="position:absolute;width:1141px;top:84px;font-size:22px;color:#1657b2;text-align:center;"></div>
	<div style="position:absolute;width:1053px;height:1px;background-color:#90c2f3;left:25px;top:121px;"></div>
	<div id="wrap" style="position:absolute;width:1053px;height:360px;left:25px;top:139px;overflow:hidden;">
		<div id="content" style="position:absolute;"></div>
	</div>

	<div id="scrollDiv" style="position:absolute;left:1103px;top:29px;">
		<img src="images/line.png" width="4" height="422" style="position:absolute;">
		<div id="scrollBar" style="position:absolute;left:-13px;top:10px;">
			<img src="images/page.jpg" width="29" height="61" style="position:absolute;">
			<div id="curr" style="position:absolute;width:29px;height:27px;line-height:27px;font-size:24px;color:#ffffff;text-align:center;">1</div>
			<img src="images/sp.png" width="29" height="8" style="position:absolute;top:27px;">
			<div id="total" style="position:absolute;width:29px;height:27px;line-height:27px;top:35px;font-size:24px;color:#ffffff;text-align:center;">1</div>
		</div>
	</div>
</div>
<!-- bottom -->
<img src="images/icon01.png" width="37" height="27" style="position:absolute;left:71px;top:646px;"/>
<div id="notice" style="position:absolute;width:494px;left:116px;top:644px;font-size:26px;color:#0e415e;overflow:hidden;">明天任城会有大到小雨请相关部门做好相关</div>
<div style="position:absolute; left:742px; top:627px; width:469px; height:54px; ">
	<table width="100%" border="0" cellspacing="0" cellpadding="0" style="position:absolute;left:0px;top:0px;line-height:54px;font-size:25px;color:#12486b;">
		<tr>
	        <td width="54"><img src="images/icon02.png" width="54" height="54" style="display:block;" /></td>
	        <td width="113">选择 ，按</td>
	        <td width="76"><img src="images/icon03.png" width="72" height="54" style="display:block;" /></td>
	        <td width="101">进入，按</td>
	        <td width="73"><img src="images/icon04.png" width="72" height="54" style="display:block;" /></td>
	        <td width="51">返回</td>
		</tr>
    </table>
</div>
</body>
</html>