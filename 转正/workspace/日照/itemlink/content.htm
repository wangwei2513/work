<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=gb2312" />
<title>ȫͼƬ</title>
<script type="text/javascript" src="js/common.js"></script>
<script type="text/javascript">
var dataAjaxPath = "content.js";
var logoAjaxPath = "";
var navTitleAjaxPath = "node.js";
var cellPadValue = 10;

var ajaxObj = null;
var logoAjaxObj = null;
var menuData = [];
var itemPos = 0;
var imagePos = 0;

var displayAreaWidth  = 1080;
var displayAreaHeight = 488;

var backUrl = "index.htm?itemPos=";


document.onkeydown = eventHandler;
function eventHandler(key){
  var e = key || event;
  var keycode = e.keyCode || e.which || e.charCode;
  switch (keycode) {
    case 1:   // up
    case 38:
      //changeUD(-1);
      return false;
      break;
    case 2:   // down
    case 40:
      //changeUD(1);
      return false;
      break;
    case 3:   // left
    case 37:
      changeLR(-1);
      return false;
      break;
    case 4:   // right
    case 39:
      changeLR(1);
      return false;
      break;
    case 13:
      return false;
      break;
    case 8:
      goBack();
      event.returnValue = false;
      return false;
      break;
    case 27:
      iSTB.browser.gotoSTB("tv");
      event.returnValue = false;
      return false;
      break;
  }
}

function goBack(){
	window.location.href = backUrl+itemPos;
}

function changeLR(_num){
	if(menuData.length>0){
		imagePos = (imagePos + _num + menuData.length)%menuData.length;
		showImage();
	}
}

function init(){
	getParms();
	ajaxLoadMenuData();
	//ajaxLoadLogo();
	showTime();
}


function getParms(){
	var currLocation  = window.location.href;
	var tempItemPos = getUrlParams("itemPos",currLocation);
	if(tempItemPos!=""){
		itemPos = parseInt(tempItemPos,10);
	}
	//iDebug(">>>getParms--itemPos="+itemPos);
}

function ajaxLoadMenuData(){
	if (ajaxObj != null) {
		ajaxObj.requestAbort();
	}
	ajaxObj = new AjaxClass();
	ajaxObj.frame = window;
	ajaxObj.charset = "gbk";
	ajaxObj.successCallback = function(_xmlHttp, _params) {
		//iDebug(">>>ajaxLoadMenuData successCallback _xmlHttp.responseText=" + _xmlHttp.responseText);
		var jsonData = eval('(' + _xmlHttp.responseText + ')');
		if(typeof(jsonData) != "undefined" && jsonData[itemPos].albumImages.length > 0){
			menuData = jsonData[itemPos].albumImages;
			showImage();
		}else{
			noItemData();
		}
		ajaxNavTitle();
	};
	ajaxObj.failureCallback = function(_xmlHttp, _params) {
		//iDebug(">>>ajaxLoadMenuData failureCallback");
		noItemData();	
		ajaxNavTitle();
	};
	ajaxObj.url = dataAjaxPath;
	//iDebug(">>>ajaxLoadMenuData ajaxObj.url=" + ajaxObj.url);
	ajaxObj.requestData();
}

function ajaxNavTitle(){
	ajaxObj = null;
	if (ajaxObj != null) {
		ajaxObj.requestAbort();
	}
	ajaxObj = new AjaxClass();
	ajaxObj.frame = window;
	ajaxObj.charset = "gbk";
	ajaxObj.successCallback = function(_xmlHttp, _params) {
		//iDebug(">>>ajaxLoadMenuData successCallback _xmlHttp.responseText=" + _xmlHttp.responseText);
		var jsonData = eval('(' + _xmlHttp.responseText + ')');
		if(typeof(jsonData) != "undefined"){
			if(jsonData.navigator!=""){
				$("navTitle").innerText = jsonData.navigator;
				$("navTitle").style.left = (235+($("logoImage").width)+cellPadValue)+"px";
			}
		}else{}
	};
	ajaxObj.failureCallback = function(_xmlHttp, _params) {};
	ajaxObj.url = navTitleAjaxPath ;
	ajaxObj.requestData();
}


function showImage(){
	var image = new Image();
	image.onload = function(){
		if(displayAreaWidth > image.width){
			$("posterDiv").style.left = (displayAreaWidth-image.width)/2+"px";
			$("poster").width = image.width;
		}else{
			$("posterDiv").style.left = "0px";
			$("poster").width = displayAreaWidth;
		}
		if(displayAreaHeight > image.height){
			$("posterDiv").style.top = (displayAreaHeight-image.height)/2+"px";
			$("poster").height = image.height;
		}else{
			$("posterDiv").style.top = "0px";
			$("poster").height = displayAreaHeight;
		}
	}
	image.src = menuData[imagePos].imageUrl;
	$("poster").src = menuData[imagePos].imageUrl;
}

function noItemData(){
	$("leftArrow").style.visibility = "hidden";
	$("rightArrow").style.visibility = "hidden";
	$("poster").src = "images/global_tm.gif";
}

function ajaxLoadLogo(){
	if (logoAjaxObj != null) {
		logoAjaxObj.requestAbort();
	}
	logoAjaxObj = new AjaxClass();
	logoAjaxObj.frame = window;
	logoAjaxObj.charset = "gbk";
	logoAjaxObj.successCallback = function(_xmlHttp, _params){
		////iDebug(">>>ajaxLogoData successCallback _xmlHttp.responseText=" + _xmlHttp.responseText);
		var jsonData = eval('(' + _xmlHttp.responseText + ')');
		if(typeof(jsonData) != "undefined" && jsonData.length > 0){
			if(typeof jsonData[0].logoImageUrl!="undefined" && jsonData[0].logoImageUrl!=""){
				$("logoImage").src = jsonData[0].logoImageUrl;
			}else{
				$("logoImage").src = "images/global_tm.gif";
			}
		}else{
			$("logoImage").src = "images/global_tm.gif";
		}
	};
	logoAjaxObj.failureCallback = function(_xmlHttp, _params) {
		////iDebug(">>>ajaxLogoData failureCallback");
		$("logoImage").src = "images/global_tm.gif";
	};
	logoAjaxObj.url = logoAjaxPath;
	////iDebug(">>>ajaxLogoData logoAjaxObj.url=" + logoAjaxObj.url);
	logoAjaxObj.requestData();
}

function showTime(){
	var currTime = formatTime("yyyy-MM-dd hh:mm",new Date());
	$("time").innerText = currTime;
	setTimeout("showTime()",1000);
}

</script>
</head>

<body background="images/nr_bg.jpg" leftmargin="0" topmargin="0" onload="init()">
<div style="position: absolute; left: 230px; top: 32px;"><img id="logoImage" src="images/logo.png"/></div>
<div style="position: absolute; left: 367px; width: 844px; height: 49px; top: 32px; line-height: 49px; font-size: 27px" id="navTitle"></div>

<div style="position:absolute; left:749px; top:41px; width:466px; height:35px; font-size:24px; text-align:right;" id="time"></div>

<div style="position: absolute; left: 97px; top: 117px; width: 1080px; height: 488px" id="contentDiv">
	<div style="position: absolute; " id="posterDiv">
    	<img id="poster" src=""/>
    </div>
</div>

<div style="position: absolute; top: 364px; left: 66px; width: 21px; height: 23px;"><img src="images/left1.png" width="21" height="23" id="leftArrow"/></div>
<div style="position: absolute; top: 364px; left: 1187px; width: 21px; height: 23px; font-size: 28px;"><img src="images/right1.png" width="21" height="23" id="righttArrow"/></div>

</body>
</html>
