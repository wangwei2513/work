<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=gb2312" />
<title>无标题文档</title>
<style>
.mf { 
	position:absolute; 
	left:0px; 
	top:110px; 
	width:244px; 
	height:63px;
	background:url(images/mf01.png) no-repeat; 
	text-align:center; 
	padding-top:5px; 
	color:#a08e7c; 
	line-height:50px;
}
.column_txt0 {
	height:42px; 
	font-size:24px; 
	color:#000; 
	line-height:42px; 
	text-align:center; 
}
.mf1 {
	position:absolute; 
	left:0px; 
	top:110px; 
	width:245px; 
	height:82px; 
	background:url(images/mf01.png) no-repeat; 
	text-align:center; 
	color:#559013; 
	line-height:82px;
}
</style>
<script type="text/javascript" src="js/common.js"></script>
<script type="text/javascript">
var dataAjaxPath = "content.js";
var navTitleAjaxPath = "node.js";
var logoAjaxPath = "";
var ajaxObj = null;
var logoAjaxObj = null;

var cellPadValue = 10;
var itemLen = 8;
var itemMaxSize = 20;
var itemPos = 0;

var itemBox = null;
var scrollBox = null;
var menuData = [];
var havaBackUrl = false;
var backUrl = "../index.htm";

var adShowType = "right"; //广告位置--right:右侧(推荐)，left:左侧(暂无背景图)
var adElementPosition = {
	"left":{"adLeft":"62px","listLeft":"421px","scrollBarLeft":"1193px"},
	"right":{"listLeft":"62px","scrollBarLeft":"829px","adLeft":"880px"}
}

document.onkeydown = eventHandler;
function eventHandler(key){
  var e = key || event;
  var keycode = e.keyCode || e.which || e.charCode;
  switch (keycode) {
    case 1:   // up
    case 38:
      changeUD(-1);
      return false;
      break;
    case 2:   // down
    case 40:
      changeUD(1);
      return false;
      break;
    case 3:   // left
    case 37:
      return false;
      break;
    case 4:   // right
    case 39:
      return false;
      break;
    case 13:
      doSelect();
      return false;
      break;
    case 8:
      goBack();
      event.returnValue = false;
      return false;
      break;
    case 27:
      iSTB.browser.gotoSTB("tv");
      event.returnValue = false;
      return false;
      break;
  }
}

function changeUD(_num){
	if(itemBox!=null){
		clearFocus();
		itemBox.changeList(_num);
		showFocus();
		scrollBox.scroll(itemBox.position);
		showScrollPage();
	}
}

function doSelect(){
	if(itemBox!=null){
		mySessionStorage.setItem("itemPos",itemBox.position);
		window.location.href = menuData[itemBox.position].linkUrl;
	}
}

function goBack(){
	mySessionStorage.removeItem("itemPos");
	if(havaBackUrl){
		window.location.href = backUrl;
	}else{
		goPortal();
	}
}

function init(){
	getParms();
	showPage();
	ajaxLoadMenuData();
	//ajaxLoadLogo();
	showTime();
}

function getParms(){
	var tempItemPos = mySessionStorage.getItem("itemPos");
	if(tempItemPos!=""){
		itemPos = parseInt(tempItemPos,10);
	}
	//iDebug(">>>getParms--itemPos="+itemPos);
}

function showPage(){
	$("listDiv").style.left = adElementPosition[adShowType].listLeft;
	$("scrollBarDiv").style.left = adElementPosition[adShowType].scrollBarLeft;
	$("ad").style.left = adElementPosition[adShowType].adLeft;

	$("listDiv").style.visibility = "visible";
	$("scrollBarDiv").style.visibility = "visible";
	$("ad").style.visibility = "visible";
}

function ajaxLoadMenuData(){
	ajaxObj = null;
	if (ajaxObj != null) {
		ajaxObj.requestAbort();
	}
	ajaxObj = new AjaxClass();
	ajaxObj.frame = window;
	ajaxObj.charset = "gbk";
	ajaxObj.successCallback = function(_xmlHttp, _params) {
		////iDebug(">>>ajaxLoadMenuData successCallback _xmlHttp.responseText=" + _xmlHttp.responseText);
		var jsonData = eval('(' + _xmlHttp.responseText + ')');
		if(typeof(jsonData) != "undefined" && jsonData.length > 0){
			menuData = jsonData;
			showItem();
		}else{
			noItemData();
			initScroll();	
		}
		ajaxNavTitle();
		checkBackUrl();
	};
	ajaxObj.failureCallback = function(_xmlHttp, _params) {
		//iDebug(">>>ajaxLoadMenuData failureCallback");
		ajaxNavTitle();
		checkBackUrl();
		noItemData();	
	};
	ajaxObj.url = dataAjaxPath;
	//iDebug(">>>ajaxLoadMenuData ajaxObj.url=" + ajaxObj.url);
	ajaxObj.requestData();
}

function showItem(){
	itemBox = new showList(itemLen,menuData.length,itemPos,-65,window);
	itemBox.focusDiv  = "itemFocus";
	itemBox.listSign  = "top";
	itemBox.listHigh = 65;
	itemBox.focusLoop  = true; 
	itemBox.haveData = function(_list){
		$("item" + _list.idPos).innerHTML = subStr(menuData[_list.dataPos].title,itemMaxSize,"...");
	};
	itemBox.notData = function(_list){
		$("item" + _list.idPos).innerHTML = "";
	};
	itemBox.startShow();
	initScroll();
	//焦点位置
	clearFocus();
	showFocus();
}

function noItemData(){
	for(var i=0;i<itemLen;i++){
		if(i==0){
			$("item"+i).innerText = "暂无数据";
		}else{
			$("item"+i).innerText = "";
		}
	}
	$("itemFocus").style.visibility = "hidden";
}

function initScroll(){
	scrollBox = null;
	if(itemBox!=null){
		$("barDiv").style.visibility = "visible";
		listDataLength = menuData.length;
		scrollBox = new ScrollBar("barDiv", "barDiv", window);
		scrollBox.init(listDataLength, itemLen, 492, 0, 61);
		scrollBox.scroll(itemBox.position);
		showScrollPage();
	}else{
		noScrollBar();
	}
}

function showScrollPage(){
	if(itemBox!=null){
		$("currPage").innerText  = itemBox.position+1;
		$("totalPage").innerText = menuData.length;
	}
}

function noScrollBar(){
	$("barDiv").style.visibility = "hidden";
	$("currPage").innerText  = 0;
	$("totalPage").innerText = 0;
	scrollBox = null;
}

function ajaxNavTitle(){
	ajaxObj = null;
	if (ajaxObj != null) {
		ajaxObj.requestAbort();
	}
	ajaxObj = new AjaxClass();
	ajaxObj.frame = window;
	ajaxObj.charset = "gbk";
	ajaxObj.successCallback = function(_xmlHttp, _params) {
		//iDebug(">>>ajaxLoadMenuData successCallback _xmlHttp.responseText=" + _xmlHttp.responseText);
		var jsonData = eval('(' + _xmlHttp.responseText + ')');
		if(typeof(jsonData) != "undefined"){
			if(jsonData.navigator!=""){
				$("navTitle").innerText = jsonData.navigator;
				$("navTitle").style.left = (235+($("logoImage").width)+cellPadValue)+"px";
			}
		}else{}
	};
	ajaxObj.failureCallback = function(_xmlHttp, _params) {};
	ajaxObj.url = navTitleAjaxPath ;
	ajaxObj.requestData();
}

function checkBackUrl(){
	ajaxObj  = null;
	if (ajaxObj != null) {
		ajaxObj.requestAbort();
	}
	ajaxObj = new AjaxClass();
	ajaxObj.frame = window;
	ajaxObj.charset = "gbk";
	ajaxObj.successCallback = function(_xmlHttp, _params) {
		if(_xmlHttp.responseText == ""){
			havaBackUrl = false;
		}else{
			havaBackUrl = true;
		}
	};
	ajaxObj.failureCallback = function(_xmlHttp, _params) {
		havaBackUrl = false;
		//iDebug(">>>ajaxLoadMenuData failureCallback");
	};
	ajaxObj.url = backUrl;
	//iDebug(">>>ajaxLoadMenuData ajaxObj.url=" + ajaxObj.url);
	ajaxObj.requestData();
}


function clearFocus(){
	$("item"+itemBox.focusPos).style.color = "";
	$("item" + itemBox.focusPos).innerHTML = subStr(menuData[itemBox.position].title,itemMaxSize,"...");
}

function showFocus(){
	$("item"+itemBox.focusPos).style.color = "#ffffff";
	if(getStrChineseLength(menuData[itemBox.position].title)>itemMaxSize){
		$("item"+itemBox.focusPos).innerHTML = "<marquee direction=left width=540>"+menuData[itemBox.position].title+"</marquee>";
	}
}

function ajaxLoadLogo(){
	if (logoAjaxObj != null) {
		logoAjaxObj.requestAbort();
	}
	logoAjaxObj = new AjaxClass();
	logoAjaxObj.frame = window;
	logoAjaxObj.charset = "gbk";
	logoAjaxObj.successCallback = function(_xmlHttp, _params){
		////iDebug(">>>ajaxLogoData successCallback _xmlHttp.responseText=" + _xmlHttp.responseText);
		var jsonData = eval('(' + _xmlHttp.responseText + ')');
		if(typeof(jsonData) != "undefined" && jsonData.length > 0){
			if(typeof jsonData[0].logoImageUrl!="undefined" && jsonData[0].logoImageUrl!=""){
				$("logoImage").src = jsonData[0].logoImageUrl;
			}else{
				$("logoImage").src = "images/global_tm.gif";
			}
		}else{
			$("logoImage").src = "images/global_tm.gif";
		}
	};
	logoAjaxObj.failureCallback = function(_xmlHttp, _params) {
		////iDebug(">>>ajaxLogoData failureCallback");
		$("logoImage").src = "images/global_tm.gif";
	};
	logoAjaxObj.url = logoAjaxPath;
	////iDebug(">>>ajaxLogoData logoAjaxObj.url=" + logoAjaxObj.url);
	logoAjaxObj.requestData();
}

function showTime(){
	var currTime = formatTime("yyyy-MM-dd hh:mm",new Date());
	$("time").innerText = currTime;
	setTimeout("showTime()",1000);
}
</script>
</head>

<body background="images/tm_bg.jpg" leftmargin="0" topmargin="0" onload = "init();">
<div style="position: absolute; left: 230px; top: 32px;">
	<img id="logoImage" src="images/logo.png"/>
</div>
<div style="position: absolute; left: 367px; width: 844px; height: 49px; top: 32px; line-height: 49px; font-size: 27px" id="navTitle"></div>
<div style="position: absolute; left: 749px; top: 41px; width: 466px; height: 35px; font-size: 24px; text-align: right;" id="time"></div>
<!--推荐-->
<div style="position: absolute; left: 62px; top: 164px; width: 766px; height: 391px; visibility:hidden" id="listDiv">
	<!--background-image: url(images/line1.png); layer-background-image: url(line1.png); border: 1px none #000000;-->
	<div style="position: absolute; left: 0px; top: -65px; width: 753px; height: 64px; background-color: #e28a0d; layer-background-color: #e28a0d; border: 1px none #000000;" id="itemFocus"></div>
	<div style="position: absolute; left: 24px; top: -66px; width: 706px; height: 61px;">
		<table width="100%" border="0" cellspacing="0" cellpadding="0" style="font-size:26px; line-height:65px; color:#3f3f3f;">
			<tr>
				<td width="100%" id="item0">&nbsp;</td>
			</tr>
			<tr>
				<td id="item1">&nbsp;</td>
			</tr>
			<tr>
				<td id="item2">&nbsp;</td>
			</tr>
			<tr>
				<td id="item3">&nbsp;</td>
			</tr>
			<tr>
				<td id="item4">&nbsp;</td>
			</tr>
			<tr>
				<td id="item5">&nbsp;</td>
			</tr>
			<tr>
				<td id="item6">&nbsp;</td>
			</tr>
			<tr>
				<td id="item7">&nbsp;</td>
			</tr>
		</table>
	</div>
</div>
<!--条目-->
<!--游走字幕-->
<div style="position: absolute; left: 829px; top: 120px; width: 3px; height: 492px; background-color: #828282; visibility:hidden" id="scrollBarDiv">
	<div style="position:absolute; left:-12px; top:40px; width:29px; height:61px; background-image: url(images/page.png); " id="barDiv">
		<div style="position:absolute; left:0px; top:0px; width:29px; height:29px; font-size:24px; color:#ffffff; text-align:center;" id="currPage"></div>
		<div style="position:absolute; left:0px; top:31px; width:29px; height:29px; font-size:24px; color:#ffffff; text-align:center;" id="totalPage"></div>
	</div>
</div>
<div style="position:absolute; left:880px; top:99px; width:100px; height:100px; visibility:hidden" id="ad">
	<img src="images/ad.jpg" width="340" height="522" />
</div>
</body>
</html>
