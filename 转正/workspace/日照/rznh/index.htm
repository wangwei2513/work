<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=gb2312" />
<title>日照南湖</title>
<script type="text/javascript" src="js/common.js"></script>
<script type="text/javascript">
window.onkeydown = function(e){
	var e = e || event;
	var keycode = e.keyCode || e.which || e.charCode;
	console.log(keycode);
	switch(keycode){
		case 1:
		case 38: 	//up
			if(isFullScreen){return false;}
            if(!volumePlayFlag){
                changeUD(-1);
            }
			return EVENT.STOP;
			break;
		case 2:
		case 40: 	//down
			if(isFullScreen){return false;}
            if(!volumePlayFlag){
                changeUD(1);
            }
			return EVENT.STOP;
			break;
		case 3:
		case 37: 	//left
			if(isFullScreen){
				if(volumePlayFlag){
					try{
						var volume =  iSTB.player.get_volume();
						if(volume <= 1){
							volume = 0;
						}else{
						    volume -= 1;
						}
						iSTB.player.set_volume(volume);
						showVolume();
                        if(muteFlag){
                            hideMute();
                        }
					}
					catch(e){}
				}
				else{
					showVolume();
				}
			}
			else{
				if(volumePlayFlag){
					try{
                        var volume =  iSTB.player.get_volume();
                        if(volume <= 1){
                            volume = 0;
                        }else{
                            volume -= 1;
                        }
                        iSTB.player.set_volume(volume);
                        showVolume();
                        if(muteFlag){
                            hideMute();
                        }
                    }
                    catch(e){}
				}
				else{
					changeLR(-1);
				}
			}
			return EVENT.STOP;
			break;
		case 4:
		case 39: 	//right
			if(isFullScreen){
				if(volumePlayFlag){
					try{
						var volume =  iSTB.player.get_volume();
						if(volume >= 31){
							volume = 32;
						}else{
					        volume += 1;
						}
						iSTB.player.set_volume(volume);
						showVolume();
                        if(muteFlag){
                            hideMute();
                        }
					}
					catch(e){}
				}
				else{
					showVolume();
				}
			}
			else{
				if(volumePlayFlag){
					try{
						var volume =  iSTB.player.get_volume();
						if(volume >= 31){
							volume = 32;
						}else{
					        volume += 1;
						}
						iSTB.player.set_volume(volume);
						showVolume();
                        if(muteFlag){
                            hideMute();
                        }
					}
					catch(e){}
				}
				else{
					changeLR(1);
				}
			}
			return EVENT.STOP;
			break;
		case 48:
		case 66:
			if(!volumePlayFlag){
				showVolume();
            }
            else{
                hideVolume();
            }
			return EVENT.STOP;
			break;
        case 77:
            if(muteFlag == false){
                showMute();
            }else{
                hideMute();
            }
            return EVENT.STOP;
            break;
		case 13: 	//enter
			if(isFullScreen){return false;}
			doSelect();
			return EVENT.STOP;
			break;
		case 8:
		case 340: 	//back
			if(isFullScreen){
				document.body.background = "images/bg.png";
				$("wrap").style.display = "block";
				isFullScreen = false;
				try{
					iSTB.player.set_video_window(702,191,525,364);
				}
				catch(e){}	
			}
			else{
	            if(mySessionStorage.getItem("platformUrl")){
	                var backUrl = mySessionStorage.getItem("platformUrl");
	                mySessionStorage.removeItem("platformUrl");
	                window.location.href = backUrl;
	            }
                else{
                    iSTB.browser.gotoSTB("tv");
                    event.returnValue = false;
                }
			}
			return EVENT.STOP;
			break;
		case 27:
		case 339: 	//exit
            iSTB.browser.gotoSTB("tv");
            event.returnValue = false;
			return EVENT.STOP;
			break;
	}
}
/**********************变量**********************/
//滚动文字
var marqueeText =  "按0键调出音量调节菜单，左右键调节音量。欢迎进入南湖镇智慧党建！";	
//窗口视频地址
var playUrl = "http://10.191.150.105/spwj/nhspwj/nhsysp.mpg";

var menuData = [];
var listPos = 0;
var focusArea = 0;
var currPage = 1;
var totalPage = 1;
var pageSize = 6;

var ajaxObj = null;
var file = "menu.js";
var isFullScreen = false;
var muteFlag = false;
/**********************方法**********************/
function init(){
	initParams();
	initTime();
	initMarquee();
	ajaxMenuList();
	openVideo(playUrl);
}

function initParams(){
	if(mySessionStorage.getItem("rznh_isVideo")){
		focusArea = 1;
	}
	if(mySessionStorage.getItem("rznh_listPos")){
		var pos = parseInt(mySessionStorage.getItem("rznh_listPos"),10);
		listPos = pos % pageSize;
		currPage = Math.floor(pos/pageSize) + 1;
	}
}

function initTime(){
	var date = new Date();
	$("date").innerHTML = formatTime("yyyy-MM-dd W",date) + "<br/>" + formatTime("hh:mm:ss",date);
	setTimeout(initTime,1000);
}

function initMarquee(){
	$("marqueeDiv").innerHTML = "<marquee>"+marqueeText+"</marquee>";
}

function ajaxMenuList(){
	if(ajaxObj == null){
		ajaxObj = new ajaxClass();
		ajaxObj.charset = "gbk";
		ajaxObj.frame = window;
	}
	else{
		ajaxObj.requestAbort();
	}

	var url = file;
	ajaxObj.url = url;

	ajaxObj.successCallback = function(_xmlHttp){
		var getData = eval("("+_xmlHttp.responseText+")");
		menuData = getData;
		initContent();
		onFocus();
	}

	ajaxObj.failureCallback = function(){
		initContent();
		onFocus();
	}

	ajaxObj.requestData();
}

function initContent(){
	clearContent();
	if(menuData.length > 0){
		totalPage = Math.ceil(menuData.length/pageSize);
		for(var i=0;i<Math.min(pageSize,menuData.length-(currPage-1)*pageSize);i++){
			$("list"+i).style.display = "block";
			$("list"+i).src = menuData[i+(currPage-1)*pageSize].focusImageUrl;
		}
	}
}

function clearContent(){
	for(var i=0;i<pageSize;i++){
		$("list"+i).style.display = "none";
		$("list"+i).src = "";
	}
}

function onFocus(){
	switch(focusArea){
		case 0:
			onListFocus();
			break;
		case 1:
			onVideoFocus();
			break;
		default:
			break;
	}
}

function onListFocus(){
	var r = Math.floor(listPos/(pageSize/2));
	var l = listPos % (pageSize/2);
	$("focus").src = "images/focus0.png";
	$("focus").width = "210";
	$("focus").height = "196";
	$("focus").style.left = 35 + l*210 + "px";
	$("focus").style.top = 175 + r*200 + "px";
	var pos = listPos + (currPage-1)*pageSize;
	mySessionStorage.setItem("rznh_listPos",pos);
}

function onVideoFocus(){
	$("focus").src = "images/focus1.png";
	$("focus").width = "545";
	$("focus").height = "384";
	$("focus").style.left = "692px";
	$("focus").style.top = "181px";
}

function changeUD(_num){
	if(focusArea == 0){
		if(menuData.length <= 0){return false;}
		if((listPos >= 0 && listPos < pageSize/2 && _num == -1 && currPage > 1) || (listPos >= pageSize/2 && listPos < pageSize && _num == 1 && currPage < totalPage)){
			currPage+=_num;
			initContent();
		}
		listPos = (listPos + _num*(pageSize/2) + pageSize) % pageSize;
		listPos = listPos + (currPage-1)*pageSize >= menuData.length ? (menuData.length-1) % pageSize : listPos;
		onListFocus();
	}
}

function changeLR(_num){
	if(focusArea == 0){
		if(menuData.length <= 0){return false;}
		if((listPos % (pageSize/2) == (pageSize/2)-1 || listPos + (currPage-1)*pageSize == menuData.length - 1) && _num == 1){
			changeArea(1);
		}
		else{
			if(listPos == 0 && _num == -1 && currPage == 1){
				;
			}
			else if(listPos % (pageSize/2) == 0 && _num == -1 && currPage > 1){
				currPage--;
				initContent();
			}
			else{
				listPos+=_num;
			}
			listPos = listPos + (currPage-1)*pageSize >= menuData.length ? (menuData.length-1)%pageSize : listPos;
			onListFocus();
		}
	}
	else if(focusArea == 1){
		if(_num == -1 && menuData.length > 0){
			if(mySessionStorage.getItem("rznh_listPos")){
				var pos = parseInt(mySessionStorage.getItem("rznh_listPos"),10);
				listPos = pos % pageSize;
			}
			else{
				listPos = menuData.length >= 3 ? 2 : (menuData.length-1)%pageSize;
			}
			changeArea(0);
		}
	}
}

function changeArea(_num){
	focusArea = _num;
	onFocus();
}

function doSelect(){
	if(focusArea == 0){
		if(menuData.length <= 0){return false;}
		var tmp = listPos + (currPage-1)*pageSize;
		if(menuData[tmp].clickable == 1){
			if(menuData[tmp].linkUrl != ""){
				window.location.href = menuData[tmp].linkUrl + "?backUrl=" + window.location.href;
			}
			else{
				window.location.href = menuData[tmp].enName + "/index.htm";
			}
		}
	}
	else if(focusArea == 1){
		if(!isFullScreen){
			document.body.background = "";
			$("wrap").style.display = "none";
			isFullScreen = true;
			try{
				iSTB.player.set_video_window(0,0,1280,720);
			}
			catch(e){}
		}
	}
}

function openVideo(url){
	try{
		iSTB.player.play(url);
		iSTB.player.set_video_window(702,191,525,364);
	}
	catch(e){}
}

/*显示音量条*/
var volumeTimeout = -1;
var volumePlayFlag = false;
function showVolume(){
	clearTimeout(volumeTimeout);
	$("volBar").style.visibility = "visible";
	volumePlayFlag = true;
	try{
		var currVolume = parseInt(iSTB.player.get_volume(), 10);
		$("volProcess").style.width = Math.floor(parseInt(currVolume,10)/32*547) + "px";
		$("volPoint").style.left = 90 + Math.floor(parseInt(currVolume,10)/32*547) + "px";
		$("volWidth").width = Math.floor(parseInt(currVolume,10)/32*547) - 20 + "px";
		$("volValue").innerText = currVolume;
	}catch(e){
		
	}
	volumeTimeout = setTimeout('hideVolume();',7000);
}

function hideVolume(){
	volumePlayFlag = false;
	$("volBar").style.visibility = "hidden";
}

function showMute(){
    muteFlag = true;
    document.getElementById("mute_div").style.visibility = "visible";
    try{
        iSTB.player.mute();
    }
    catch(e){}
}

function hideMute(){
    muteFlag = false;
    document.getElementById("mute_div").style.visibility = "hidden";
    try{
        iSTB.player.unmute();
    }
    catch(e){}
}

try{iSTB.evt.set_event_callback("eventCallback");}catch(e){}
function eventCallback(type,event_name,event_type,event_value){
    switch(event_name){
		case "PLAYER_FINISH":
			exit();
			openVideo(playUrl);
			break;
	}
}

function exit(){
	try{
		iSTB.player.unmute();
		iSTB.player.stop();
	}
	catch(e){}
}
</script>
</head>
<body background="images/bg.png" bgcolor="transparent" topmargin="0" leftmargin="0" onload="init()" onunload="exit()">
<div id="wrap" style="position:absolute;">
	<!-- 时间日期 -->
	<div id="date" style="position:absolute;width:250px;height:55px;left:975px;top:67px;font-size:25px;color:#fff;text-align:right;"></div>
	<!-- 内容区 -->
	<img id="list0" src="" width="200" height="186" style="position:absolute;left:40px;top:180px;">
	<img id="list1" src="" width="200" height="186" style="position:absolute;left:250px;top:180px;">
	<img id="list2" src="" width="200" height="186" style="position:absolute;left:460px;top:180px;">
	<img id="list3" src="" width="200" height="186" style="position:absolute;left:40px;top:380px;">
	<img id="list4" src="" width="200" height="186" style="position:absolute;left:250px;top:380px;">
	<img id="list5" src="" width="200" height="186" style="position:absolute;left:460px;top:380px;">
	<!-- 焦点 -->
	<img id="focus" src="images/focus0.png" width="210" height="196" style="position:absolute;left:35px;top:175px;">
	<!-- 滚动文字 -->
	<div id="marqueeDiv" style="position:absolute;width:465px;height:50px;line-height:50px;left:130px;top:658px;font-size:28px;color:#fff;"></div>
</div>

<div id="volBar" style="position:absolute; left:272px; top:563px; width:744px; height:141px; background:url(images/volume_btm.png) no-repeat left top; visibility:hidden;">
    <div id="volProcess" style="position:absolute; left:107px; top:63px; width:0px; height:16px;">
      	<table width="100%" height="100%" border="0" cellspacing="0" cellpadding="0">
        	<tr>
          		<td width="10" height="16" style="background:url(images/volume_bar1.png) no-repeat left center;"></td>
          		<td  id="volWidth" style="background:url(images/volume_bar2.png) repeat-x;"></td>
          		<td width="10" style="background:url(images/volume_bar3.png) no-repeat left center;"></td>
        	</tr>
      	</table>
    </div>
    <div id="volPoint" style="position:absolute; left:88px; top:54px; width:33px; height:33px;"><img src="images/volume_cursor.png" width="33" height="33" /></div>
    <div id="volValue" style="position:absolute; left:657px; top:56px; width:45px; height:30px; font-size:24px; color:#fff; line-height:30px; text-align:center;">22</div>
</div>

<!--静音图标-->
<div id="mute_div" style="position: absolute; left: 1068px; top: 41px; width: 69px; height: 70px; background-image: url(images/jingyin.gif); visibility: hidden;"></div>
</body>
</html>