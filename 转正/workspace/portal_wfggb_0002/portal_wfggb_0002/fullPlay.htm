<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=gb2312" />
<title>全屏播放页面</title>


<script>
document.onkeydown = eventHandler;

function eventHandler(key){
	var e = key || event;
	var keycode = e.keyCode || e.which ||e.charCode;
	switch(keycode){
		case 3:
		case 37:
			var volume =  iSTB.player.get_volume();
			if(volume <= 1){
				volume = 0;
			}else {
			  volume -= 1;
			}
			iSTB.player.set_volume(volume);
			showVolume();
			return false;
			break;
		case 4:
		case 39:
		    var volume =  iSTB.player.get_volume();
			if(volume >= 31){
				volume = 32;
			}else{
				volume += 1;
			}
		    iSTB.player.set_volume(volume);
			showVolume();
		return false;
		break;
		case 8:
		case 27:
		    event.returnValue = false;
		    window.location.href = "city.html";
		    break;
		
	}
}


var playUrl = "";
var url = window.location.href;

function  init(){
	getPara();
	initVideo();
}

function getPara(){
	if(url.indexOf("?") != -1){
		playUrl = url.split("?")[1];
	}
}

/*初始化视频相关信息*/
function initVideo(){

	try{
		iSTB.player.play(playUrl);
		iSTB.player.set_video_window(0,0,1280,720);
	}catch( E ){}
}

function exitPage(){
	try	{
		iSTB.player.stop();
	}catch( E ){}
}

function eventCallback(type, event_name, event_type, event_value){
	switch(event_name){
		 case "PLAYER_FINISH": // 播放结束;
		     iSTB.player.stop();
             initVideo();
			  break;
		  case "PLAYER_BUFFERING_END": // 播放开始
		
			  break;
		  case "PLAYER_ERROR": // 播放出错
			  
			  break;
		  case "EVENT_NETWORK_STATUS": //网络断开
			
			  break;
		
	}
}

iSTB.evt.set_event_callback("eventCallback"); 


var volumeTimeout = -1;

/*显示音量条*/
function showVolume(){
	clearTimeout(volumeTimeout);
	document.getElementById("volBar").style.visibility = "visible";
	var currVolume = parseInt(iSTB.player.get_volume(), 10);
	document.getElementById("volProcess").style.width = Math.floor(parseInt(currVolume,10)/32*547) + "px";
	document.getElementById("volPoint").style.left = 90 + Math.floor(parseInt(currVolume,10)/32*547) + "px";
	document.getElementById("volWidth").width = Math.floor(parseInt(currVolume,10)/32*547) - 20 + "px";
	document.getElementById("volValue").innerText = currVolume;
	volumeTimeout = setTimeout('hideVolume();',7000);
}

function hideVolume(){
	document.getElementById("volBar").style.visibility = "hidden";
}


</script>
</head>

<body bgcolor="transparent"  onload="init()" onunload="exitPage()">
  <!--音量条-->
<div id="volBar" style="position:absolute; left:272px; top:563px; width:744px; height:141px; background:url(image/volume_btm.png) no-repeat left top; visibility:hidden;">
  <div id="volProcess" style="position:absolute; left:107px; top:63px; width:0px; height:16px;">
    <table width="100%" height="100%" border="0" cellspacing="0" cellpadding="0">
      <tr>
        <td width="10" height="16" style="background:url(image/volume_bar1.png) no-repeat left center;"></td>
        <td  id="volWidth" style="background:url(image/volume_bar2.png) repeat-x;"></td>
        <td width="10" style="background:url(image/volume_bar3.png) no-repeat left center;"></td>
      </tr>
    </table>
  </div>
  <div id="volPoint" style="position:absolute; left:88px; top:54px; width:33px; height:33px;"><img src="image/volume_cursor.png" width="33" height="33" /></div>
  <div id="volValue" style="position:absolute; left:657px; top:56px; width:45px; height:30px; font-size:24px; color:#fff; line-height:30px; text-align:center;">22</div>
</div>


</body>
</html>
