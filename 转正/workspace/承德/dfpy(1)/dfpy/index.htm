<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=gb2312" />
<title>党风评议</title>
<script type="text/javascript" src="js/config.js"></script>
<script type="text/javascript" src="js/common.js"></script>
<script type="text/javascript">
window.onkeydown = function(e){
	var e = e || event;
	var keycode = e.keyCode || e.which || e.charCode;
	switch(keycode){
		case 1:
		case 38: 	//up
			changeUD(-1);
			return EVENT.STOP;
			break;
		case 2:
		case 40: 	//down
			changeUD(1);
			return EVENT.STOP;
			break;
		case 3:
		case 37: 	//left
			changeLR(-1);
			return EVENT.STOP;
			break;
		case 4:
		case 39: 	//right
			changeLR(1);
			return EVENT.STOP;
			break;
		case 13: 	//enter
			doSelect();
			return EVENT.STOP;
			break;
		case 8:
		case 340: 	//back
			// window.location.href = "http://10.191.150.104:8080/appcms/app/rzdgnhz/jdgl/index.htm";
			// mySessionStorage.removeItem("dfpy_listPos");
			gotoPortal();
			return EVENT.STOP;
			break;
		case 27:
		case 339: 	//exit
			return EVENT.STOP;
			break;
	}
}
/**********************变量**********************/
var menuData = [];
var listPos = 0;
var focusArea = 0;
var currPage = 1;
var totalPage = 1;
var pageSize = 6;

var ajaxObj = null;

var stbid = "";
var card = "";
var areaId = "4";			//区域码
/**********************方法**********************/
function init(){
	initParams();
	ajaxAreaId();
}

function initParams(){
	if(mySessionStorage.getItem("dfpy_listPos")){
		var pos = parseInt(mySessionStorage.getItem("dfpy_listPos"),10);
		listPos = pos % pageSize;
		currPage = Math.floor(pos/pageSize) + 1;
	}
}

function ajaxAreaId(){
	//原本正常逻辑这里应该是通过stbid或者card拿到区域信息（区域码），但是目前没有接口，所以先写死
	ajaxQuestionList();
}

function ajaxQuestionList(){
	if(ajaxObj == null){
		ajaxObj = new ajaxClass();
		ajaxObj.charset = "utf-8";
		ajaxObj.frame = window;
	}
	else{
		ajaxObj.requestAbort();
	}

	var url = Api.getQuestionList;
	url = url.replace("{0}",areaId);
	ajaxObj.url = url;

	ajaxObj.successCallback = function(_xmlHttp){
		var getData = eval("("+_xmlHttp.responseText+")");
		menuData = getData;
		initContent();
		onFocus();
	}

	ajaxObj.failureCallback = function(){
		initContent();
		onFocus();
	}

	ajaxObj.requestData();
}

function initContent(){
	clearContent();
	if(menuData.length > 0){
		totalPage = Math.ceil(menuData.length/pageSize);
		for(var i=0;i<Math.min(pageSize,menuData.length-(currPage-1)*pageSize);i++){
			$("list"+i).innerText = getStrChineseLen(menuData[i+(currPage-1)*pageSize].name,25);
		}
	}
	$("cur").innerText = currPage;
	$("total").innerText = totalPage;
}

function clearContent(){
	for(var i=0;i<pageSize;i++){
		$("list"+i).innerText = "";
	}
}

function onFocus(){
	switch(focusArea){
		case 0:
			onContentFocus();
			break;
		default:
			break;
	}
}

function onContentFocus(){
	$("focus").style.top = 131 + listPos*72 + "px";
	$("list"+listPos).style.color = "#ffffff";
	if(menuData.length > 0){
		if(menuData[listPos+(currPage-1)*pageSize].name.length > 25){
			$("list"+listPos).innerHTML = "<marquee style=\"width:810px;\">"+menuData[listPos+(currPage-1)*pageSize].name+"</marquee>";
		}
	}
	var pos = listPos + (currPage-1)*pageSize;
	mySessionStorage.setItem("dfpy_listPos",pos);
}

function loseContentFocus(){
	$("list"+listPos).style.color = "";
}

function changeUD(_num){
	if(menuData.length <= 0){return false;}
	loseContentFocus();
	$("list"+listPos).innerText = getStrChineseLen(menuData[listPos+(currPage-1)*pageSize].name,25);
	if((listPos == 0 && currPage == 1 && _num == -1) || (listPos == pageSize - 1 && currPage == totalPage && _num == 1)){
		;
	}
	else if((listPos == 0 && currPage > 1 && _num == -1) || (listPos == pageSize - 1 && currPage < totalPage && _num == 1)){
		currPage += _num;
		initContent();
		listPos = _num == -1 ? pageSize - 1 : 0;
	}
	else{
		listPos += _num;
		listPos = listPos + (currPage-1)*pageSize >= menuData.length ? (menuData.length-1)%pageSize : listPos;
	}
	onContentFocus();
}

function changeLR(_num){
	if(menuData.length <= 0){return false;}
	if((currPage == 1 && _num == -1) || (currPage == totalPage && _num == 1)){
		;
	}
	else{
		currPage += _num;
		initContent();
		listPos = listPos + (currPage-1)*pageSize >= menuData.length ? (menuData.length-1)%pageSize : listPos;
		onContentFocus();
	}
}

function doSelect(){
	if(menuData.length <= 0){return false;}
	var tmp = listPos + (currPage-1)*pageSize;
	window.location.href = "content.htm?id="+menuData[tmp].id+"&name="+encodeURI(menuData[tmp].name);
}
</script>
</head>
<body background="images/bg.jpg" topmargin="0" leftmargin="0" onload="init()">
<!-- logo -->
<img src="images/txt_1.png" width="328" height="99" style="position:absolute;left:169px;top:76px;">
<!-- focus -->
<img id="focus" src="images/focus0.png" width="1137" height="210" style="position:absolute;left:104px;top:126px;visibility:visible;">
<!-- content -->
<table cellpadding="0" cellspacing="0" border="0" style="position:absolute;width:900px;height:432px;line-height:72px;left:231px;top:198px;font-size:32px;color:#341301;">
	<tr>
		<td id="list0" height="72"></td>
	</tr>
	<tr>
		<td id="list1" height="72"></td>
	</tr>
	<tr>
		<td id="list2" height="72"></td>
	</tr>
	<tr>
		<td id="list3" height="72"></td>
	</tr>
	<tr>
		<td id="list4" height="72"></td>
	</tr>
	<tr>
		<td id="list5" height="72"></td>
	</tr>
</table>
<!-- page -->
<div style="position:absolute;width:300px;height:39px;line-height:39px;left:169px;top:646px;font-size:26px;color:#a2541c;text-align:left;"><span id="cur" style="color:#8e4511;font-size:34px;"></span>/<span id="total"></span></div>
<!-- icon -->
<table cellpadding="0" cellspacing="0" border="0" style="position:absolute;width:334px;height:53px;left:850px;top:646px;font-size:20px;color:#faf9f6;">
	<tr>
		<td width="15%"><img src="images/btn_1.png" width="47" height="47"></td>
		<td width="22%">选择</td>
		<td width="14%"><img src="images/btn_2.png" width="47" height="47"></td>
		<td width="23%">进入</td>
		<td width="14%"><img src="images/btn_3.png" width="47" height="47"></td>
		<td width="12%">返回</td>
	</tr>
</table>
</body>
</html>