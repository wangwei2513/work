<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=gb2312" />
<title>宣传文化</title>
<script src="js/index.js"></script>
<script src="js/common.js"></script>
<script>
var dataAjaxPath = "menu.js";
var navTitleAjaxPath = "node.js";
var cellPadValue = 10;
var menuData = null;
var ajaxObj = null;
var menuPos = 0;
var haveBackUrl = false;
var access_token=(navigator.appName.indexOf("iPanel")!=-1)?(iPanel.eventFrame.access_token?iPanel.eventFrame.access_token:"TOKEN50001002"):(GP.get("access_token")?GP.get("access_token"):"TOKEN50001002");


//预加载focusImage图片
(function(){
	for(var i=0,len = focusInfo.length;i<len;i++){
		var img = new Image();
		img.src = focusInfo[i].focusImage;
	}
})();



window.onload  = init;
window.onunload = exit;
document.onkeydown = grabKeyEvent;
document.onirkeypress = grabKeyEvent;
function grabKeyEvent(event){
	var keycode = event.which;
	//iDebug(">>>smile_xcwh_index grabKeyEvent keycode=" + keycode);
	switch(keycode){
		case 1:
		case 38://up
			changeFocus("up");
			break;
		case 2:
		case 40://down
			changeFocus("down");
			break;
		case 3:
		case 37://left
			changeFocus("left");
			break;
		case 4:
		case 39://right
			changeFocus("right");
			break;
		case 13://ok
			doSelect();
			break;
		case 340:
		case 8://back
			doBack();
			event.returnValue =  false;
			break;
		case 339:
		case 27://exit
			doExit();
			break;
		case 4097:
			goExitMenu();
			break;
		default:
			return EVENT.DOWN;
	}
	return EVENT.STOP;
}	

function init(){
	iDebug("101m_notitle--index.htm--init()");
	getAccessToken();
	getPara();
	initBasicData();
	ajaxLoadMenuData();
	showFocus();
}

function getAccessToken(){

	var currUrl=window.location.href;
	
	iDebug("list_monitor--index.htm--getAccessToken()--currUrl="+currUrl);

	if(getUrlParams("access_token")){

	    access_token=getUrlParams("access_token");

		GP.set("access_token",access_token);

		iDebug("list_monitor---index.htm---GP.get('access_token'):"+GP.get("access_token"));
	}

	if(getUrlParams("da_id")){

	    var	da_id=getUrlParams("da_id");

	    GP.set("da_id",da_id);

	    iDebug("list_monitor---index.htm---GP.get('da_id')="+GP.get("da_id"));
	} 

	if(getUrlParams("backUrl")){

		var backUrl=getUrlParams("backUrl");
		
		GP.set("MonitorBackUrl",backUrl);

		iDebug("list_monitor---index.htm---GP.get('MonitorBackUrl')="+GP.get("MonitorBackUrl"));
	} 
	
}

function ajaxLoadMenuData(){
	ajaxObj = null;
	if (ajaxObj != null) {
		ajaxObj.requestAbort();
	}
	ajaxObj = new AjaxClass();
	ajaxObj.frame = window;
	ajaxObj.charset = "gbk";
	ajaxObj.successCallback = function(_xmlHttp, _params) {
		//iDebug(">>>ajaxLoadMenuData successCallback _xmlHttp.responseText=" + _xmlHttp.responseText);
		var jsonData = eval('(' + _xmlHttp.responseText + ')');
		if(typeof(jsonData) != "undefined" && jsonData.length > 0){
			menuData = jsonData;
		}
		ajaxNavTitle();
		checkBackUrl();
	};
	ajaxObj.failureCallback = function(_xmlHttp, _params) {
		ajaxNavTitle();
		checkBackUrl();
		//iDebug(">>>ajaxLoadMenuData failureCallback");
	};
	ajaxObj.url = dataAjaxPath;
	//iDebug(">>>ajaxLoadMenuData ajaxObj.url=" + ajaxObj.url);
	ajaxObj.requestData();
}

function ajaxNavTitle(){
	ajaxObj = null;
	if (ajaxObj != null) {
		ajaxObj.requestAbort();
	}
	ajaxObj = new AjaxClass();
	ajaxObj.frame = window;
	ajaxObj.charset = "gbk";
	ajaxObj.successCallback = function(_xmlHttp, _params) {
		//iDebug(">>>ajaxLoadMenuData successCallback _xmlHttp.responseText=" + _xmlHttp.responseText);
		var jsonData = eval('(' + _xmlHttp.responseText + ')');
		if(typeof(jsonData) != "undefined"){
			if(jsonData.navigator!=""){
				$("navTitle").innerText = jsonData.navigator;
				$("navTitle").style.left = (235+($("logoImage").width)+cellPadValue)+"px";
			}
		}else{}
	};
	ajaxObj.failureCallback = function(_xmlHttp, _params) {};
	ajaxObj.url = navTitleAjaxPath ;
	ajaxObj.requestData();
}



function changeFocus(_flag){
	iDebug(">>>smile_xcwh_index changeFocus menuPos=" + menuPos + ",_flag=" + _flag);
	var newPos = focusInfo[menuPos][_flag];
	iDebug(">>>smile_xcwh_index changeFocus newPos=" + newPos);
	if(newPos != -1){
		menuPos = newPos;
	}
	showFocus();
}

function doSelect(){
	if(typeof menuData == "undefined" || menuData.length<=0)return;
	var currObj = menuData[menuPos];
	if(currObj.clickable == 1){
		if(currObj.linkUrl!=""){
			window.location.href =  currObj.linkUrl+"?access_token="+access_token+"&backUrl="+window.location.href;
		}else if(currObj.enName!=""){
			var subTitle = title + "&gt;" + currObj.name;
			mySessionStorage.setItem("menuPos",menuPos);
			window.location.href = currObj.enName  + "/index.htm?title=" + encodeURICom(subTitle)+"&access_token="+access_token+"&backUrl="+window.location.href;	
		}
	}
}

function doBack(){
	mySessionStorage.removeItem("menuPos");
	/*if(haveBackUrl){
		window.location.href = backUrl;
	}else{*/
		goPortal();
	//}
}

function doExit(){
	doBack();
}

function getPara(){
	var currUrl = window.location.href;
	var tmpPara = mySessionStorage.getItem("menuPos",currUrl);	
	if(tmpPara != ""){
		menuPos = parseInt(tmpPara,10);
	} 
	if(menuPos>focusInfo.length-1){
		menuPos = 0;
	}
}

function initBasicData(){
	//$("title").innerHTML = title;
	$("marqueeDiv").innerHTML = "<marquee>" + marqueeText + "</marquee>";	
	for(var i=0,len = focusInfo.length;i<len;i++){
		$("focusImage"+i).src = focusInfo[i].focusImage;
	}
}

function showFocus(){
	//iDebug(">>>smile_xcwh_index showFocus menuPos=" + menuPos);
	var posInfo = focusInfo[menuPos].posInfo;
	iDebug(">>>smile_xcwh_index showFocus posInfo.top=" + posInfo.top);
	$("focusDiv").style.left = posInfo.left - 52 + "px";	
	$("focusDiv").style.top = posInfo.top - 47 + "px";
	$("focusDiv").style.width = posInfo.width + 104 + "px";
	$("focusDiv").style.height = posInfo.height + 104 + "px";
}

function checkBackUrl(){
	ajaxObj  = null;
	if (ajaxObj != null) {
		ajaxObj.requestAbort();
	}
	ajaxObj = new AjaxClass();
	ajaxObj.frame = window;
	ajaxObj.charset = "gbk";
	ajaxObj.successCallback = function(_xmlHttp, _params) {
		haveBackUrl = true;
	};
	ajaxObj.failureCallback = function(_xmlHttp, _params) {
		haveBackUrl = false;
		//iDebug(">>>checkBackUrl failureCallback");
	};
	ajaxObj.url = backUrl;
	//iDebug(">>>ajaxLoadMenuData ajaxObj.url=" + ajaxObj.url);
	ajaxObj.requestData();
}

function exit(){}

</script>

</head>



<body background="images/nr_bg.jpg" leftmargin="0" topmargin="0">
<div style="position: absolute; left: 230px; width: 148px; height: 49px; top: 32px;"><img id="logoImage" src="images/logo.png"/></div>
<!--top-->
	<!-- <div style="position:absolute;left:344px;top:40px;width:120px;font-size:26px;color:#000;">宣传文化</div> -->
	<!--中间内容-->
<div style="position:absolute;left:68px;top:112px;width:100px;height:100px;"><img src="" width="686" height="328" id="focusImage0"/></div>
	<div style="position:absolute;left:758px;top:112px;width:100px;height:100px;"><img src="" width="225" height="161" id="focusImage1"/></div>
	<div style="position:absolute;left:987px;top:112px;width:100px;height:100px;"><img src="" width="225" height="161" id="focusImage2"/></div>
	<div style="position:absolute;left:758px;top:278px;width:100px;height:100px;"><img src="" width="225" height="161" id="focusImage3"/></div>
	<div style="position:absolute;left:987px;top:278px;width:100px;height:100px;"><img src="" width="225" height="161" id="focusImage4"/></div>
	<div style="position:absolute;left:68px;top:443px;width:100px;height:100px;"><img src="" width="225" height="161" id="focusImage5"/></div>
	<div style="position:absolute;left:298px;top:443px;width:100px;height:100px;"><img src="" width="225" height="161" id="focusImage6"/></div>
	<div style="position:absolute;left:528px;top:443px;width:100px;height:100px;"><img src="" width="225" height="161" id="focusImage7"/></div>
	<div style="position:absolute;left:758px;top:443px;width:100px;height:100px;"><img src="" width="225" height="161" id="focusImage8"/></div>
	<div style="position:absolute;left:987px;top:443px;width:100px;height:100px;"><img src="" width="225" height="161" id="focusImage9"/></div>
	<div id="focusDiv" style="position:absolute; top:63px; left:38px; width:838px; height:480px; visibility: visible;">
  <table width="100%" height="100%" border="0" cellpadding="0" cellspacing="0">
    <tr>
      <td width="80" height="80" background="images/focus_01.png">&nbsp;</td>
      <td background="images/focus_02.png">&nbsp;</td>
      <td width="80" background="images/focus_03.png">&nbsp;</td>
    </tr>
    <tr>
      <td background="images/focus_04.png">&nbsp;</td>
      <td>&nbsp;</td>
      <td background="images/focus_05.png">&nbsp;</td>
    </tr>
    <tr>
      <td height="80" background="images/focus_06.png">&nbsp;</td>
      <td background="images/focus_07.png">&nbsp;</td>
      <td background="images/focus_08.png">&nbsp;</td>
    </tr>
  </table>
</div>
<div id="marqueeDiv" style="position:absolute; top:656px; left:104px; width:914px; height:26px; font-size:22px; color:#6d6d6d;"></div>
</body>
</html>