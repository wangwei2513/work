<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<html xmlns="http://www.w3.org/1999/xhtml">

<head>

<meta http-equiv="Content-Type" content="text/html; charset=gb2312" />

<title>无标题文档</title>

<style>

	.mf{ position:absolute; left:0px; top:110px; width:244px; height:63px; background:url(images/mf01.png) no-repeat; text-align:center; padding-top:5px; color:#a08e7c; line-height:50px;}

.column_txt0 {height:42px; font-size:24px; color:#000; line-height:42px; text-align:center; }

.mf1 {position:absolute; left:0px; top:110px; width:245px; height:82px; background:url(images/mf01.png) no-repeat; text-align:center; color:#559013; line-height:82px;}



</style>

<script type="text/javascript" src="js/common.js"></script>

<script type="text/javascript">

var dataAjaxPath = "content.js";

var logoAjaxPath = "";

var navTitleAjaxPath = "node.js";

var cellPadValue = 10;

var ajaxObj = null;

var logoAjaxObj = null;



var itemLen = 8;

var itemMaxSize = 20;

var itemPos = 0;

var curr;//去掉itemPos的当前页面的地址

var itemBox = null;

var scrollBox = null;

var menuData = [];

/*var havaBackUrl = false;*/

/*var backUrl = "../index.htm";*/

var navigatorFlag=navigator.appName.indexOf("iPanel");

var access_token=(navigator.appName.indexOf("iPanel")!=-1)?(iPanel.eventFrame.access_token?iPanel.eventFrame.access_token:"TOKEN50001002"):(GP.get("access_token")?GP.get("access_token"):"TOKEN50001002");

document.onkeydown = eventHandler;

function eventHandler(key){

  var e = key || event;

  var keycode = e.keyCode || e.which || e.charCode;

  iDebug("list_video_ad--index.htm--eventHandler--keycode="+keycode);

  switch (keycode) {

    case 1:   // up

    case 38:

      changeUD(-1);

      return false;

      break;

    case 2:   // down

    case 40:

      changeUD(1);

      return false;

      break;

    case 3:   // left

    case 37:

      //changeLR(-1);

      return false;

      break;

    case 4:   // right

    case 39:

      //changeLR(1);

      return false;

      break;

    case 13:

      doSelect();

      return false;

      break;

    case 8:

      goBack();

      event.returnValue = false;

      return false;

      break;

    case 27:

      top.iSTB.browser.gotoSTB("tv");

      event.returnValue = false;

      return false;

      break;

  }

}





function changeUD(_num){

	if(itemBox!=null){

		clearFocus();

		itemBox.changeList(_num);

		showFocus();

		scrollBox.scroll(itemBox.position);

		showScrollPage();

	}

}


function doSelect(){

	if(itemBox!=null){

		//var videoUrl =menuData[itemPos].videoUrl;
		var videoUrl =menuData[itemBox.position].videoUrl;

		if(isNaN(videoUrl)){

			iDebug("list_monitor_ad--doSelect()--isNaN(videoUrl)="+videoUrl);

			window.location.href = "content.htm?itemPos="+itemBox.position;

		}else{
			var _vodid = videoUrl;

			if(navigatorFlag != -1){

				iDebug("list_monitor_ad--doSelect()--ipanel--window.location.href="+curr+"?itemPos="+itemBox.position);

				iPanel.eventFrame.openPage(playAddr,{type:"vod",vodid:_vodid,backUrl:curr+"?itemPos="+itemBox.position});


			}else{

				GP.setBackUrl(playAddr,curr);

				var startBackUrl=curr.indexOf("backUrl");

				curr = curr.substring(0,startBackUrl-1);

				iDebug("yangcl03--list_video_ad--curr="+curr);

				top.globalPlayParams = {type:"vod",vodid:_vodid,isAppFlag:true,backUrl:curr+"&itemPos="+itemBox.position};

				iDebug("list_monitor_ad--doSelect()--inspur--window.location.href="+curr+"&itemPos="+itemBox.position);

				window.location.href = playAddr;
				//top.location.href = playAddr;
				//parent.location.href = playAddr;
			}

		}
	}
}


function goBack(){

	goPortal();

}





function init(){

	iDebug("yangcl--list_video_ad--index.htm--init");

	setTimeout(function(){

		window.focus();

	},500);

	
	iDebug("list_video_ad--index.htm--init--curr="+window.location.href);

	getAccessToken();

	getParms();

	iDebug("list_video_ad--init--itemPos="+itemPos);

	//checkBackUrl();

	ajaxLoadMenuData();

	//ajaxLoadLogo();
	

	showTime();

}


function getAccessToken(){

	var currUrl=window.location.href;
	
	iDebug("list_monitor--index.htm--getAccessToken()--currUrl="+currUrl);

	if(getUrlParams("access_token")){
		access_token=getUrlParams("access_token");
		GP.set("access_token",access_token);

		iDebug("list_monitor---index.htm---GP.get('access_token'):"+GP.get("access_token"));
	}

	if(getUrlParams("da_id")){
	    var	da_id=getUrlParams("da_id");
	    GP.set("da_id",da_id);

	    iDebug("list_monitor---index.htm---GP.get('da_id')="+GP.get("da_id"));
	} 

	if(getUrlParams("backUrl")){
		var backUrl=getUrlParams("backUrl");
		GP.set("MonitorBackUrl",backUrl);

		iDebug("list_monitor---index.htm---GP.get('MonitorBackUrl')="+GP.get("MonitorBackUrl"));
	} 
	
}



function getParms(){

	var currLocation  = window.location.href;

	var tempItemPos = getUrlParams("itemPos",currLocation);

	var posStart = currLocation.indexOf("itemPos");

	iDebug("list_video_ad--index.htm--getParms--posStart="+posStart+"   curr="+curr);


	if(tempItemPos!=""){

		itemPos = parseInt(tempItemPos,10);

		iDebug("list_video_ad--getParms--itemPos="+itemPos);

		curr = currLocation.substring(0,posStart-1);


	}else if(tempItemPos==""){


		var posEnd = currLocation.length;

		if(posStart!=-1){

			var tempItemPos= currLocation.substring(posStart+8,posEnd);

			itemPos = parseInt(tempItemPos,10);

			curr = currLocation.substring(0,posStart-1);
			
		}else{

			curr = currLocation;
		}
	}
	iDebug("list_video_ad--index.htm--getParms--itemPos="+itemPos+"   curr="+curr);
	//iDebug(">>>getParms--itemPos="+itemPos);

}



function ajaxLoadMenuData(){

	ajaxObj = null;

	if (ajaxObj != null) {

		ajaxObj.requestAbort();

	}

	ajaxObj = new AjaxClass();

	ajaxObj.frame = window;

	ajaxObj.charset = "gbk";

	ajaxObj.successCallback = function(_xmlHttp, _params) {

		////iDebug(">>>ajaxLoadMenuData successCallback _xmlHttp.responseText=" + _xmlHttp.responseText);

		var jsonData = eval('(' + _xmlHttp.responseText + ')');

		if(typeof(jsonData) != "undefined" && jsonData.length > 0){

			menuData = jsonData;

			iDebug("list_video_ad--ajaxLoadMenuData--successCallback--menuData="+menuData);

			showItem();

		}else{

			noItemData();

			initScroll();	

		}

		ajaxNavTitle();

		//checkBackUrl();

	};

	ajaxObj.failureCallback = function(_xmlHttp, _params) {

		//iDebug(">>>ajaxLoadMenuData failureCallback");

		ajaxNavTitle();

		//checkBackUrl();

		noItemData();	

	};

	ajaxObj.url = dataAjaxPath;

	//iDebug(">>>ajaxLoadMenuData ajaxObj.url=" + ajaxObj.url);

	ajaxObj.requestData();

}



function ajaxNavTitle(){

	ajaxObj = null;

	if (ajaxObj != null) {

		ajaxObj.requestAbort();

	}

	ajaxObj = new AjaxClass();

	ajaxObj.frame = window;

	ajaxObj.charset = "gbk";

	ajaxObj.successCallback = function(_xmlHttp, _params) {

		//iDebug(">>>ajaxLoadMenuData successCallback _xmlHttp.responseText=" + _xmlHttp.responseText);

		var jsonData = eval('(' + _xmlHttp.responseText + ')');

		if(typeof(jsonData) != "undefined"){

			if(jsonData.navigator!=""){

				$("navTitle").innerText = jsonData.navigator;

				$("navTitle").style.left = (235+($("logoImage").width)+cellPadValue)+"px";

			}

		}else{}

	};

	ajaxObj.failureCallback = function(_xmlHttp, _params) {};

	ajaxObj.url = navTitleAjaxPath ;

	ajaxObj.requestData();

}



function noItemData(){

	for(var i=0;i<itemLen;i++){

		if(i==0){

			$("item"+i).innerText = "暂无数据";

		}else{

			$("item"+i).innerText = "";

		}

		$("date"+i).innerText = "";

	}

	$("itemFocus").style.visibility = "hidden";

}



function showItem(){

	itemBox = new showList(itemLen,menuData.length,itemPos,-65,window);

	itemBox.focusDiv  = "itemFocus";

	itemBox.listSign  = "top";

	itemBox.listHigh = 65;

	itemBox.focusLoop  = true; 

	itemBox.haveData = function(_list){

		$("item" + _list.idPos).innerHTML = subStr(menuData[_list.dataPos].title,itemMaxSize,"...");

		$("date"+_list.idPos).innerText = menuData[_list.dataPos].date;

	};

	itemBox.notData = function(_list){

		$("item" + _list.idPos).innerHTML = "";

		$("date"+_list.idPos).innerText = "";

	};

	itemBox.startShow();

	initScroll();

	//焦点位置

	clearFocus();

	showFocus();

}



function clearFocus(){

	$("item"+itemBox.focusPos).style.color = "";

	$("date"+itemBox.focusPos).style.color = "";

	$("item" + itemBox.focusPos).innerHTML = subStr(menuData[itemBox.position].title,itemMaxSize,"...");

}



function showFocus(){

	$("item"+itemBox.focusPos).style.color = "#ffffff";

	$("date"+itemBox.focusPos).style.color = "#ffffff";

	if(getStrChineseLength(menuData[itemBox.position].title)>itemMaxSize){

		$("item"+itemBox.focusPos).innerHTML = "<marquee direction=left width=540>"+menuData[itemBox.position].title+"</marquee>";

	}

}



function initScroll(){

	scrollBox = null;

	if(itemBox!=null){

		$("barDiv").style.visibility = "visible";

		listDataLength = menuData.length;

		scrollBox = new ScrollBar("barDiv", "barDiv", window);

		scrollBox.init(listDataLength, itemLen, 492, 0, 61);

		scrollBox.scroll(itemBox.position);

		showScrollPage();

	}else{

		noScrollBar();

	}

}



function noScrollBar(){

	$("barDiv").style.visibility = "hidden";

	$("currPage").innerText  = 0;

	$("totalPage").innerText = 0;

	scrollBox = null;

}



function showScrollPage(){

	if(itemBox!=null){

		$("currPage").innerText  = itemBox.position+1;

		$("totalPage").innerText = menuData.length;

	}

}



function ajaxLoadLogo(){

	if (logoAjaxObj != null) {

		logoAjaxObj.requestAbort();

	}

	logoAjaxObj = new AjaxClass();

	logoAjaxObj.frame = window;

	logoAjaxObj.charset = "gbk";

	logoAjaxObj.successCallback = function(_xmlHttp, _params){

		////iDebug(">>>ajaxLogoData successCallback _xmlHttp.responseText=" + _xmlHttp.responseText);

		var jsonData = eval('(' + _xmlHttp.responseText + ')');

		if(typeof(jsonData) != "undefined" && jsonData.length > 0){

			if(typeof jsonData[0].logoImageUrl!="undefined" && jsonData[0].logoImageUrl!=""){

				$("logoImage").src = jsonData[0].logoImageUrl;

			}else{

				$("logoImage").src = "images/global_tm.gif";

			}

		}else{

			$("logoImage").src = "images/global_tm.gif";

		}

	};

	logoAjaxObj.failureCallback = function(_xmlHttp, _params) {

		////iDebug(">>>ajaxLogoData failureCallback");

		$("logoImage").src = "images/global_tm.gif";

	};

	logoAjaxObj.url = logoAjaxPath;

	////iDebug(">>>ajaxLogoData logoAjaxObj.url=" + logoAjaxObj.url);

	logoAjaxObj.requestData();

}



function showTime(){

	var currTime = formatTime("yyyy-MM-dd hh:mm",new Date());

	$("time").innerText = currTime;

	setTimeout("showTime()",1000);

}



</script>

</head>



<body background="images/tm_bg.jpg" leftmargin="0" topmargin="0" onload = "init();">



<div style="position: absolute; left: 230px; top: 32px;"><img id="logoImage" src="images/logo.png"/></div>

<div style="position: absolute; left: 367px; width: 844px; height: 49px; top: 32px; line-height: 49px; font-size: 27px" id="navTitle"></div>

<div style="position: absolute; left: 749px; top: 47px; width: 466px; height: 35px; font-size: 24px; text-align: right;" id="time"></div>

<!--推荐-->

<div style="position: absolute; left: 62px; top: 164px; width: 766px; height: 391px; "><!--background-image: url(images/line1.png); layer-background-image: url(line1.png); border: 1px none #000000;-->

  <div style="position: absolute; left: 0px; top: -65px; width: 753px; height: 64px; background-color: #e28a0d; layer-background-color: #e28a0d; border: 1px none #000000;" id="itemFocus"></div>

  <div style="position: absolute; left: 24px; top: -66px; width: 706px; height: 61px;">

    <table width="100%" border="0" cellspacing="0" cellpadding="0" style="font-size:26px; line-height:65px; color:#3f3f3f;">

      <tr>

        <td width="73%" id="item0">&nbsp;</td>

        <td width="27%" id="date0" align="right">&nbsp;</td>

      </tr>

      <tr>

        <td id="item1">&nbsp;</td>

        <td id="date1" align="right">&nbsp;</td>

      </tr>

      <tr>

        <td id="item2">&nbsp;</td>

        <td id="date2" align="right">&nbsp;</td>

      </tr>

      <tr>

        <td id="item3">&nbsp;</td>

        <td id="date3" align="right">&nbsp;</td>

      </tr>

      <tr>

        <td id="item4">&nbsp;</td>

        <td id="date4" align="right">&nbsp;</td>

      </tr>

      <tr>

        <td id="item5">&nbsp;</td>

        <td id="date5" align="right">&nbsp;</td>

      </tr>

      <tr>

        <td id="item6">&nbsp;</td>

        <td id="date6" align="right">&nbsp;</td>

      </tr>

      <tr>

        <td id="item7">&nbsp;</td>

        <td id="date7" align="right">&nbsp;</td>

      </tr>

    </table>

  </div>

</div>

<!--条目--><!--游走字幕-->

<div style="position: absolute; left: 829px; top: 120px; width: 3px; height: 492px; background-color: #828282;">

  <div style="position:absolute; left:-12px; top:40px; width:29px; height:61px; background-image: url(images/page.png); " id="barDiv">

    <div style="position:absolute; left:0px; top:0px; width:29px; height:29px; font-size:24px; color:#ffffff; text-align:center;" id="currPage"></div>

    <div style="position:absolute; left:0px; top:31px; width:29px; height:29px; font-size:24px; color:#ffffff; text-align:center;" id="totalPage"></div>

  </div>

</div>



<div style="position:absolute; left:880px; top:99px; width:100px; height:100px;">

	<img src="images/ad.jpg" width="340" height="522" />

</div>

</body>

</html>

