<!DOCTYPE html>
<html>
    
    <head>
        <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
        <title>
            02-0列表页
        </title>
    </head>
    <script language="javascript" src="js/ratings.js"></script>
    <script language="javascript" src="http://webclient.homed.me/application/commonJS/homedconfig.js"></script>
    <script language="javascript" src="js/common.js">
    </script>
    <script language="javascript" src="js/keyevent.js">
    </script>
    <!--script language="javascript" src="js/homedconfig.js">
    </script-->
    <script>
        var Posarea = 2;  //判断焦点区域 0 ：顶部三个按钮  1：菜单  2 ：列表
        var menuPos = 0;
        var listPos = 0;
        var topmenuPos = 0;
        var menus = [];
        var Name = [];
        var tags = [];
        var listPos_size = [[31, 168], [416, 168], [801, 168], [31, 389], [416, 389], [801, 389]];
        var currPage = 1;
        var lastPage = 1;
        var assetId = null;
        var backurl = null;
        var name = null;
        var menuBox = null;
        var listBox = null;
        var ajaxObj = null;
        var result_data = null;             //栏目菜单数据
        var result_data_list = null;        //列表数据
        var result_data_preSetlist = null   //预取列表节目数据
        var ajaxObj_preSet = null;
        var menuLen = 0;
        var listLen = 0;
        var bindAppID = 0;
        var menuFlag = 1;                   //判断该一级栏目是否存在二级栏目  0：没有  1：有
        var popFlag = false;
        var listId = null;                  //获取节目列表的Id
        var searchFlag=0;                   //判断是否进行搜索置顶操作
        var menu = [];                      //栏目的名字
        var PosareaFlag = true;
        var noMenu =false;
        var enterColumAction = 26;
        function eventHandler(eventObj) {
            var keycode = eventObj.code;
            if (popFlag) {
                return window.frames["ifr_0"].eventHandler(eventObj);
            }
            iDebug("index keycode=" + keycode);
            switch (keycode) {
            case "KEY_UP":
                changeUD(1);
                return EVENT.STOP;
                break;
            case "KEY_DOWN":
                changeUD( - 1);
                return EVENT.STOP;
                break;
            case "KEY_LEFT":
                changeLR( - 1);
                return EVENT.STOP;
                break;
            case "KEY_RIGHT":
                changeLR(1);
                return EVENT.STOP;
                break;
            case "KEY_SELECT":
                doselect();
                return EVENT.STOP;
                break;
            case "KEY_PAGE_UP":

                return EVENT.STOP;
                break;
            case "KEY_PAGE_DOWN":

                return EVENT.STOP;
                break;

            case "KEY_BACK":
                delGlobal();
                GoBack();
                return EVENT.STOP;
                break;
            case "KEY_HOMEPAGE":
			          delGlobal();       
            default:
                return EVENT.DOWN;
                break;
            }
        }
        function init() {
        	  //moveCon();
        	  var from=getGlobalVar("jyjyfrom");
        	  iDebug("yanch listPage doselect from="+from[0].url)
            setGlobalVar("gotoPlay", false);
            searchFlag = getUrlParams("searchFlag", window.location.href);
            //menuPos=getUrlParams("menuPos",window.location.href);
            iDebug("yanch listpage menuPos=" + menuPos);
            if (typeof getGlobalVar("ListPagecurrPage") != "undefined"&&getGlobalVar("ListPagecurrPage") != null) {
                currPage = getGlobalVar("ListPagecurrPage");
            }
            assetId = getUrlParams("assetId", window.location.href);//栏目Id
            iDebug("yanch listPage assetId=" + assetId);
            getMenu();
            //changelistPage(1)
            iDebug("yanch listPsge init Posarea=" + Posarea);
            //setTimeout(function(){
        }
        function delGlobal() {
            //iDebug("yanch delGlobal")
            delGlobalVar("ListPagePosarea");
            delGlobalVar("ListPagelistPos");
            delGlobalVar("ListPagemenuPos");
            delGlobalVar("ListPagecurrPage");
            delGlobalVar("ListmenuPosition");
            //iPanel.delGlobalVar("IndexlistPos");
            //iPanel.delGlobalVar("PlayBackUrl");
        }
        function getMenu() {
            iDebug("listPage getMenu start...");
            if (ajaxObj == null) {
                ajaxObj = new ajaxClass();
                ajaxObj.frame = window;
            } else {
                ajaxObj.requestAbort();
            }
            ajaxObj.frequency = 1000; //请求失败后隔多长时间重新请求一次 
            ajaxObj.requestTimes = 1; //请求失败后重新请求多少次
            ajaxObj.successCallback = function(_xmlHttp, _params) {
                iDebug("yanch listPage success getMenu" + assetId + ";;currPage=" + currPage);
                var jsonData = _xmlHttp.responseText;
                result_data = eval("(" + jsonData + ")");
                search_label = getUrlParams("search_label", window.location.href);
                searchFlag = getUrlParams("searchFlag", window.location.href);
                id=getUrlParams("id",window.location.href)
                iDebug("yanch listPage getMenu id="+id+";;search_label="+search_label+";;;searchFlag="+searchFlag)
                iDebug("yanch listPage getMenu result_data=" + result_data);
                $("name").innerText = result_data.type_list[0].name;
                menu = [];
                //iDebug("yanch aaa length="+result_data.type_list[0].children.length)
                if (typeof result_data.type_list[0].children != 'undefined') { //首先判断是否存在子栏目
                    menuLen = result_data.type_list[0].children.length;
                    if(menuLen != 0){
                    	Posarea = 1;
                    	iDebug("yanch listpage getmenu Posarea="+Posarea)
                    	for(var i=0;i<menuLen;i++){
                    		if(result_data.type_list[0].children[i].extend_content == ""){
                    			menu.push(result_data.type_list[0].children[i])
                    			}else{
                    				var bindAppID = eval("(" + result_data.type_list[0].children[i].extend_content + ")").bindAppID;
                    				if(typeof bindAppID =="undefined"||bindAppID == ""){
                         	      menu.push(result_data.type_list[0].children[i])
                         	  }
                    			}
                    		
                         /*if(typeof bindAppID =="undefined"||bindAppID == ""){
                         	menu.push(result_data.type_list[0].children[i])
                         	}*/
                    		}
                    		menuLen = menu.length;
                    	}
                    	if (menuLen == 0) {
                    		moveCon();
                    		Posarea = 2; //若没有栏目，则获取父级栏目的节目列表
                    		iDebug("yanch listpage getmenu Posarea1="+Posarea)
                        listId = assetId;
                        if(searchFlag){
                              SearchByKey(search_label,id);
                        }else{
                	            getList(listId);
                	      }
                        //Preset(1, currPage, menuPos, listId);
                        iDebug("yanch listPage success getMenu" + assetId + ";;currPage111=" + currPage);
                        iDebug("yanch getMen listLen=" + listLen);
                        setTimeout(function() {
                            if (listLen != 0) {
                                Posarea = 2;
                                iDebug("yanch listpage getmenu listLen != 0 Posarea="+Posarea)
                                setTimeout(function() {
                                    //showFocus();
                                },
                                200);
                            } else {
                                Posarea = 0;
                                //settopMenustyle();
                            }
                        },
                        500)

                        $("menu_focus").style.visibility = "hidden";
                        menuFlag = 0;
                        
                        return;
                    } 
                    initMenu();
                    iDebug("yanch listPage getMenu menuBox.position1111="+menuBox.position)
                    if(searchFlag){
                              SearchByKey(search_label,id);
                        }else{
                        	    iDebug("yanch listPage getMenu menuBox.position="+menuBox.position)
                	            getList(menu[menuBox.position].id);//显示对应二级栏目的节目列表
                	      }
                    listId = menu[menuBox.position].id;
                    //Preset(1, currPage, menuPos, listId);
                    iDebug("yanch listPage success getMenu" + assetId + ";;currPage222=" + currPage);
                    //Preset(1,currPage,menuPos,listId);
                } else {
                	iDebug("yanch listpage getmenu Posarea2="+Posarea)
                    listId = assetId;
                   if(searchFlag){
                              SearchByKey(search_label,id);
                        }else{
                	            getList(listId);
                	      } //不存在栏目，则显示节目列表
                    //Preset(1, currPage, menuPos, listId);
                    $("menu_focus").style.visibility = "hidden";
                    menuFlag = 0;
                    //iDebug("yanch getlist1 listLen="+listLen)
                    setTimeout(function() {
                        if (listLen != 0) {
                            Posarea = 2;
                            iDebug("yanch listpage getmenu no menu listLen != 0 Posarea="+Posarea)
                            setTimeout(function() {
                                //showFocus();
                            },
                            50);
                        } else {
                            Posarea = 0;
                            //settopMenustyle();
                        }
                    },
                    50)
                }
                Posrecord();
            };
            ajaxObj.failureCallback = function(_xmlHttp, _params) {
                iDebug("yanch listPage success getMenu fail")
            };
            //修改字段名称
            ajaxObj.url = [slaveAddr + "/homed/programtype/get_list?accesstoken=" + access_token + "&label=" + assetId + "&depth=1", "data/listPage.js"][DEBUG];
            iDebug("ListPage getMenu ajaxObj.url =" + ajaxObj.url);
            ajaxObj.requestData("GET");
        }
        function initMenu() {
        	 var position=0
        	 if (typeof getGlobalVar("ListmenuPosition") != "undefined"&&getGlobalVar("ListmenuPosition")!=null) {
        	 	//menuPos = getGlobalVar("ListPagemenuPos");
        	 	var position=getGlobalVar("ListmenuPosition")
        	 	}
        	  iDebug("yanch listPage initMenu position="+position+";;menuPos="+menuPos)
            menuBox = new showList(7, menuLen, position, 33, window);
            iDebug("yanch initMenu menuLen=" + menuLen);
            menuBox.focusDiv = "menu_focus"; //焦点元素的ID
            menuBox.listHigh = 157; //行高
            //menuBox.focusPlace=place;
            //menuBox.focusPos = menuPos
            menuBox.listSign = 1; //表示横向移动，不设置则默认为竖向
            menuBox.focusLoop = true; //是否循环切换
            menuBox.pageLoop = true; //是否循环翻页
            menuBox.haveData = function(List) { //显示一行数据
                $("menu" + List.idPos).innerText = menu[List.dataPos].name;
            }
            menuBox.notData = function(List) { //清空一行数据
                $("menu" + List.idPos).innerText = "";
            };
            menuBox.startShow(); //开始显示列表信息
        }
        function changeMenuList(_num) {
            menuBox.changeList(_num); //焦点切换	
            //menuPos=menuBox.focusPos;
            setMenustyle();
        }

        function changeMenuPage(_num) {
            menuBox.changePage(_num); //翻页
        }
        /**
		    * { function_description }  预取上下页的数据
		    *
		    * @param        _num       1：下一页 -1：上一页
		    * @param        _page      当前页
		    * @param        _menuPos   当前栏目焦点
		    * @param        _label     当前栏目label
		    */
        function Preset(_num, _page, _menuPos, _label) { 
            iDebug("yanch listPage Preset init");
            _page = _page + _num;
            iDebug("yan listPage Preset _page="+_page+";;lastPage="+lastPage)
            if(_page<1||_page>lastPage)return;
            var hashTableKey = "remoteLesson_" + _page + _menuPos;
            var temp = hashTableObj.get(hashTableKey);
            if (temp == false) {
                if (ajaxObj_preSet == null) {
                    ajaxObj_preSet = new ajaxClass();
                    ajaxObj_preSet.frame = window;
                } else {
                    ajaxObj_preSet.requestAbort();
                }
                ajaxObj_preSet.frequency = 1000; //请求失败后隔多长时间重新请求一次 
                ajaxObj_preSet.requestTimes = 1; //请求失败后重新请求多少次
                ajaxObj_preSet.successCallback = function(_xmlHttp, _params) {
                    iDebug("yanch ListPage Preset success");
                    var jsonData = _xmlHttp.responseText;
                    result_data_preSetlist = eval("(" + jsonData + ")");
                    menus=[];
                    var size = "375x210";
                    for(var i=0;i<result_data_preSetlist.list.length;i++){
                    	menus[i] = result_data_preSetlist.list[i].poster_list.dir + result_data_preSetlist.list[i].poster_list.list[size];
                    	iDebug("yanch listPage Preset menus="+menus[i])
                    	var imgObj = new Image();  
	                    imgObj.src = menus[i];
	                    imgObj.onload = function(){
	                    	iDebug("yanch listPage Preset onload")
	                    	}
                    	}
                    hashTableObj.put(_params[0], result_data_preSetlist);
                    var temp = hashTableObj.get(hashTableKey);
                    iDebug("yanch listPage Preset temp="+temp)
                    _num = -2;
                    Preset(_num, _page, _menuPos, _label);
                };
                ajaxObj_preSet.failureCallback = function(_xmlHttp, _params) {
                    iDebug("yanch ListPage Preset fail");
                };
                //修改字段名称
                ajaxObj_preSet.callbackParams = [hashTableKey];
                ajaxObj_preSet.url = [slaveAddr + "/homed/program/get_list?sdsize=246x138|160x200|240x300|375x210&hdsize=246x138|160x200|240x300|375x210&vodsize=246x138|160x200|240x300|375x210&appsize=246x138|160x200|240x300|375x210&chnlsize=246x138|160x200|240x300|375x210&musicsize=246x138|160x200|240x300|375x210&accesstoken=" + access_token + "&label=" + _label + "&pagenum=6&pageidx=" + _page, "data/indexMenu.js"][DEBUG];
                iDebug("listPage.htm Preset ajaxObj.url =" + ajaxObj_preSet.url);
                ajaxObj_preSet.requestData("GET");
            } else {
                return;
            }
        }
        function getList(_label) {
        	iDebug("ListPage getList start...typeof menuBox="+typeof menuBox);
        	if(typeof menuBox=="undefined"||menuBox==null){
        		 var hashTableKey = "remoteLesson_" + currPage;
        		}else{
        			iDebug("yanch listPage getList currPage="+";;;menuPos.position="+menuBox.position)
        			 var hashTableKey = "remoteLesson_" + currPage + menuBox.position;
        			}
            var temp = hashTableObj.get(hashTableKey);
            iDebug("remoteLesson getListData temp=" + temp+";;hashTableKey="+hashTableKey);
            if (temp != false) {
                result_data_list = temp;
                iDebug("yanch listPage getList temp==[object,object]");
                setData();
                return;
            }
            if (ajaxObj == null) {
                ajaxObj = new ajaxClass();
                ajaxObj.frame = window;
            } else {
                ajaxObj.requestAbort();
            }
            ajaxObj.frequency = 1000; //请求失败后隔多长时间重新请求一次 
            ajaxObj.requestTimes = 1; //请求失败后重新请求多少次
            ajaxObj.successCallback = function(_xmlHttp, _params) {
                iDebug("yanch ListPage getList success");
                var jsonData = _xmlHttp.responseText;
                result_data_list = eval("(" + jsonData + ")");
                hashTableObj.put(_params[0], result_data_list);
                //iDebug("result_data_list="+result_data_list)
                iDebug("yanch getList Posarea = "+Posarea+";;"+_label);
                var len = menu.length;
                if(len>0){
                	collect(1,_label,parentType,parentId,26);
                	}
                setData();
            };
            ajaxObj.failureCallback = function(_xmlHttp, _params) {
                iDebug("yanch ListPage getList fail");
            };
            //修改字段名称
            ajaxObj.callbackParams = [hashTableKey];
            ajaxObj.url = [slaveAddr + "/homed/program/get_list?sdsize=246x138|160x200|240x300|375x210&hdsize=246x138|160x200|240x300|375x210&vodsize=246x138|160x200|240x300|375x210&appsize=246x138|160x200|240x300|375x210&chnlsize=246x138|160x200|240x300|375x210&musicsize=246x138|160x200|240x300|375x210&accesstoken=" + access_token + "&label=" + _label + "&pagenum=6&pageidx=" + currPage, "data/indexMenu.js"][DEBUG];
            iDebug("listPage.htm getList ajaxObj.url =" + ajaxObj.url);
            ajaxObj.requestData("GET");
        }
        /*
        搜索置顶节目的方法
        _search_label:所属栏目的label
        _id:置顶节目的id
        */
        function SearchByKey(_search_label,_id){//搜索的置顶功能
            if (ajaxObj == null) {
                ajaxObj = new ajaxClass();
                ajaxObj.frame = window;
            } else {
                ajaxObj.requestAbort();
            }
            ajaxObj.frequency = 1000; //请求失败后隔多长时间重新请求一次 
            ajaxObj.requestTimes = 1; //请求失败后重新请求多少次
            ajaxObj.successCallback = function(_xmlHttp, _params) {
                iDebug("yanch ListPage SearchByKey success");
                var jsonData = _xmlHttp.responseText;
                result_data_list = eval("(" + jsonData + ")")
                //iDebug("result_data_list="+result_data_list)
                setData();
                if(menuLen>0){
                	for(var i=0;i<menuLen;i++){
                		if(menu[i].id==_search_label){
                			//menuPos=i;
                			setGlobalVar("ListmenuPosition", i);
                			initMenu();
                			setMenustyle();
                			$("menu_focus").style.visibility = "hidden";
                			listPos=0;
                			Posarea=2;
                			showFocus();
                			break;
                			}
                		}
                	}
                //result_data.type_list[0].children[List.dataPos]
            };
            ajaxObj.failureCallback = function(_xmlHttp, _params) {
                iDebug("yanch listPage SearchByKey fail");
            };
            //修改字段名称
            ajaxObj.url = [slaveAddr+"/search/search_by_keyword?accesstoken="+access_token+"&programid="+_id+"&pageidx="+currPage+"&pagenum=6&label="+_search_label, "data/indexMenu.js"][DEBUG];
            iDebug("listPage.htm SearchByKey ajaxObj.url =" + ajaxObj.url);
            ajaxObj.requestData("GET");
        	}
        function setData() {
        	var picLoad=0;
        	iDebug("yanch listPage setData Posarea="+Posarea)
            if (typeof result_data_list.list!="undefied") {
                listLen = result_data_list.total;
                //iDebug("yanch listPage.htm setData listLen=" + listLen)
                //listLen=menus.length
            }
            if (listLen != 0) {
            	if(PosareaFlag){
            		Posarea = 2;
            		}
                lastPage = Math.ceil(listLen / 6);
                var size = "375x210";
                tags = [];
                for (var i = 0; i < result_data_list.list.length; i++) {
                    menus[i] = result_data_list.list[i].poster_list.dir + result_data_list.list[i].poster_list.list[size];
                    Name[i] = result_data_list.list[i].name;
                    tags[i] = result_data_list.list[i].tag.split("|")[0];
                    iDebug("yanch listPage setData name=" + Name[i]);
                }
            } else {
                for (var i = 0; i < 6; i++) {
                    $("con" + i).style.visibility = "hidden";
                }
                menus=[];
                Name=[];
                tags=[];
                if(menuLen>0&&Posarea==1){
                	setMenustyle();
                	}
                return false;
            }
            iDebug("yanch listPage setData listPos0="+listPos)
            if(typeof getGlobalVar("ListPagelistPos")!='undefined'&&getGlobalVar("ListPagelistPos")!=null){//这一块做了一个焦点的记忆
            	iDebug("yanch listPage setData listPos1111="+listPos)
            	listPos = getGlobalVar("ListPagelistPos");
            	delGlobalVar("ListPagelistPos");//刷新页面的时候，要提前删除全局，否则会影响分页请求的焦点
            	}
            for(var i=0;i<6;i++){//图片的预加载功能
            	 var imgObj = new Image();  
	              imgObj.src = menus[i];
	              imgObj.onload=function(){
	              	picLoad++;
	              	}
	              imgObj.onerror=function(){
	              	picLoad++;
	              	}	
            	}
            var timer=setInterval(function(){
            	if(picLoad==6){
            		clearTimeout(timer);
            		initList();
                initPage();
                is_lastPage();
                for(var i=8;i<result_data_list.list.length;i++){
            	 var imgObj = new Image();  
	              imgObj.src = menus[i];
	              imgObj.onload=function(){
	              	picLoad++;
	              	}
	              imgObj.onerror=function(){
	              	picLoad++;
	              	}	
            	}
            		}
            	},10)
            
        }
        function initList() {
        	iDebug("yanch listPage initList listPos1111="+listPos)
            clearList();
            //$("focus").style.visibility="hidden"
            //var index=(currPage-1)*6
            //iDebug("yanch listPage initList index="+index)
            for (var i = 0; i < 6; i++) {
                if (i > listLen - 1) {
                    break;
                }
                $("list" + i).src = menus[i];
                $("icon" + i).src = setIcon(tags[i]);
                var name = Name[i];
                if (getStrChineseLength(name) > 10) {
                    name = getStrChineseLen(name, 10, "..");
                }
                $("text" + i).innerText = name;
                iDebug("yanch listPage initList name=" + Name[i]);
            }
            //if(bindAppID!=0||menuLen==0)
            iDebug("listPage Posarea="+Posarea)
            if (Posarea == 1) {
                //iDebug("listPage Posarea==1")
                setMenustyle();
            } else if (Posarea == 2) {
            	iDebug("yanch listPage initList listPos="+listPos)
                showFocus();
                if(typeof menuBox!="undefined"&&menuBox != null){
                	$("menu" + menuBox.focusPos).style.color = "#fff";
                  $("menu" + menuBox.focusPos).style.fontWeight = "bold";
                	}
            } else {
                settopMenustyle();
            }
            if(typeof menuBox!="undefined"&&menuBox != null){
            	Preset(1, currPage, menuBox.position, listId);
            	}else{
            		Preset(1, currPage, menuPos, listId);
            		}
            is_lastPage();
        }
        function getSubjectPoster(_id){
        	  if (ajaxObj == null) {
                ajaxObj = new ajaxClass();
                ajaxObj.frame = window;
            } else {
                ajaxObj.requestAbort();
            }
            ajaxObj.frequency = 1000; //请求失败后隔多长时间重新请求一次 
            ajaxObj.requestTimes = 1; //请求失败后重新请求多少次
            ajaxObj.successCallback = function(_xmlHttp, _params) {
            	var res = eval('(' + _xmlHttp.responseText + ')');
            	var backgroundImgUrl;
                if (res.poster_list.list['bg1280x720'].split('|')[0]) {
                    backgroundImgUrl = res.poster_list.dir + res.poster_list.list['bg1280x720'].split('|')[0];
                }else if(typeof res.poster_list.list['bg1280x720'] != "undefined"){
                    backgroundImgUrl = res.poster_list.dir + res.poster_list.list['bg1280x720'];
                }else{
                    backgroundImgUrl = '';
                }
                iDebug("yanch listPage getSubjectPoster backgroundImgUrl="+backgroundImgUrl)
                window.location.href = "subject/subject.php?subjectId="+_id+"&posterUrl="+backgroundImgUrl
            };
            ajaxObj.failureCallback = function(_xmlHttp, _params) {
                iDebug("yanch listPage fail");
            };
            //修改字段名称
            var params = '{'+
                '"accesstoken": "'+access_token+'",'+
                '"subjectid":"'+ _id+'",'+
                '"postersize":"bg1280x720",'+
                '"isdec": "1"'+
            '}';
            ajaxObj.urlParameters= params;
            ajaxObj.url = slaveAddr + '/subject/get_info';
            iDebug("listPage.htm SearchByKey ajaxObj.url =" + ajaxObj.url+";;param="+ajaxObj.urlParameters);
            ajaxObj.requestData("POST");
        	}
        function clearList() {
            for (var i = 0; i < 6; i++) {
                $("list" + i).src = "";
                $("icon" + i).src = "";
                $("text" + i).innerText = "";
                $("con" + i).style.visibility = "visible";
            }
        }
        function changeList(_num) {
            listBox.changeList(_num); //焦点切换
        }

        function changelistPage(_num) {
            iDebug("yanch listPage changeListPage _num=" + _num + ";;currPage=" + currPage);
            //currPage=currPage+_num;
            initList();
        }
        function changeUD(_num) {
        	  PosareaFlag = false;
            if (Posarea == 1) {
                if (_num < 0) {
                    if (listLen == 0) return;
                    $("menu_focus").style.visibility = "hidden";
                    Posarea = 2;
                    showFocus();
                } else {
                    $("menu_focus").style.visibility = "hidden";
                    $("menu" + menuBox.focusPos).style.color = "#ababae";
                    $("menu" + menuBox.focusPos).style.fontWeight = "normal";
                    Posarea = 0;
                    settopMenustyle();
                }
            } else if (Posarea == 2) {
                if (_num < 0 && listPos < 3) {
                    var currPos = listPos + 3;
                    if (currPos > result_data_list.list.length - 1) {
                        currPos = result_data_list.list.length - 1;
                        if(currPos<3){
                        	return;
                        	}else{
                        		listPos=currPos;
                        		}
                    }else{
                    	  listPos = listPos + 3;
                    	}
                    showFocus();
                }
                if (_num > 0) {
                    if (listPos < 3) {
                        $("focus").style.visibility = "hidden";
                        //$("list"+listPos).style.visibility="hidde"
                        if (bindAppID != 0 || menuFlag == 0) {
                            Posarea = 0;
                            settopMenustyle();
                            return;
                        }
                        Posarea = 1;
                        setMenustyle();
                    } else {
                        listPos = listPos - 3;
                        showFocus();
                    }
                }

            } else if (Posarea == 0 && _num < 0) {
                //if(menuLen==0)return;
                $("topfocus" + topmenuPos).style.visibility = "hidden";
                //topmenuPos=0;
                if (bindAppID != 0 || menuFlag == 0) {
                    iDebug("yanch listPage changeUD listLen=" + listLen);
                    if (listLen == 0) {
                        $("topfocus" + topmenuPos).style.visibility = "visible";
                        return;
                    } else {
                        Posarea = 2;
                        showFocus();
                        return;
                    }
                }
                Posarea = 1;
                setMenustyle();
            }
        }
        function changeLR(_num) {
        	  PosareaFlag = false;
            if (Posarea == 1) {
            	  searchFlag=0;
                clearPage();
                changeMenuList(_num);
                currPage = 1;
                listId = menu[menuBox.position].id;
                getList(listId);
                iDebug("yanch listPage changeLR listId="+listId+";;;;"+menuBox.position+";;menuPos="+menuPos+";;Posarea="+Posarea)
                if (listLen != 0) listPos = 0;
            } else if (Posarea == 2) {
            	  var search_label = getUrlParams("search_label", window.location.href);
                var id=getUrlParams("id",window.location.href);
                //$("focus").style.visibility="hidden"
                var currPos = listPos + (currPage - 1) * 6 + 1;
                if (_num > 0) {
                    if (currPos > listLen - 1) {
                        return;
                    }
                    if (listPos != 2 && listPos != 5) {
                        listPos++;
                        showFocus();
                    }

                    else {
                        //$("focus").style.visibility="hidden"
                        if (currPage != lastPage) {
                            currPage++;
                            iDebug("yanch listpage changelr currPage=" + currPage);
                            if (currPos + 4 > listLen) {
                                listPos = listPos - 3;
                            } //判断第二页是否有第二行数据
                            listPos = listPos - 2;
                            if(searchFlag){
                            	SearchByKey(search_label,id);
                            	}else{
                            		getList(listId);
                            		}
                            //changelistPage(1);
                        }
                    }
                } else {
                    if (listPos != 0 && listPos != 3) {
                        listPos--;
                        showFocus();
                    } else {
                        if (currPage != 1) {
                            currPage--;
                            listPos = listPos + 2;
                            if(searchFlag){
                            	SearchByKey(search_label,id);
                            	}else{
                            		getList(listId);
                            		}
                            // changelistPage(-1);
                        }
                    }
                }
                iDebug("yanch listPage changeLR listPos=" + listPos)
                /*var timer=setInterval(function(){
			$("focus").style.visibility="hidden"
			if(listLen){
				showFocus();
				clearTimeout(timer)
				}
			},10)*/
            } else {
                if (_num > 0) topmenuPos++;
                else topmenuPos--;
                if (topmenuPos > 2) topmenuPos = 2;
                if (topmenuPos < 0) topmenuPos = 0;
                settopMenustyle();
            }
        }
        function doselect() {
        	  var from=getGlobalVar("jyjyfrom");
        	  iDebug("yanch listPage doselect from="+from[0].url)
            var backurl ={url: window.location.href}
            from.push(backurl);
            setGlobalVar("jyjyfrom", from)
            assetId = getUrlParams("assetId", window.location.href);
            backurl = decodeURIComponent(getUrlParams("backurl", window.location.href));
            setGlobalVar("PlayBackUrl", window.location.href+"&noList=1");
            setGlobalVar("ListPagePosarea", Posarea);
            setGlobalVar("ListPagelistPos", listPos);
            setGlobalVar("ListPagetopmenuPos", topmenuPos);
            setGlobalVar("ListPagecurrPage", currPage);
            if(menuBox!=null){
            	setGlobalVar("ListPagemenuPos", menuBox.focusPos);
              setGlobalVar("ListmenuPosition", menuBox.position);
            	}
            iDebug("yanch listPage doselect menuPos=" + menuPos + ";;listPos=" + listPos + ";;Posarea=" + Posarea);
            if (Posarea == 0) {
                if (topmenuPos == 0) {
                    var backurl = window.location.href;
                    window.location.href = "lesson.htm"
                } else if (topmenuPos == 2) {
                    var backurl = window.location.href;
                    window.location.href = "search.htm"
                }
            }
            if (Posarea == 2) {
                var subFlag = 0;//这个标记是用以判断该节目是否存在课程大纲 1:存在 0:不存在
                var currPos = listPos;
                var backurl = window.location.href;
                var attr = result_data_list.list[currPos].attribute;  // 1:独立课程 2：专区子课程  0：专区或者专题
                var type = result_data_list.list[currPos].type;// 节目的类型   2：点播  3：应用  21：专题
                var id = result_data_list.list[currPos].id;
                var label_list = result_data_list.list[currPos].label;
                var par_label = label_list.split("|")[1];
                var is_favorite = result_data_list.list[currPos].is_favorite;
                var is_purchased = result_data_list.list[currPos].is_purchased;
                var desc = result_data_list.list[currPos].desc;
                var size = "240x300";
                var poster = result_data_list.list[currPos].poster_list.dir + result_data_list.list[currPos].poster_list.list[size];
                var sub_type = result_data_list.list[currPos].sub_type;
                var sub_arr = sub_type.split("|");
                if (type == 2) {
                    var listLabel = listId;//listlabel为当前所在栏目的id
                    iDebug("yanch listPage doselect listlabel = "+listLabel)
                    var series_id = result_data_list.list[currPos].series_id;
                    var series_total = result_data_list.list[currPos].series_total;
                    if (is_purchased == 1) {
                    	if(attr == 2){
                    		var playCollect = {
                                		"programId":id,
                                		"programType":5,
                                		"parentType":1,
                                		"parentId":listId
                                		}                            
                    		}else{
                    			var playCollect = {
                                		"programId":id,
                                		"programType":4,
                                		"parentType":1,
                                		"parentId":listId
                                		}
                    			}
                    		setGlobalVar("playCollect", playCollect);	
                        if (series_total && series_total > 1) {
                            getSeriseInfo(series_id, listLabel);
                        } else {
                        	iPanel.eventFrame.openPage(playurl, {
                               type: "vod",                     
                               vodid: id,                       
                               listLabel: listLabel,            
                               backUrl: window.location.href    
                           }); 
                            //iPanel.eventFrame.openPage(vodDetailAddr + "?seriesFlag=1&movieid=" + id + "&listLabel=" + listLabel);
                        }
                    } else {
                        for (var i = 0; i < sub_arr.length; i++) {//判断是否有课程大纲。根据sub的取值范围判断
                            if (11070201 <= sub_arr[i] && sub_arr[i] <= 11070299 && is_purchased == 0) {
                                subFlag = 1;
                            }
                        }
                        iDebug("yanch listPage doselect par_label=" + par_label);
                        if (attr == 2) {
                        	  //collect("preappcourse", id, result_data_list.list[currPos].name, enterColumAction,1);
                            window.location.href = "zhuanqu_detail.htm?id=" + id + "&series_id=" + series_id + "&type=2&listLabel="+listId;
                            return;
                        } else {
                        	  //collect("preappcourse", id, result_data_list.list[currPos].name, enterColumAction,1);
                            window.location.href = "detail.htm?id=" + id + "&series_id=" + series_id + "&type=2&par_label=" + par_label + "&subFlag=" + subFlag+"&listLabel="+listId;;
                            return;
                        }
                    }
                } else if(type == 3){
                    if (attr == 0) { //普通应用
                        if (is_purchased == 1) {
                        	  collect(2, id,1,listId,1,1);
                            window.location.href = result_data_list.list[currPos].url[0];
                        } else {
                            collect(2, id,1,listId,enterColumAction,1);
                            if(result_data_list.list[currPos].tab.indexOf("小产品")>-1){
                                window.location.href = result_data_list.list[currPos].url[0];
                                return;
                        	    }
                            window.location.href = "detail.htm?id=" + id + "&series_id=&type=3&par_label=" + par_label + "&subFlag=" + subFlag+"&listLabel="+listId;
                        }
                    } else if (attr == 2) {
                        if (is_purchased == 1) {
                        	  collect(5, id,1,listId,1,1);
                            window.location.href = result_data_list.list[currPos].url[0];
                        } else {
                        	  collect(5, id,1,listId,enterColumAction,1);
                            window.location.href = "zhuanqu_detail.htm?id=" + id + "&series_id=&type=3&listLabel="+listId;
                        }
                    } else {
                        var label = result_data_list.list[currPos].bind_label;
                        collect(2, result_data_list.list[currPos].bind_label_id,1,listId,enterColumAction,1);
                        if(result_data_list.list[currPos].tab=="小产品"){
                        	 window.location.href = result_data_list.list[currPos].url[0];
                        	}else{
                        		  window.location.href = "landi.htm?id=" + id + "&label=" + label + "&is_purchased=" + is_purchased + "&desc=" + encodeURIComponent(desc);
                        		}
                    }
                }else if(type == 21){
                	getSubjectPoster(id);
                	}
            }
        }
        function settopMenustyle() {
            for (var i = 0; i < 3; i++) {
                $("topfocus" + i).style.visibility = "hidden";
            }
            iDebug("yanch listPage settopMenustyle topfocus="+topmenuPos)
            $("topfocus" + topmenuPos).style.visibility = "visible";
        }
        function setMenustyle() {
            for (var i = 0; i < 7; i++) {
                $("menu" + i).style.color = "#ababae";
                $("menu" + i).style.fontWeight = "normal";
            }
            $("menu_focus").style.visibility = "visible";
            $("menu" + menuBox.focusPos).style.color = "#fff";
            $("menu" + menuBox.focusPos).style.fontWeight = "bold";
        }
        function showFocus() {
            clearFocus();
            //$("focus").style.visibility="hidden"
            //$("focusIcon").src=""	
            iDebug("yanch listPage showFocus listPos="+listPos)
            $("focus").style.left = listPos_size[listPos][0] + "px";
            $("focus").style.top = listPos_size[listPos][1] + "px";
            if(noMenu){
            	$("focus").style.top -=33;
            	}
            $("focusImg").src = $("list" + listPos).src;
            $("focusIcon").src = $("icon" + listPos).src;
            var name = Name[listPos];
            if (getStrChineseLength(name) > 10) {
                name = "<marquee scrolldelay='150' width='250'>" + name + "</marquee>";
            }
            $("focusText").innerHTML = name;
            $("focusImg").width = 437 - 40;
            $("focusImg").height = 268 - 40;
            var timer = setInterval(function() {
                if ($("focusImg").src != "") {
                    clearTimeout(timer);
                    $("focus").style.visibility = "visible";
                }
            },
            20)
        }
        function clearFocus() {
            $("focus").style.visibility = "hidden";
            $("focusIcon").src = "";
            $("focusImg").src = "";
            $("focusText").innerHTML = "";
        }
        function is_lastPage() { //判断是否是最后一页
            if (currPage == lastPage) {
                for (var i = 0; i < 6; i++) {
                    $("con" + i).style.visibility = "visible";
                }
                iDebug("yanch listPage is_lastPage listLen=" + listLen);
                var index = listLen - (lastPage - 1) * 6;
                for (var i = index; i < 6; i++) {
                    $("con" + i).style.visibility = "hidden";
                }
            }
        }
        function initPage() { //init页码
        	$("currPage").innerText = currPage;
        	$("totalPage").innerText = lastPage;
        	$("slash").innerText = "/"
            /*clearPage();
            iDebug("yanch initPage lastPage=" + lastPage);
            for (var i = 0; i < lastPage; i++) {
                $("page_icon" + i).style.display = "block";
                $("page_icon" + i).src = "dian-ct.png";
            }
            var curr = currPage - 1;
            $("page_icon" + curr).src = "dian-f1.png";*/
        }
        function clearPage() {
            for (var i = 0; i < 4; i++) {
                $("page_icon" + i).style.display = "none";
                //$("page_icon"+i).src="dian2-ct.png";
            }
        }
        function moveCon() {//没有菜单，整体上移
        	for(var i = 0;i<6;i++){
        		//iDebug("yanch "+$("con"+i).style.top)
        		//var str = $("con"+i).style.top.substring($("con"+i).style.top.indexOf("p"))
        		//var index = $("con"+i).style.top.indexOf("p");
        		//iDebug("yanch moveCon index="+$("con"+i).style.top)
        		//var str = $("con"+i).style.top.substring(0,index)
        		//iDebug("yanch moveCon str="+str)
        		$("con"+i).style.top -= 33
        		iDebug("yanch 111"+$("con"+i).style.top)
        		}
        		noMenu = true;
        		$("page").style.top -=18;
        	}
        function showPop(url, callback) {
            iDebug("-------showPop-----------------");
            //window.frames["ifr_10"].location.href = url;
            $("ifr_0").src = url;
            var flag = true;
            $("ifr_0").onload = function() {
                iDebug("why here second onload???");
                if (!flag) return;
                framesId = "ifr_0";
                iDebug("---------------in--onload");
                popFlag = true;
                callback("ifr_0");
                keyFlag = true;
                $("ifrDiv_0").style.visibility = "visible";
                flag = false;
                $("focus").style.visibility = "hidden"
            }
            //focusOutDetail();
        }
        function hidePop() {
            iDebug("--------1-------hidePop--window.frames:" + window.frames["ifr_0"]);
            if (window.frames["ifr_0"]) {
                iDebug("------2---------hidePop-----ifr_0---");
                //@pengjiao 2014.09.25   33上回看pop弹出框，焦点会先跳到上次点播的集数，再跳到第一个 
                if (window.frames["ifr_0"].hiddenPopDiv) window.frames["ifr_0"].hiddenPopDiv(0);
                popFlag = false;
                $("ifrDiv_0").style.visibility = "hidden";
            }
            iDebug("------------hidePop--popFlag==" + popFlag);
            $("focus").style.visibility = "visible"
            //focusOnDetail();
        }
         function setIcon(_tag) {//角标的处理,根据tag值判断
            iDebug("index setIcon _tag=" + _tag);
            var str = ""
            if (_tag == "free") {
                str = "mianfei.png";
            } else if (_tag == "releasetime") {
                str = "zuixin.png";
            } else if (_tag == "hot") {
                str = "re.png";
            } else if (_tag == "recommend") {
                str = "tuijian.png";
            } else if (_tag == "only") {
                str = "dubo.png";
            } else if (_tag == "premiere") {
                str = "shoubo.png";
            } else if (_tag == "topic") {
                str = "zhuanti.png";
            } else if(_tag == "prefecture"){
                str = "pinpai.png";
            }else{
            	str = "";
            	}
            return str;
        }
        function Posrecord(){//焦点记忆的处理，单独提出来写个方法
        	if (typeof getGlobalVar("ListPagePosarea") != "undefined"&&getGlobalVar("ListPagePosarea") != null ) { //焦点记忆和当前页数的记录
                iDebug("yacnh listPage init backflag==1");
                Posarea = getGlobalVar("ListPagePosarea")
                iDebug("yanch Posrecord Posarea="+Posarea)
                listPos = getGlobalVar("ListPagelistPos");
                iDebug("yacnh listPage init listPos="+listPos);
                menuPos = getGlobalVar("ListPagemenuPos");
                topmenuPos = getGlobalVar("ListPagetopmenuPos");
                currPage = getGlobalVar("ListPagecurrPage");
                var changepage = currPage - 1;
            }
        	}
        function GoBack(){
			    var length=	getGlobalVar("jyjyfrom").length;
		      var from=getGlobalVar("jyjyfrom")
		      iDebug("yanch landi goBack length="+length)
		      for(var i=0;i<length;i++){
			        var url=from[i].url
			       iDebug("yanch goBack backurl ="+url+";;"+i+";;;window="+window.location.href)
			       if(url.indexOf("ListPage.htm")>-1){
				        var from=getGlobalVar("jyjyfrom");
				        from.splice(i);
				        setGlobalVar("jyjyfrom",from);
				     }
			  }
			     window.location.href=getGlobalVar("jyjyfrom").pop().url
	      }
    </script>
    
    <body background="bg.jpg" leftmargin="0" topmargin="0" onload="init()">
        <!--logo-->
        <div style="position:absolute;left:65px;top:51px;width:200px;color:#fff;font-size:34px;">
            家峪教育 |
        </div>
        <div id="name" style="position:absolute;left:228px;top:53px;color:#a7abb6;font-size:32px;">
            小学
        </div>
        <!--top右边-->
        <div style="position:absolute;left:922px;top:28px;width:50px; height:50px;">
            <img src="kecheng.png" width="94" height="75" />
        </div>
        <div id="topfocus0" style="position: absolute; left: 909px; top: 22px; width: 50px; height: 50px; visibility:hidden;">
            <img src="ly-focus1.png" width="120" height="100" />
        </div>
        <div style="position:absolute;left:1034px;top:29px;width:50px; height:50px;">
            <img src="jifen.png" width="94" height="75" />
        </div>
        <div id="topfocus1" style="position: absolute; left: 1023px; top: 22px; width: 50px; height: 50px; visibility:hidden;">
            <img src="ly-focus1.png" width="120" height="100" />
        </div>
        <div style="position:absolute;left:1140px;top:29px;width:50px; height:50px;">
            <img src="search.png" width="94" height="75" />
        </div>
        <div id="topfocus2" style="position: absolute; left: 1128px; top: 22px; width: 50px; height: 50px; visibility:hidden;">
            <img src="ly-focus1.png" width="120" height="100" />
        </div>
        <!--nav-->
        <div id="nav" style="position:absolute;left:50px;top:122px;width:1054px; height:40px;">
            <table border="0" cellpadding="0" cellspacing="0" style="position:absolute;left:0px;width:1254px;height:40px;color:#ababae;font-size:28px; text-align:center;">
                <tr>
                    <td id="menu0" width="150">
                    </td>
                    <td id="menu1" width="150">
                    </td>
                    <td id="menu2" width="150">
                    </td>
                    <td id="menu3" width="150">
                    </td>
                    <td id="menu4" width="150">
                    </td>
                    <td id="menu5" width="150">
                    </td>
                    <td id="menu6" width="150">
                    </td>
                    <td id="menu6" width="150">
                    </td>
                </tr>
            </table>
        </div>
        <!--中间内容-->
        <div id="con0" style="position:absolute;left:65px;top:200px;width:375px; height:210px; visibility:hidden">
            <img id="list0" src="" width="375" height="210" />
            <img id="icon0" src="" width="34" height="34" style="position:absolute; left:-1px; top:-1px"
            />
            <div id="text0" style="text-align:center;position:absolute;top:170px;width:365px;height:40px;line-height:40px;background:url(xx-mb1.png);padding-left:10px;color:#fff;font-size:22px;">
                英语拼拼
            </div>
        </div>
        <div id="con1" style="position:absolute;left:450px;top:200px;width:375px; height:210px; visibility:hidden">
            <img id="list1" src="" width="375" height="210" />
            <img id="icon1" src="" width="34" height="34" style="position:absolute; left:-1px; top:-1px"
            />
            <div id="text1" style="text-align:center;position:absolute;top:170px;width:365px;height:40px;line-height:40px;background:url(xx-mb1.png);padding-left:10px;color:#fff;font-size:22px;">
                英语拼拼
            </div>
        </div>
        <div id="con2" style="position:absolute;left:835px;top:200px;width:375px; height:210px; visibility:hidden">
            <img id="list2" src="" width="375" height="210" />
            <img id="icon2" src="" width="34" height="34" style="position:absolute; left:-1px; top:-1px"
            />
            <div id="text2" style="text-align:center;position:absolute;top:170px;width:365px;height:40px;line-height:40px;background:url(xx-mb1.png);padding-left:10px;color:#fff;font-size:22px;">
                英语拼拼
            </div>
        </div>
        <!--第二排-->
        <div id="con3" style="position:absolute;left:65px;top:422px;width:375px; height:210px; visibility:hidden">
            <img id="list3" src="" width="375" height="210" />
            <img id="icon3" src="" width="34" height="34" style="position:absolute; left:-1px; top:-1px"
            />
            <div id="text3" style="text-align:center;position:absolute;top:170px;width:365px;height:40px;line-height:40px;background:url(xx-mb1.png);padding-left:10px;color:#fff;font-size:22px;">
                英语拼拼
            </div>
        </div>
        <div id="con4" style="position:absolute;left:450px;top:422px;width:375px; height:210px; visibility:hidden">
            <img id="list4" src="" width="375" height="210" />
            <img id="icon4" src="" width="34" height="34" style="position:absolute; left:-1px; top:-1px"
            />
            <div id="text4" style="text-align:center;position:absolute;top:170px;width:365px;height:40px;line-height:40px;background:url(xx-mb1.png);padding-left:10px;color:#fff;font-size:22px;">
                英语拼拼
            </div>
        </div>
        <div id="con5" style="position:absolute;left:835px;top:422px;width:375px; height:210px; visibility:hidden">
            <img id="list5" src="" width="375" height="210" />
            <img id="icon5" src="" width="34" height="34" style="position:absolute; left:-1px; top:-1px"
            />
            <div id="text5" style="text-align:center;position:absolute;top:170px;width:365px;height:40px;line-height:40px;background:url(xx-mb1.png);padding-left:10px;color:#fff;font-size:22px;">
                英语拼拼
            </div>
        </div>
        <!--page-->
        <div id="page" style="position:absolute;left:609px;top:654px;height:20px;">
        	<span id="currPage" style="font-size:36px;color:#fff"></span><span id="slash" style="font-size:28px;color:#909fb5"></span><span id="totalPage" style="font-size:28px;color:#909fb5"></span>
            <!--table>
                <tr>
                    <td>
                        <img id="page_icon0" src="dian-ct.png" width="15" height="15" style="display:none"
                        />
                    </td>
                    <td>
                        <img id="page_icon1" src="dian-ct.png" width="15" height="15" style="display:none"
                        />
                    </td>
                    <td>
                        <img id="page_icon2" src="dian-ct.png" width="15" height="15" style="display:none"
                        />
                    </td>
                    <td>
                        <img id="page_icon3" src="dian-ct.png" width="15" height="15" style="display:none"
                        />
                    </td>
                </tr-->
            </table>
        </div>
        <!--焦点-->
        <div id="menu_focus" style="position: absolute; left: 135px; top: 97px; visibility:hidden">
            <img src="nav-focus1.png" />
        </div>
        <div id="focus" style="position: absolute; left: 801px; top: 389px; width: 455px; height: 288px; z-index: 333; visibility:hidden">
            <div style="position: absolute; left:24px; top:24px;">
                <img id="focusImg" src="" width="178" height="192" />
            </div>
            <div style="position: absolute; left:22px; top:23px;">
                <img id="focusIcon" src="" width="34" height="34" />
            </div>
            <div style="position: absolute; left: 24px; bottom: 32px; width: 394px;">
                <img id="ketan" src="xx-mb1.png" width="397" height="50" />
            </div>
            <div id="focusText" style="text-align:center;position: absolute;left:35px;bottom:40px;color:#fff;font-size:28px;width:365px;height:40px;">
            </div>
            <div style="position:absolute; left:-8px; top:-10px; width:100%; height:100%;">
                <table width="100%" height="100%" border="0" cellspacing="0" cellpadding="0">
                    <tr>
                        <td width="40" height="40" style="background:url(focus_01.png);">&nbsp;
                            
                        </td>
                        <td style="background:url(focus_02.png);">&nbsp;
                            
                        </td>
                        <td width="40" style="background:url(focus_03.png);">&nbsp;
                            
                        </td>
                    </tr>
                    <tr>
                        <td style="background:url(focus_04.png);">&nbsp;
                            
                        </td>
                        <td>&nbsp;
                            
                        </td>
                        <td style="background:url(focus_05.png);">&nbsp;
                            
                        </td>
                    </tr>
                    <tr>
                        <td height="40" style="background:url(focus_06.png);">&nbsp;
                            
                        </td>
                        <td style="background:url(focus_07.png);">&nbsp;
                            
                        </td>
                        <td style="background:url(focus_08.png);">&nbsp;
                            
                        </td>
                    </tr>
                </table>
            </div>
        </div>
        <!--end-->
        <div id="ifrDiv_0" class="all" style="visibility:hidden;z-index:100;">
            <iframe id="ifr_0" name="ifr_0" style="position:absolute; border:0; width:1280px; height:720px;"
            src="">
            </iframe>
        </div>
    </body>

</html>