<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=gb2312" />
<meta name="page-view-size" content="1280*720">
<title></title>
<style>
p { display: block; -webkit-margin-before: 0em; -webkit-margin-after: 0em; -webkit-margin-start: 0px; -webkit-margin-end: 0px;text-indent:2em;}
#content img{padding:0px 10px 0px 0px;}
</style>
<script type="text/javascript" src="js/common.js"></script>
<script type="text/javascript">
var ajaxObj = null;
var contentArea = null;
var dataAjaxPath = "content.js";
var titleAjaxPath = "node.js";

var ajaxj = null;
function ajaxFooter(){         // 获取logo图片
  if (ajaxj != null) {
    ajaxj.requestAbort();
  }
  ajaxj = new AjaxClass();
  ajaxj.frame = window;
  ajaxj.charset = "gb2312";
  ajaxj.successCallback = function(_xmlHttp, _params) {
    var jsonData = eval('(' + _xmlHttp.responseText + ')');
    if(typeof(jsonData) != "undefined"){
      $("marqueeContent").innerText = jsonData.entryWord;
      $("nowTitle").innerText = jsonData.name;
    }
  };
  ajaxj.failureCallback = function(_xmlHttp, _params) {  
  };
  ajaxj.url = titleAjaxPath;
  ajaxj.requestData();
}

document.onkeydown = eventHandler;
document.onsystemevent = eventHandler;
function eventHandler(keycode){
  var e = keycode || event;
  var keycode = e.keyCode || e.which || e.charCode;
  switch (keycode) {
    case 1:   // up
    case 38:
      contentArea.changeUD(-1);
      return false;
      break;
    case 2:   // down
    case 40:  
      contentArea.changeUD(1);
      return false;
      break;
    case 32:
    case 339:
    case 640:
    case 8:
    case 27:
    case 340:
      window.history.go(-1);
      return false;
      break;
    case 3:   // left,back
    case 37:
      return false;
      break;
    case 4:   // right
    case 39:
      return false;
      break;
    case 13:
      return false;
      break;
  }
}

function ajaxLoadMenuData(){
  if (ajaxObj != null) {
    ajaxObj.requestAbort();
  }
  ajaxObj = new AjaxClass();
  ajaxObj.frame = window;
  ajaxObj.charset = "gbk";
  ajaxObj.successCallback = function(_xmlHttp, _params) {
    var jsonData = eval('(' + _xmlHttp.responseText + ')');
    if(typeof(jsonData) != "undefined" && jsonData.length > 0){
      contentArea = new innerNode();            //实例化innerNode构造成员
      contentArea.panelData = jsonData[0];
      contentArea.init();
    }
  };
  ajaxObj.failureCallback = function(_xmlHttp, _params) {
  };
  ajaxObj.url = dataAjaxPath;
  ajaxObj.requestData();
}

function init(){
  ajaxLoadMenuData();
  ajaxFooter();
}

window.onload = function(){
  init();
}


var innerNode = function() {};
innerNode.prototype = {
  itemPos:0,
  panelData:[],
  pageContent:266,
  maxTitleSize:28,
  scrollBox:null,
  init: function() {
      if(typeof(this.panelData) != "undefined" && this.panelData != ""){
        this.currPage = 0;
        //this.initTitle();  
        this.initContent();
      }else{
        this.noItemData();
      }
  },
  changeUD: function(_num) {
      if(this.currPage==0&&_num<0 || this.currPage == this.totalPage-1&&_num>0 || this.scrollBox==null){
        return;
      }else{
        this.currPage = this.currPage+_num;
      }
      this.initContent();
      this.scrollBox.scroll(this.currPage);
      $("content").style.top = -this.pageContent*this.currPage+"px";
  },
  noItemData: function() {
      $("content").innerText = "暂无数据";
      this.noScrollBar();
  },
  initTitle: function() {
      $("navTitle").innerHTML = this.panelData.title;
      if(getStrChineseLength(this.panelData.title) > this.maxTitleSize){
        $("navTitle").innerHTML = "<marquee width=840 scrollamount=7\">"+this.panelData.title+"</marquee>";
      }
  },
  initContent: function() {
    $("adPic").src = this.panelData.entryImage.imageUrl;
    if(this.panelData.content == ""){
      $("content").innerHTML = "暂无相关介绍";
    }else{
      $("content").innerHTML = this.panelData.content;
    }
    $("content").style.top = -this.pageContent*this.currPage+"px";
    var that = this;
    setTimeout(function(){
        that.totalPage = Math.floor($("content").offsetHeight/that.pageContent)+1;
        that.initScroll();
    },200);
  },
  initScroll: function() {
    if(this.totalPage > 1){
        $("listBarDiv").style.visibility = "visible";
        this.scrollBox = new ScrollBar("listBarDiv", "listBarDiv", window);
        this.scrollBox.init(this.totalPage, 1, 413, 0, 41);
        this.scrollBox.scroll(this.currPage);
    }else{
        this.noScrollBar();
    }
  },
  noScrollBar: function() {
    $("listBarDiv").style.visibility = "hidden";
    this.scrollBox = null;
  }
}
</script>
</head>
<body leftmargin="0" topmargin="0" background="images/bg.png">
  <!--top-->
  <div style="position:absolute;left:577px;top:55px; width:26px; height:25px; background:url(images/arrow00.png);"></div>
    <div style="position:absolute;left:611px;top:46px; width:187px; height:44px; background:url(images/title03.png);"></div>
  <div style="position:absolute;left:950px;top:47px; width:300px;font-size:32px; color:#263b3e;">毕节朱昌镇欢迎您！</div>
    <div style="position:absolute;left:78px;top:123px; width:563px; height:315px; background:url(images/bg1_1.png);"></div>
  <!--跑马灯-->
  <div style="position:absolute;left:131px;top:625px; width:984px;line-height:50px; font-size:23px; color:#f0f0f0;">
    <marquee id="marqueeContent">
    </marquee>
  </div>
  <!--右侧列表-->
  <div style="position:absolute;left:78px;top:117px; width:1125px;height:476px; background:url(images/tab_bg2.png);">
    <div style="position:absolute;left:26px;top:0px;width:1046px;height:61px; border-bottom:2px solid #cfdce7;padding-left:16px; line-height:61px; font-size:30px; color:#4a671c;">
      > <span id="nowTitle"></span>
    </div>
    <div style="position:absolute;left:26px;top:80px;width:100px;height:100px;"><img id="adPic" src="" width="287" height="374"></div>
    <!--内容容器-->
    <div style="position:absolute;left:335px;top:72px;width:744px;height:386px; line-height:38px; font-size:24px; color:#000;text-indent:2em;overflow: hidden;">
      <!-- 实际内容区 -->
      <div id="content" style="position: absolute; left: 0px; top: 0px; width:744px;font-size: 24px;font-family:SimSun;">
      </div>
    </div>        
    <!--翻页栏-->
    <div style="position:absolute;right:8px;top:62px; width:13px;height:413px; background:url(images/page_bg1.png);" id="scrollBarDiv">
      <div style="position:absolute; left:-7px; top:40px;  width:13px;height:41px; background:#558589;visibility:hidden" id="listBarDiv">
      </div>
    </div>
  </div>  
</body>
</html>
