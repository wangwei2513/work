<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=gb2312" />
<meta name="page-view-size" content="1280*720">
<title></title>
</head>
<body leftmargin="0" topmargin="0" >
	<div id="body" style="position:absolute; width:1280px; height:720px; left: 0px; top: 0px;background:url(images/bg.png);">
		<!--logo-->
		<!--top-->
	    <div style="position:absolute;left:577px;top:55px; width:26px; height:25px; background:url(images/arrow00.png);"></div>
	    <div style="position:absolute;left:611px;top:46px; width:187px; height:44px; background:url(images/title01.png);"></div>
		<div style="position:absolute;left:950px;top:47px; width:300px;font-size:32px; color:#263b3e;">毕节朱昌镇欢迎您！</div>
	    <div style="position:absolute;left:78px;top:123px; width:563px; height:315px; background:url(images/bg1_1.png);"></div>
	    <!--跑马灯-->
		<div style="position:absolute;left:131px;top:625px; width:984px;line-height:50px; font-size:23px; color:#f0f0f0;">
			<marquee id="marqueeContent">
			</marquee>
		</div>
		<!--列表页-->
		<div id="listFrame" style="position:absolute; width:1280px; height:720px; left: 0px; top: 0px; border: none; background-color: transparent;">
		    <!--左侧列表-->
		    <div style="position:absolute;left:78px;top:119px; width:234px;height:388px;">
		    	<table border="0" cellpadding="0" cellspacing="0" width="100%" height="100%" style="font-size:30px; color:#fff; text-align:center;">
		        	<tr height="64">
		            	<td id="menu0" style="background:url(images/list_ct.png);"></td>
		            </tr>
		            <tr height="17"><td></td></tr>
		            <tr height="64">
		            	<td id="menu1" style="background:url(images/list_ct.png);"></td>
		            </tr>
		            <tr height="17"><td></td></tr>
		            <tr height="64">
		            	<td id="menu2" style="background:url(images/list_ct.png);"></td>
		            </tr>
		            <tr height="17"><td></td></tr>
		            <tr height="64">
		            	<td id="menu3" style="background:url(images/list_ct.png);"></td>
		            </tr>
		            <tr height="17"><td></td></tr>
		            <tr height="64">
		            	<td id="menu4" style="background:url(images/list_ct.png);"></td>
		            </tr>
		            <tr height="17"><td></td></tr>
		            <tr height="64">
		            	<td id="menu5" style="background:url(images/list_ct.png);"></td>
		            </tr>
		        </table>
		    </div>
		    <!--右侧列表-->
		    <div style="position:absolute;left:331px;top:116px; width:872px;height:492px; background:url(images/tab_bg1.png);">
		    	<div style="position:absolute;left:29px;top:0px;width:806px;height:490px;">
		        	<div style="position:absolute;left:0px;top:61px;width:806px;height:1px; background:#bdcddf;"></div>
		            <div style="position:absolute;left:0px;top:122px;width:806px;height:1px; background:#bdcddf;"></div>
		            <div style="position:absolute;left:0px;top:183px;width:806px;height:1px; background:#bdcddf;"></div>
		            <div style="position:absolute;left:0px;top:244px;width:806px;height:1px; background:#bdcddf;"></div>
		            <div style="position:absolute;left:0px;top:305px;width:806px;height:1px; background:#bdcddf;"></div>
		            <div style="position:absolute;left:0px;top:366px;width:806px;height:1px; background:#bdcddf;"></div>
		            <div style="position:absolute;left:0px;top:427px;width:806px;height:1px; background:#bdcddf;"></div>
		        	<div id="itemFocus" style="position:absolute;left:-18px;top:46px;width:846px;height:99px; background:url(images/listR_f1.png);visibility:hidden;"></div>
		        	<table border="0" cellpadding="0" cellspacing="0" width="100%" height="100%" style="position:absolute;left:0px;font-size:24px; color:#000;">
		            	<tr height="61">
		                	<td style="padding-left:16px; font-size:30px; color:#4a671c;">
		                	><span id="nowTitle"></span>
		                	</td>
		                </tr>
		                <tr id="list0" height="61" >
		                	<td id="list_title0" style="padding-left:16px;">
		                	</td>
		                </tr>
		                <tr id="list1" height="61">
		                	<td id="list_title1" style="padding-left:16px;">
		                	</td>
		                </tr>
		                <tr id="list2" height="61">
		                	<td id="list_title2" style="padding-left:16px;">
		                	</td>
		                </tr>
		                <tr id="list3" height="61">
		                	<td id="list_title3" style="padding-left:16px;">
		                	</td>
		                </tr>
		                <tr id="list4" height="61">
		                	<td id="list_title4" style="padding-left:16px;">
		                	</td>
		                </tr>
		                <tr id="list5" height="61" >
		                	<td id="list_title5" style="padding-left:16px;">
		                	</td>
		                </tr>
		                <tr id="list6" height="61">
		                	<td id="list_title6" style="padding-left:16px;">
		                	</td>
		                </tr>
		            </table>
		   		</div>
		  		<!--翻页栏-->
				<div style="position:absolute;right:1px;top:1px; width:13px;height:490px; background:url(images/page_bg1.png);" id="scrollBarDiv">
					<div style="position:absolute; left:-7px; top:40px;  width:13px;height:41px; background:#558589;visibility:hidden" id="listBarDiv">
					</div>
				</div>
		    </div>
		</div>
		<!-- 内容页 -->
	 	<div id="contentFrame" style="position:absolute;left:200px;top:95px;width: 910px; height: 432px;border: none; background-color: transparent;display:none;">
	 		<!-- 标题 -->
	 		<div id="navTitle" style="position: absolute; left: 0px; top: 45px; width: 900px; height: 53px; font-size: 28px; color: #000000; line-height: 54px; text-align: center; border-bottom: 1px; font-weight: 600"></div>
	 		<!--内容-->
	 		<div style="position: absolute; left: -16px; top: 26px; width: 945px; height: 455px;background:url(images/rrrr.png);"></div>
		    <div style="position: absolute; left: 23px; top: 100px; width: 900px; height: 372px;overflow: hidden;">
			    <div id="content" style="position: absolute; left: 0px; top: 0px; width: 845px;font-size: 24px;line-height:29px;">
			    </div>
		    </div>
	  		<!--翻页栏-->
			<div style="position: absolute; left: 888px; top: 128px; width: 4px; height: 342px; background-color: #50a4d5;" id="scrollBarDiv">
				<div style="position:absolute; left:-12px; top:40px; width:29px; height:61px; background-image: url(images/page.png); visibility:hidden" id="contentBarDiv">
				   <div style="position:absolute; left:0px; top:0px; width:29px; height:29px; font-size:24px; color:#ffffff; text-align:center;" id="currPage_con"></div>
				   <div style="position:absolute; left:0px; top:31px; width:29px; height:29px; font-size:24px; color:#ffffff; text-align:center;" id="totalPage_con">
				   </div>
				</div>
			</div>
	 	</div>
	 </div>
</body>
<script type="text/javascript" src="js/common.js"></script>
<script type="text/javascript">
var dataAjaxPath;
var menuAjaxPath = "menu.js";
var titleAjaxPath = "node.js";
var ajaxObj;
var columnAjaxObj = null;
var menuData;               //menuajax请求得到的数据
var listData;   			//datajax请求得到的数据
var columnBox = null;
var listArea = null;        //列表区
var contentArea = null;		//内容区
var ajaxObj = null;

var menuLen = 6;			//menu菜单栏最多显示5个
var listPos = 0;            //点击进入的列表项数据焦点
var focusArea = 0;

var filePath = "";

var ajaxj = null;
function ajaxFooter(){         // 获取logo图片
        if (ajaxj != null) {
            ajaxj.requestAbort();
        }
        ajaxj = new AjaxClass();
        ajaxj.frame = window;
        ajaxj.charset = "gb2312";
        ajaxj.successCallback = function(_xmlHttp, _params) {
            var jsonData = eval('(' + _xmlHttp.responseText + ')');
            if(typeof(jsonData) != "undefined"){
                $("marqueeContent").innerText = jsonData.entryWord;
            }
        };
        ajaxj.failureCallback = function(_xmlHttp, _params) {  
        };
        ajaxj.url = titleAjaxPath;
        ajaxj.requestData();
}

document.onkeydown = eventHandler;
document.onsystemevent = eventHandler;
function eventHandler(keycode){
  var e = keycode || event;
  var keycode = e.keyCode || e.which || e.charCode;
  switch (keycode) {
    case 1:   // up
    case 38:
		changeUD(-1);
      return false;
      break;
    case 2:   // down
    case 40:
		changeUD(1);
      return false;
      break;
    case 3:   // left
    case 37: 
 		changeLR(-1);  
      return false;
      break;
    case 4:   // right
    case 39:
  		changeLR(1);   
      return false;
      break;
    case 13:
      doSelect();
      return false;
      break;
    case 8:    
    case 27:
    case 340:
    case 339:
    case 399:
    case 32:
    case 399:
    case 640:
      return doBack();
      break;
  }
}

function changeLR(_num){
	if(_num > 0) {     				//right
	    if(focusArea == 0) {
	      	focusArea = 1;
			clearFocus();
			//listArea.onFocus = true;
			listArea.showFocus();	      	
	    }else if(focusArea == 1) {
			return;
	    }else if(focusArea == 2) {
	    	return;
	    } 
	}else{            				//left
	    if(focusArea == 0) {
	    	return;
	    }else if(focusArea == 1) {
	      	listArea.changeLeft();
	      	focusArea = 0;       
			showFocus();	    	
	    }else if(focusArea == 2) {
	    	return;
	    } 		
	}
}

function changeUD(_num){
	if(_num < 0) {                 //up
	    if(focusArea == 0) {
	    	if(columnBox.position + _num < 0) return;
		    clearFocus();
		    columnBox.changeList(_num);
		    switchTab();
			showFocus();
	    }else if(focusArea == 1) {
	    	listArea.changeUD(-1);
	    }else if(focusArea == 2) {
	    	contentArea.changeUD(-1);
	    } 
	}else{						  //down
	    if(focusArea == 0) {
	    	if(columnBox.position + _num > menuData.length) return;
		    clearFocus();
		    columnBox.changeList(_num);
		    switchTab();
			showFocus();
	    }else if(focusArea == 1) {
	    	listArea.changeUD(1);
	    }else if(focusArea == 2) {
	    	contentArea.changeUD(1);
	    } 		
	}
}

function doSelect(){
    if(focusArea == 0) {
      	return;
    }else if(focusArea == 1) {
    	focusArea = 2;
    	listPos = listArea.itemBox.position;
    	isHidePanel();
    	contentArea.mainData = listArea.listData[listPos];
        contentArea.init();
    }else if(focusArea == 2) {
    	return;
    } 	
} 

function doBack() {
    if(focusArea == 0) {
    	window.history.go(-1);
      	return true;
    }else if(focusArea == 1) {
		changeLR(-1);
    	return false;
    }else if(focusArea == 2) {
    	isHidePanel();
    	focusArea = 1;
    	return false;
    } 		
}
  
function isHidePanel() {
	$("listFrame").style.display = $("listFrame").style.display == "none" ? "block" : "none";
	$("contentFrame").style.display = $("listFrame").style.display == "none" ? "block" : "none";
	// 在列表页内容页切换时背景也切换
	// $("body").style.background = $("listFrame").style.display == "block" ? "url(images/bg.png)" : "url(images/bg_03.jpg)";
}

function clearFocus(){
	if(focusArea == 0){
		$("menu"+columnBox.focusPos).style.background="url(images/list_ct.png)";
		$("menu"+ columnBox.focusPos).style.color = "#fff";
	}else if(focusArea == 1){
		$("menu"+columnBox.focusPos).style.background="url(images/list_fff.png)";
		$("menu"+ columnBox.focusPos).style.color = "#000";
		// $("menu"+columnBox.focusPos).style.color = "#e28a0d";
	}
}

function showFocus(){
	if(focusArea == 0){
		$("menu"+columnBox.focusPos).style.background="url(images/list_f1.png)";
		$("menu"+ columnBox.focusPos).style.color = "#fff";
	}else if(focusArea == 1){
		// $("menu"+columnBox.focusPos).style.backgroundImage="url(images/mf01.png)";
		// $("menu"+columnBox.focusPos).style.color = "#e28a0d";
	}	
}

function showMenu(){
	columnBox = new showList(menuLen,menuData.length,0,0,window);
	columnBox.haveData = function(_list){
		$("menu"+ _list.idPos).style.visibility = "visible";
		$("menu"+ _list.idPos).style.color = "#fff";
		$("menu"+ _list.idPos).innerText = menuData[_list.dataPos].name;
		$("menu"+ _list.idPos).style.background = "url(images/list_ct.png)";
	};
	columnBox.notData = function(_list){
		$("menu"+ _list.idPos).style.visibility = "hidden";
	};
	columnBox.startShow();
	clearFocus();
	showFocus();  			
  	switchTab();  								// 打开tab
}

function noMenuData(){
	for(var i=0;i<menuLen;i++){
		$("menu"+i).style.visibility = "hidden";
	}
}

function ajaxLoadMenuData(){
	if (ajaxObj != null) {
		ajaxObj.requestAbort();
	}
	ajaxObj = new AjaxClass();
	ajaxObj.frame = window;
	ajaxObj.charset = "gbk";
	ajaxObj.successCallback = function(_xmlHttp, _params) {
		var jsonData = eval('(' + _xmlHttp.responseText + ')');
		if(typeof(jsonData) != "undefined" && jsonData.length > 0){
			menuData = jsonData;
			showMenu();
		}else{
			noMenuData();
		}
        document.body.style.visibility = "visible";
	};
	ajaxObj.failureCallback = function(_xmlHttp, _params) {
		noItemData();	
	};
	ajaxObj.url = menuAjaxPath;
	ajaxObj.requestData();
}

function ajaxLoadMainData(){
  if (columnAjaxObj != null) {
    columnAjaxObj.requestAbort();
  }
  columnAjaxObj = new AjaxClass();
  columnAjaxObj.frame = window;
  columnAjaxObj.charset = "gbk";
  columnAjaxObj.successCallback = function(_xmlHttp, _params) {
    var jsonData = eval('(' + _xmlHttp.responseText + ')');
    if(typeof(jsonData) != "undefined" && jsonData.length > 0){
	  listArea.listData = jsonData;
	  listArea.nowTitle = menuData[columnBox.position].name;
	  listArea.init();
    }
  };
  columnAjaxObj.failureCallback = function(_xmlHttp, _params) {
  };
  columnAjaxObj.url = dataAjaxPath;
  columnAjaxObj.requestData();
}

function switchTab(){		// 切换提供给列表区的数据,对右侧列表提供不同的dataAjaxPath
	filePath = menuData[columnBox.position].nodePath;        // 分类文件夹的名称
  	if(filePath.indexOf("/") > -1){
    	var tempArr = filePath.split("/");
    	filePath = tempArr[tempArr.length-1];
    }
	dataAjaxPath = filePath+"/content.js";	
	ajaxLoadMainData();
}

function init(){
	listArea = new subNode();
	contentArea = new contentNode();
	ajaxLoadMenuData();
	ajaxFooter();
}

window.onload=function(){
	init();
}






var subNode = function() {};
subNode.prototype ={
	listData:[],     				// 表示内容区的得到的数组
	nowTitle:"",
	itemBox:null,
	scrollBox:null,
	itemPos:0,		
	itemMaxSize:24,          // 每个条目允许的文字最多，超出用...代替
	itemLen : 7,          	// 内容区条目数量     
	init: function() { 		        
		if(typeof(this.listData) != "undefined" && this.listData.length != ""&& this.listData.length != null){
				$("nowTitle").innerText = this.nowTitle;
		      	this.showItem();
		}else{
		     	 this.noItemData();
		}
	},
	changeLeft: function() {
    	this.clearFocus();
	},
	changeUD: function(_num) {
		if(this.itemBox.position + _num < 0 || this.itemBox.position + _num > this.listData.length) return;
		this.clearFocus();
		this.itemBox.changeList(_num);
		if(this.itemBox.dataSize > 1) {
		    this.scrollBox.scroll(this.itemBox.position);
		}
		this.showFocus();
	},
	noItemData: function() {
	  	for(var i=0;i<this.itemLen;i++){
		    $("list"+i).style.visibility = "hidden";
		}
	},
	showItem: function() {
		var that = this;				//避免this指向偏移
		this.itemBox = new showList(that.itemLen,that.listData.length,that.itemPos,46,window);
		this.itemBox.focusDiv = "itemFocus";
		this.itemBox.listHigh = 61;
		this.itemBox.listSign = 0;
		this.itemBox.showType = 0;
		this.itemBox.haveData = function(_list){  
			$("list" + _list.idPos).style.visibility = "visible";
		    $("list_title" + _list.idPos).innerHTML = subStr(that.listData[_list.dataPos].title,that.itemMaxSize,"...");
		};
		this.itemBox.notData = function(_list){
			$("list" + _list.idPos).style.visibility = "hidden";
		    $("list_title" + _list.idPos).innerHTML = "";
		};
		this.itemBox.startShow(); 	
		this.initScroll();
	},
	clearFocus: function() {
		$("itemFocus").style.visibility = "hidden";
		$("list_title" + this.itemBox.focusPos).innerHTML = subStr(this.listData[this.itemBox.position].title,this.itemMaxSize,"...");	
	},
	showFocus: function() {
		$("itemFocus").style.visibility = "visible";
		if(getStrChineseLength(this.listData[this.itemBox.position].title) > this.itemMaxSize){
			$("list_title" + this.itemBox.focusPos).innerHTML = "<marquee direction=left width=520 height=26 scrollamount=5>"+this.listData[this.itemBox.position].title+"</marquee>";
		}			
	},
 	initScroll: function() {
		if(this.itemBox.dataSize > 1){
		    $("listBarDiv").style.visibility = "visible";
		    this.scrollBox = new ScrollBar("listBarDiv", "listBarDiv", window);
		    this.scrollBox.init(this.itemBox.dataSize, 1, 490, 0, 41);
		    this.scrollBox.scroll(this.itemBox.position);
		}else{
		    this.noScrollBar();
		}
	},
 	noScrollBar: function() {
		$("listBarDiv").style.visibility = "hidden";
		this.scrollBox = null;
	}
}




var contentNode = function() {};
contentNode.prototype ={
	mainData:[],
	currPage:0,
	totalPage:0,
	pageContent:260,
	maxTitleSize:27,
	scrollBox:null,
	init: function() {
	    if(typeof(this.mainData) != "undefined" && this.mainData.length != "" && this.mainData != null){
	      this.currPage = 0;
	      this.initTitle();      
	      this.initContent();
	    }else{
	      this.noItemData();
	    }
	},
 	changeUD: function(_num) {
	    if(this.currPage==0&&_num<0 || this.currPage == this.totalPage-1&&_num>0 || this.scrollBox==null){
	      	return;
	    }else{
	    	this.currPage = this.currPage+_num;
	    }
	    this.initContent();
	    this.scrollBox.scroll(this.currPage);
	    this.showScrollPage();
	    $("content").style.top = -this.pageContent*this.currPage + "px";
	},
	noItemData: function() {
		$("content").innerText = "暂无数据";
		this.noScrollBar();
	},
	initTitle: function() {
	    $("navTitle").innerHTML = this.mainData.title;
	    if(getStrChineseLength(this.mainData.title) > this.maxTitleSize){
	      	$("navTitle").innerHTML = "<marquee width=800; scrollamount=7\">"+this.mainData.title+"</marquee>";
	    }
	},
	initContent: function() {
	    if(this.mainData.content == ""){
	    	$("content").innerHTML = "暂无相关介绍";
	    }else{
	    	$("content").innerHTML = this.mainData.content;
	    }
	    $("content").style.top = -this.pageContent*this.currPage + "px";
	    var that = this;
	    setTimeout(function(){
		    that.totalPage = Math.floor($("content").offsetHeight/that.pageContent) + 1;
		    that.initScroll();
	    }, 100);
	},
 	initScroll: function() {
		if(this.totalPage>1){
		    $("contentBarDiv").style.visibility = "visible";
		    this.scrollBox = new ScrollBar("contentBarDiv", "contentBarDiv", window);
		    this.scrollBox.init(this.totalPage, this.totalPage, 342, 0, 61);
		    this.scrollBox.scroll(this.currPage);
		    this.showScrollPage();
		}else{
		    this.noScrollBar();
		}
	},
 	noScrollBar: function() {
		$("contentBarDiv").style.visibility = "hidden";
		$("currPage_con").innerText  = 0;
		$("totalPage_con").innerText = 0;
		this.scrollBox = null;
	},
 	showScrollPage: function() {
		if(this.totalPage>1){
		    if((this.totalPage+"").length >= 3){
		      	$("totalPage_con").style.fontSize = "19px";
		    }
		    if((this.currPage+"").length >= 3){
		     	$("currPage_con").style.fontSize = "19px";
		    }else{
		      	$("currPage_con").style.fontSize = "24px";
		    }
		    $("currPage_con").innerText  = this.currPage+1;
		    $("totalPage_con").innerText = this.totalPage;
		}
	}
}
</script>
</html>
