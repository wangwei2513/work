<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=gb2312" />
<meta name="page-view-size" content="1280*720">
<title></title>
<script type="text/javascript" src="js/common.js"></script>
<script type="text/javascript">
</script>
<script type="text/javascript">
var menuAjaxPath = "menu.js";
var titleAjaxPath = "node.js";
var dataAjaxPath = "";
var mainMenuPos = 0;
var columnBox = null;
var menuLen = 6;                // menu菜单栏最多显示6个
var focusArea = 0;              // 0左侧栏目区 1右侧内容区 2全屏图片预览区
var menuData = [];
var ajaxObj = null;
var abj = null;
var filePath = "";
var nowTitle = "";
var contentArea = null;

var ajaxj = null;
function ajaxFooter(){         // 获取logo图片
  if (ajaxj != null) {
    ajaxj.requestAbort();
  }
  ajaxj = new AjaxClass();
  ajaxj.frame = window;
  ajaxj.charset = "gb2312";
  ajaxj.successCallback = function(_xmlHttp, _params) {
    var jsonData = eval('(' + _xmlHttp.responseText + ')');
    if(typeof(jsonData) != "undefined"){
      $("marqueeContent").innerText = jsonData.entryWord;
    }
  };
  ajaxj.failureCallback = function(_xmlHttp, _params) {  
  };
  ajaxj.url = titleAjaxPath;
  ajaxj.requestData();
}

document.onkeydown = eventHandler;
document.onsystemevent = eventHandler;
function eventHandler(keycode) {
    var e = keycode || event;
    var keycode = e.keyCode || e.which || e.charCode;
    switch (keycode) {
    case 1:
    case 38:
        changeUD(-1);
        return false;
        break;
    case 2:
    case 40:
        changeUD(1);
        return false;
        break;
    case 3:
    case 37:
        changeLR(-1);
        return false;
        break;
    case 4:
    case 39:
        changeLR(1);
        return false;
        break;
    case 13:
        return false;
        break;
    case 8:
    case 27:
    case 340:
    case 32:
    case 339:
    case 640:
        doBack();
        return false;
        break
    }
}

function doBack() {
  setGlobalVar("mPos","");
  window.history.go(-1);
}

function changeLR(_num) {
  if(focusArea == 0 && _num > 0) {
    setGlobalVar("mPos",columnBox.position + "");
    focusArea = 1;
    clearFocus();
    contentArea.showFocus();
  }else if(focusArea == 1 && _num < 0) {
    contentArea.clearFocus();
    focusArea = 0;
    showFocus();
  }
}

function changeUD(_num) {
  if(focusArea == 0) {
    if(columnBox.position + _num < 0) return;
    if(columnBox.position + _num >= menuData.length) return ;
    clearFocus();
    columnBox.changeList(_num); 
    switchTab();
    showFocus();    
  }else if(focusArea == 1) {
    contentArea.changeUD(_num);
  }
}

function clearFocus(){
  if(focusArea == 0){
    $("menu" + columnBox.focusPos).style.background="url(images/list_ct.png)";
    $("menu" + columnBox.focusPos).style.color = "#fff";
  }else if(focusArea == 1){
    $("menu" + columnBox.focusPos).style.background="url(images/list_fff.png)";
    $("menu" + columnBox.focusPos).style.color = "#000";
  }
}

function showFocus(){
  if(focusArea == 0){
    $("menu" + columnBox.focusPos).style.background="url(images/list_f1.png)";
    $("menu" + columnBox.focusPos).style.color = "#fff";
  }else if(focusArea == 1){
  } 
}

function showMenu(){
  columnBox = new showList(menuLen,menuData.length,0,0,window);
  columnBox.haveData = function(_list){
    $("menu" + _list.idPos).style.visibility = "visible";
    $("menu" + _list.idPos).style.color = "#fff";
    $("menu" + _list.idPos).innerText = menuData[_list.dataPos].name;
    $("menu" + _list.idPos).style.background = "url(images/list_ct.png)";
  };
  columnBox.notData = function(_list){
    $("menu" + _list.idPos).style.visibility = "hidden";
  };
  columnBox.startShow();
  clearFocus();
  showFocus();        
  switchTab();                                            // 打开内容
}

function noMenuData(){
  for(var i=0;i<menuLen;i++){
    $("menu"+i).style.visibility = "hidden";
  }
}

function switchTab() {
  filePath = menuData[columnBox.position].nodePath;       //分类文件夹的名称
  if(filePath.indexOf("/") > -1){
    var tempArr = filePath.split("/");
    filePath = tempArr[tempArr.length-1];
  }
  nowTitle = menuData[columnBox.position].name;
  dataAjaxPath = filePath + "/content.js";
  ajaxLoadMainData();
}

function ajaxLoadMainData() {
  if (abj != null) {
    abj.requestAbort();
  }
  abj = new AjaxClass();
  abj.frame = window;
  abj.charset = "gbk";
  abj.successCallback = function(_xmlHttp, _params) {
    var jsonData = eval('(' + _xmlHttp.responseText + ')');
    if(typeof(jsonData) != "undefined"){
      contentArea = new innerNode();                      // 实例化innerNode构造成员
      contentArea.panelData = jsonData[0];
      contentArea.init()
    }
  };
  abj.failureCallback = function(_xmlHttp, _params) {
  };
  abj.url = dataAjaxPath;
  abj.requestData();
}

function ajaxLoadMenuData(){
  if (ajaxObj != null) {
    ajaxObj.requestAbort();
  }
  ajaxObj = new AjaxClass();
  ajaxObj.frame = window;
  ajaxObj.charset = "gbk";
  ajaxObj.successCallback = function(_xmlHttp, _params) {
    var jsonData = eval('(' + _xmlHttp.responseText + ')');
    if(typeof(jsonData) != "undefined" && jsonData.length > 0){
      menuData = jsonData;
      showMenu();
    }else{
      noMenuData();
    }
  };
  ajaxObj.failureCallback = function(_xmlHttp, _params) {
  };
  ajaxObj.url = menuAjaxPath;
  ajaxObj.requestData();
}

function init() { 
  ajaxLoadMenuData();
  ajaxFooter();
}

window.onload = function() {
    init();
}


var innerNode = function() {};
innerNode.prototype = {
  itemPos:0,
  panelData:[],
  pageContent:324,
  maxTitleSize:28,
  scrollBox:null,
  init: function() {
      if(typeof(this.panelData) != "undefined" && this.panelData != ""){
        this.currPage = 0;
        //this.initTitle();  
        $("nowTitle").innerText = nowTitle;    
        this.initContent();
      }else{
        this.noItemData();
      }
  },
  changeUD: function(_num) {
      if(this.currPage==0&&_num<0 || this.currPage == this.totalPage-1&&_num>0 || this.scrollBox==null){
        return;
      }else{
        this.currPage = this.currPage+_num;
      }
      this.initContent();
      this.scrollBox.scroll(this.currPage);
      $("content").style.top = -this.pageContent*this.currPage+"px";
  },
  showFocus:function() {
    $("listBarDiv").style.background = "#ffff00";
  },
  clearFocus:function() {
    $("listBarDiv").style.background = "#558589";
  },
  noItemData: function() {
      $("content").innerText = "暂无数据";
      this.noScrollBar();
  },
  initTitle: function() {
      $("navTitle").innerHTML = this.panelData.title;
      if(getStrChineseLength(this.panelData.title) > this.maxTitleSize){
        $("navTitle").innerHTML = "<marquee width=840 scrollamount=7\">"+this.panelData.title+"</marquee>";
      }
  },
  initContent: function() {
    if(this.panelData.content == ""){
      $("content").innerHTML = "暂无相关介绍";
    }else{
      $("content").innerHTML = this.panelData.content;
    }
    $("content").style.top = -this.pageContent*this.currPage+"px";
    var that = this;
    setTimeout(function(){
        that.totalPage = Math.floor($("content").offsetHeight/that.pageContent)+1;
        that.initScroll();
    },200);
  },
  initScroll: function() {
    if(this.totalPage > 1){
        $("listBarDiv").style.visibility = "visible";
        this.scrollBox = new ScrollBar("listBarDiv", "listBarDiv", window);
        this.scrollBox.init(this.totalPage, 1, 438, 0, 41);
        this.scrollBox.scroll(this.currPage);
    }else{
        this.noScrollBar();
    }
  },
  noScrollBar: function() {
    $("listBarDiv").style.visibility = "hidden";
    this.scrollBox = null;
  }
}
</script>
</head>
<body  leftmargin="0" topmargin="0" background="images/bg.png">
  <!--top-->
  <div style="position:absolute;left:577px;top:55px; width:26px; height:25px; background:url(images/arrow00.png);"></div>
  <div style="position:absolute;left:611px;top:46px; width:187px; height:44px; background:url(images/title02.png);"></div>
  <div style="position:absolute;left:950px;top:47px; width:300px;font-size:32px; color:#263b3e;">毕节朱昌镇欢迎您！</div>
  <div style="position:absolute;left:78px;top:123px; width:563px; height:315px; background:url(images/bg1_1.png);"></div>
  <!--跑马灯-->
  <div style="position:absolute;left:131px;top:625px; width:984px;line-height:50px; font-size:23px; color:#f0f0f0;">
    <marquee id="marqueeContent">
    </marquee>
  </div>
  <!--左侧MENU列表-->
  <div style="position:absolute;left:78px;top:119px; width:234px;height:388px;">
    <table border="0" cellpadding="0" cellspacing="0" width="100%" height="100%" style="font-size:30px; color:#fff; text-align:center;">
      <tr height="64">
        <td id="menu0" style="background:url(images/list_ct.png);"></td>
      </tr>
      <tr height="17"><td></td></tr>
      <tr height="64">
        <td id="menu1" style="background:url(images/list_ct.png);"></td>
      </tr>
      <tr height="17"><td></td></tr>
      <tr height="64">
        <td id="menu2" style="background:url(images/list_ct.png);"></td>
      </tr>
      <tr height="17"><td></td></tr>
      <tr height="64">
        <td id="menu3" style="background:url(images/list_ct.png);"></td>
      </tr>
      <tr height="17"><td></td></tr>
      <tr height="64">
        <td id="menu4" style="background:url(images/list_ct.png);"></td>
      </tr>
      <tr height="17"><td></td></tr>
      <tr height="64">
        <td id="menu5" style="background:url(images/list_ct.png);"></td>
      </tr>
    </table>
  </div>
  <!-- 广告位 -->
  <div style="position:absolute;left:81px;top:286px; width:230px;height:320px;"><img src="images/pic2_1.png" width="230" height="320"></div>
  <!-- iframe区 -->
  <div style="position:absolute; width:872px;height:492px; background:url(images/tab_bg1.png); left: 313px; top: 99px; z-index:2">
    <div id="listFrame" style="width: 910px; height: 522px;border: none; background-color: transparent;">
      <div style="position:absolute; top:3px; left:11px; width:500px; height:50px;padding-left:16px; font-size:30px; color:#4a671c;">><span id="nowTitle"></span></div>
      <!-- 标题下横线 -->
      <div style="position:absolute; top:54px; left:11px; width:837px; height:1px; background-color: #BDCDDF; layer-background-color: #BDCDDF;"></div>   
      <div style="position: absolute; left: -40px; top: -17px; width: 860px; height: 468px;">
        <!--标题-->
  <!--       <div id="navTitle" style="position: absolute; left: 45px; top: 28px; width: 880px; height: 71px; font-size: 30px; color: #000000; line-height: 71px; text-align: center; border-bottom: 1px; font-weight: 600">
        </div> -->
        <!--内容容器-->
        <div style="position: absolute; left: 74px; top: 88px; width: 795px; height: 406px; overflow: hidden;">
          <!-- 实际内容区 -->
          <div id="content" style="position: absolute; left: 0px; top: 0px; width: 795px;font-size: 24px;font-family:SimSun;">
          </div>
        </div>
        <!--翻页栏-->
        <div style="position:absolute;right:-48px;top:71px; width:13px;height:438px; background:url(images/page_bg1.png);" id="scrollBarDiv">
          <div style="position:absolute; left:-7px; top:40px;  width:13px;height:41px; background:#558589;visibility:hidden" id="listBarDiv">
          </div>
        </div>
      </div>  
    </div>
  </div>
</body>
</html>
