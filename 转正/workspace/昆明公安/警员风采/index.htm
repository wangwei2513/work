<!doctype html>
<html>

<head>
    <meta charset="utf-8">
    <title></title>
</head>

<body background="images/bg.jpg" leftmargin="0" topmargin="0">
    <div style="position:absolute;left:67px;top:54px; width:300px; font-size:38px; color:#fff;">
        < <span id="node">走进德城</span>
    </div>
    <!--具体内容-->
    <div style="position:absolute;left:68px;top:128px; width:1146px; height:483px; background:url(images/tab_bg2.png);">
        <div id="focus" style="position:absolute; top:31px; left:25px; width:251px; height:198px; background-image: url(images/pop_f1.png)"></div>
        <div style="position:absolute;left:30px;top:36px; width:240px; height:185px;">
            <img id="img0" src="images/pic2_1.jpg" width="240" height="151">
            <div id="title0" style="position:absolute;left:0px;top:159px; width:240px; font-size:26px; color:#000; text-align:center;">锦绣川风景区</div>
        </div>

        <div style="position:absolute;left:300px;top:36px; width:240px; height:185px;">
            <img id="img1" src="images/pic2_2.jpg" width="240" height="151">
            <div id="title1" style="position:absolute;left:0px;top:159px; width:240px; font-size:26px; color:#fff; text-align:center;">锦绣川风景区</div>
        </div>

        <div style="position:absolute;left:570px;top:36px; width:240px; height:185px;">
            <img id="img2" src="images/pic2_3.jpg" width="240" height="151">
            <div id="title2" style="position:absolute;left:0px;top:159px; width:240px; font-size:26px; color:#fff; text-align:center;">锦绣川风景区</div>
        </div>

        <div style="position:absolute;left:840px;top:36px; width:240px; height:185px;">
            <img id="img3" src="images/pic2_4.jpg" width="240" height="151">
            <div id="title3" style="position:absolute;left:0px;top:159px; width:240px; font-size:26px; color:#fff; text-align:center;">锦绣川风景区</div>
        </div>

        <!--第二排-->
        <div style="position:absolute;left:30px;top:247px; width:240px; height:185px;">
            <img id="img4" src="images/pic2_5.jpg" width="240" height="151">
            <div id="title4" style="position:absolute;left:0px;top:159px; width:240px; font-size:26px; color:#fff; text-align:center;">锦绣川风景区</div>
        </div>

        <div style="position:absolute;left:300px;top:247px; width:240px; height:185px;">
            <img id="img5" src="images/pic2_6.jpg" width="240" height="151">
            <div id="title5" style="position:absolute;left:0px;top:159px; width:240px; font-size:26px; color:#fff; text-align:center;">锦绣川风景区</div>
        </div>

        <div style="position:absolute;left:570px;top:247px; width:240px; height:185px;">
            <img id="img6" src="images/pic2_7.jpg" width="240" height="151">
            <div id="title6" style="position:absolute;left:0px;top:159px; width:240px; font-size:26px; color:#fff; text-align:center;">锦绣川风景区</div>
        </div>

        <div style="position:absolute;left:840px;top:247px; width:240px; height:185px;">
            <img id="img7" src="images/pic2_8.jpg" width="240" height="151">
            <div id="title7" style="position:absolute;left:0px;top:159px; width:240px; font-size:26px; color:#fff; text-align:center;">锦绣川风景区</div>
        </div>

        <!--滚动条-->
        <div id="scrollBar" style="position:absolute;left:1120px;top:14px; width:4px; height:440px; background:#bb3a17;">
            <div id="scroll" style="position:absolute;left:-13px;top:0px; width:30px; height:62px; background:url(images/page01.jpg); line-height:31px; font-size:24px; color:#000; text-align:center;"><span id="curr">1</span><br/><span id="totleLen" style="color:#666;">13</span></div>
        </div>
    </div>
    <script src="js/common.js"></script>
    <script src="js/config.js"></script>
    <script>
        function grabKeyEvent(keycode) {
            var e = keycode || event;
            var keycode = e.keyCode || e.which || e.charCode;
            switch (keycode) {
                case 1:
                case 38: //up
                    keyUp();
                    return false;
                    break;
                case 2:
                case 40: //down
                    keyDown()
                    return false;
                    break;
                case 3:
                case 37: //left
                    keyLeft();
                    return false;
                    break;
                case 4:
                case 39: //right
                    keyRight();
                    return false;
                    break;
                case 13: //ok
                    doSelect();
                    break;
                case 8:
                case 27:
                case 32:
                case 340:
                case 640:
                    goBack();
                    return false;
                    break;
            }
        }
        document.onkeydown = grabKeyEvent;
        document.onsystemevent = grabKeyEvent;
        var access_token = navigator.appName.indexOf("iPanel") != -1 ? iPanel.eventFrame.access_token :
            "R59F92A96U10928023K3B9F68D2I520FA8C0P8M2FAF2CCWDBA950F8361";
        var ajaxObj = null,
            vodPlayAddr = "http://172.16.242.42/application/newPlay/vodPlay.htm",
            menuData = [],
            contentData = [],
            currPage = 0,
            totlePage = 0,
            label = '810',
            smallPic = '246x138',
            pos = getGlobalParms("listPos") ? parseInt(getGlobalParms("listPos")) : 0;
        iDebug("--wangwei--access_token--:" + access_token);
        // 加载node数据
        function ajaxLoadNodeData() {
            if (ajaxObj == null) {
                ajaxObj = new AjaxClass();
                ajaxObj.charset = "gbk";
                ajaxObj.frame = window;
            } else {
                ajaxObj.requestAbort();
            }
            ajaxObj.url = "node.js";
            // 
            ajaxObj.successCallback = function (_xmlHttp) {
                var getData = eval("(" + _xmlHttp.responseText + ")");
                nodeData = getData;
                initNode();
                getList();
            }
            ajaxObj.failureCallback = function () {}
            ajaxObj.requestData();
        }

        function getList() {
            if (ajaxObj == null) {
                ajaxObj = new AjaxClass();

                ajaxObj.frame = window;
            } else {
                ajaxObj.requestAbort();
            }
            ajaxObj.charset = "utf-8";
            ajaxObj.frequency = 1000;
            ajaxObj.requestTimes = 1;
            ajaxObj.successCallback = function (_xmlHttp, _params) {
                var jsonData = _xmlHttp.responseText;
                var result_data = eval("(" + jsonData + ")");
                contentData = result_data.list;
                totlePage = Math.ceil(contentData.length / 8);
                if (contentData) {
                    initList();
                }
            };
            ajaxObj.failureCallback = function (_xmlHttp, _params) {};
            //修改字段名称
            ajaxObj.url = [slaveAddr + "/homed/program/get_list?accesstoken=" + access_token + "&label=" + label +
                "&pageidx=" + 1 + "&pagenum=" + 20 + "&depth=2", "data/listPage.js"
            ][0];
            iDebug("----listDataPath--:" + ajaxObj.url);
            ajaxObj.requestData("GET");
        }
        // initNode
        function initNode() {
            $("node").innerText = nodeData.name;
        }
        // initList
        function initList() {
            clearList();
            if (contentData.length > 8) {
                if (currPage < totlePage - 1) {
                    for (var i = 0; i < 8; i++) {
                        $("img" + i).parentNode.style.visibility = 'visible';
                        $("img" + i).src = contentData[currPage * 8 + i].poster_list.dir + contentData[currPage * 8 + i]
                            .poster_list.list[smallPic];
                        iDebug("----$(img" + i + ").src--:" + $("img" + i).src);
                        if (contentData[currPage * 8 + i].name.length > 5) {
                            $("title" + i).innerText = contentData[currPage * 8 + i].name.substring(0, 5) + '..';
                        } else {
                            $("title" + i).innerText = contentData[currPage * 8 + i].name;
                        }
                    }
                } else {
                    for (var i = 0; i < contentData.length - currPage * 8; i++) {
                        $("img" + i).parentNode.style.visibility = 'visible';
                        $("img" + i).src = contentData[currPage * 8 + i].poster_list.dir + contentData[currPage * 8 + i]
                            .poster_list.list[smallPic];
                        iDebug("----$(img" + i + ").src--:" + $("img" + i).src);
                        if (contentData[currPage * 8 + i].name.length > 5) {
                            $("title" + i).innerText = contentData[currPage * 8 + i].name.substring(0, 5) + '..';
                        } else {
                            $("title" + i).innerText = contentData[currPage * 8 + i].name;
                        }
                    }
                }
            } else {
                for (var i = 0; i < contentData.length; i++) {
                    $("img" + i).parentNode.style.visibility = 'visible';
                    $("img" + i).src = contentData[currPage * 8 + i].poster_list.dir + contentData[currPage * 8 + i].poster_list
                        .list[smallPic];
                    iDebug("----$(img" + i + ").src--:" + $("img" + i).src);
                    if (contentData[currPage * 8 + i].name.length > 5) {
                        $("title" + i).innerText = contentData[currPage * 8 + i].name.substring(0, 5) + '..';
                    } else {
                        $("title" + i).innerText = contentData[currPage * 8 + i].name;
                    }
                }
            }
            initScroll('scroll', 'scrollBar', totlePage);
        }

        function loseTitleFocus() {
            if (contentData[currPage * 8 + pos].name.length > 5) {
                $("title" + pos).innerText = contentData[currPage * 8 + pos].name.substring(0, 5) + '..';
            }
        }

        function setTitleFocus() {
            if (contentData[currPage * 8 + pos].name.length > 5) {
                $("title" + pos).innerHTML = '<marquee>' + contentData[currPage * 8 + pos].name + '</marquee>';
            }
        }
        // clearList
        function clearList() {
            for (var i = 0; i < 8; i++) {
                $("img" + i).parentNode.style.visibility = 'hidden';
            }
        }
        /*初始化滚动条*/
        function initScroll(scrollBar, scroll, length) {
            scrollObj = new ScrollBar(scrollBar, scroll);
            scrollObj.init(length, 1, 377, 0);
        }
        // 上
        function keyUp() {
            if (currPage > 0) {
                if (pos > 3) {
                    pos -= 4;
                } else {
                    pos += 4;
                    currPage--;
                    $("curr").innerText = currPage + 1;
                    initList();
                    scrollObj.scroll(currPage);
                }
            } else {
                if (pos > 3) {
                    pos -= 4;
                }
            }
            focusMove()
        }
        // 下
        function keyDown() {
            if (currPage < totlePage - 1) {
                if (pos < 4) {
                    pos += 4;
                } else {
                    if ((currPage + 1) * 8 + pos - 4 < contentData.length) {
                        pos -= 4;
                    } else {
                        pos = contentData.length - (currPage + 1) * 8 - 1;
                    }
                    currPage++;
                    $("curr").innerText = currPage + 1;
                    initList();
                    scrollObj.scroll(currPage);
                }
            } else {
                if (contentData.length - currPage * 8 > 4) {
                    if (pos < 4 && currPage * 8 + pos + 4 < contentData.length) {
                        pos += 4;
                    } else if (pos < 4 && currPage * 8 + pos + 4 >= contentData.length) {
                        pos = contentData.length - currPage * 8 - 1;
                    }
                }
            }
            focusMove();
        }
        // 左
        function keyLeft() {
            if (currPage < totlePage - 1) {
                if (pos !== 0 && pos !== 4) {
                    pos--;
                } else {
                    pos += 3;
                }
            } else {
                if (contentData.length - currPage * 8 > 4) {
                    if (pos !== 0 && pos !== 4) {
                        pos--;
                    } else if (pos == 0) {
                        pos += 3;
                    } else if (pos == 4) {
                        pos = contentData.length - currPage * 8 - 1;
                    }
                } else {
                    if (pos > 0) {
                        pos--;
                    }
                }
            }
            focusMove();
        }
        // 右
        function keyRight() {
            if (currPage < totlePage - 1) {
                if (pos !== 3 && pos !== 7) {
                    pos++
                } else {
                    pos -= 3
                }
            } else {
                if (contentData.length - currPage * 8 > 4) {
                    if (pos < 3 || (pos > 3 && pos < contentData.length - currPage * 8 - 1)) {
                        pos++
                    } else if (pos === 3) {
                        pos -= 3
                    }
                } else {
                    if (pos < contentData.length - currPage * 8 - 1) {
                        pos++;
                    }
                }
            }
            focusMove();
        }
        // focusMove
        function focusMove() {
            clearColor();
            $("title" + pos).style.color = '#000';
            if (pos < 4) {
                $("focus").style.top = '31px';
                $("focus").style.left = 25 + pos * 270 + 'px';
            } else {
                $("focus").style.top = '242px';
                $("focus").style.left = 25 + (pos - 4) * 270 + 'px';
            }
        }
        // 清除文字样式
        function clearColor() {
            for (var i = 0; i < 8; i++) {
                $("title" + i).style.color = '#fff';
            }
        }
        // doSelect
        function doSelect() {
            // iDebug("----videoId--:" + contentData[pos].id);
            // iDebug("----videoName--:" + contentData[pos].name);
            // setGlobalParms({
            //     'listPos': pos
            // });
            // window.location.href = vodPlayAddr + "?videoId=" + contentData[pos].id + '&backUrl=' +
            //     encodeURIComponent(window.location.href);
            iPanel.eventFrame.playParam = {
                type: "vod",
                vodObj: {
                    videoId: contentData[pos].id,
                    videoName: contentData[pos].name,
                },
                backUrl: encodeURIComponent(window.location.href),
                labelId: label,
                fromSP: "xsga",
                freeVideoFlag: false,
                seektime: "0",
            };
            iPanel.eventFrame.gotoPage("http://172.16.242.42/application/newPlay/vodPlay.htm");
        }
        // goback  
        function goBack() {
            removeGlobalParms('listPos');
            window.location.href = '../index.htm';
        }
        // init   
        function init() {
            ajaxLoadNodeData();
            focusMove();
        }
        window.onload = init();
    </script>
</body>

</html>