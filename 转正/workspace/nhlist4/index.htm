<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">

<head>
    <meta http-equiv="Content-Type" content="text/html; charset=gb2312" />
    <title>党章党规学习</title>
    <script type="text/javascript" src="js/common.js"></script>
    <script type="text/javascript">
        window.onkeydown = function(e) {
                var e = e || event;
                var keycode = e.keyCode || e.which || e.charCode;
                switch (keycode) {
                    case 1:
                    case 38: //up
                        changeUD(-1);
                        return EVENT.STOP;
                        break;
                    case 2:
                    case 40: //down
                        changeUD(1);
                        return EVENT.STOP;
                        break;
                    case 3:
                    case 37: //left
                        changeLR(-1);
                        return EVENT.STOP;
                        break;
                    case 4:
                    case 39: //right
                        changeLR(1);
                        return EVENT.STOP;
                        break;
                    case 13: //enter
                        doSelect();
                        return EVENT.STOP;
                        break;
                    case 8:
                    case 340: //back
                        window.location.href = "../index.htm";
                        mySessionStorage.removeItem("xxjy_tListPos");
                        return EVENT.STOP;
                        break;
                    case 27:
                    case 339: //exit
                        return EVENT.STOP;
                        break;
                }
            }
            /**********************变量**********************/
        var menuData = [];
        var listPos = 0;
        var focusArea = 0;
        var currPage = 1;
        var totalPage = 1;
        var pageSize = 4;

        var ajaxObj = null;
        var file = "content.js";
        /**********************方法**********************/
        function init() {
            initParams();
            ajaxMenuList();
        }

        function initParams() {
            if (mySessionStorage.getItem("xxjy_tListPos")) {
                var pos = parseInt(mySessionStorage.getItem("xxjy_tListPos"), 10);
                listPos = pos % pageSize;
                currPage = Math.floor(pos / pageSize) + 1;
            }
        }

        function ajaxMenuList() {
            if (ajaxObj == null) {
                ajaxObj = new AjaxClass();
                ajaxObj.charset = "gbk";
                ajaxObj.frame = window;
            } else {
                ajaxObj.requestAbort();
            }

            var url = file;
            ajaxObj.url = url;

            ajaxObj.successCallback = function(_xmlHttp) {
                var getData = eval("(" + _xmlHttp.responseText + ")");
                menuData = getData;
                initContent();
                onFocus();
            }

            ajaxObj.failureCallback = function() {
                initContent();
                onFocus();
            }

            ajaxObj.requestData();
        }

        function initContent() {
            clearContent();
            if (menuData.length > 0) {
                totalPage = Math.ceil(menuData.length / pageSize);
                for (var i = 0; i < Math.min(pageSize, menuData.length - (currPage - 1) * pageSize); i++) {
                    $("focus" + i).style.display = "block";
                    $("focus" + i).src = "images/focus0.png";
                    $("list" + i).innerText = getStrChineseLen(menuData[i + (currPage - 1) * pageSize].title, 19);
                    $("list" + i).style.color = "#c63636";
                }
            }
            $("cur").innerText = listPos + 1;
            $("total").innerText = menuData.length;
        }

        function clearContent() {
            for (var i = 0; i < pageSize; i++) {
                $("focus" + i).style.display = "none";
                $("focus" + i).src = "";
                $("list" + i).innerText = "";
            }
        }

        function onFocus() {
            switch (focusArea) {
                case 0:
                    onContentFocus();
                    break;
                default:
                    break;
            }
        }

        function onContentFocus() {
            $("focus" + listPos).src = "images/focus1.png";
            $("list" + listPos).style.color = "#fff";
            if (menuData.length > 0) {
                if (menuData[listPos + (currPage - 1) * pageSize].title.length > 19) {
                    $("list" + listPos).innerHTML = "<marquee style=\"width:610px;\">" + menuData[listPos + (currPage - 1) * pageSize].title + "</marquee>";
                }
            }
            var pos = listPos + (currPage - 1) * pageSize;
            mySessionStorage.setItem("xxjy_tListPos", pos);
        }

        function loseContentFocus() {
            $("focus" + listPos).src = "images/focus0.png";
            $("list" + listPos).style.color = "#c63636";
        }

        function changeUD(_num) {
            if (menuData.length <= 0) {
                return false;
            }
            loseContentFocus();
            $("list" + listPos).innerText = getStrChineseLen(menuData[listPos + (currPage - 1) * pageSize].title, 19);
            if ((listPos == 0 && currPage == 1 && _num == -1) || (listPos == pageSize - 1 && currPage == totalPage && _num == 1)) {;
            } else if ((listPos == 0 && currPage > 1 && _num == -1) || (listPos == pageSize - 1 && currPage < totalPage && _num == 1)) {
                currPage += _num;
                initContent();
                listPos = _num == -1 ? pageSize - 1 : 0;
            } else {
                listPos += _num;
                listPos = listPos + (currPage - 1) * pageSize >= menuData.length ? (menuData.length - 1) % pageSize : listPos;
            }
            onContentFocus();
        }

        function changeLR(_num) {
            if (menuData.length <= 0) {
                return false;
            }
        }

        function doSelect() {
            if (menuData.length <= 0) {
                return false;
            }
            var tmp = listPos + (currPage - 1) * pageSize;
            window.location.href = "content.htm";
        }
    </script>
</head>

<body background="images/bg.jpg" topmargin="0" leftmargin="0" onload="init()">
    <!-- 左侧图片 -->
    <img src="images/poster0.png" width="335" height="530" style="position:absolute;left:60px;top:130px;">
    <!-- 右侧条目 -->
    <div style="position:absolute;left:442px;top:190px;">
        <img id="focus0" src="" width="758" height="65" style="position:absolute;">
        <div id="list0" style="position:absolute;width:664px;height:65px;line-height:65px;left:80px;font-size:32px;color:#000;"></div>
    </div>
    <div style="position:absolute;left:442px;top:285px;">
        <img id="focus1" src="" width="758" height="65" style="position:absolute;">
        <div id="list1" style="position:absolute;width:664px;height:65px;line-height:65px;left:80px;font-size:32px;color:#000;"></div>
    </div>
    <div style="position:absolute;left:442px;top:380px;">
        <img id="focus2" src="" width="758" height="65" style="position:absolute;">
        <div id="list2" style="position:absolute;width:664px;height:65px;line-height:65px;left:80px;font-size:32px;color:#000;"></div>
    </div>
    <div style="position:absolute;left:442px;top:475px;">
        <img id="focus3" src="" width="758" height="65" style="position:absolute;">
        <div id="list3" style="position:absolute;width:664px;height:65px;line-height:65px;left:80px;font-size:32px;color:#000;"></div>
    </div>
    <!-- 页码 -->
    <div style="position:absolute;width:300px;height:44px;line-height:44px;left:652px;top:588px;font-size:22px;color:#000;text-align:center;">第<span id="cur"></span>条/共<span id="total"></span>条</div>
</body>

</html>